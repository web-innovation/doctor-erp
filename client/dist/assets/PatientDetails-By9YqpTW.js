import{T as Y,u as _,U as J,I as X,r as m,b as Z,p as u,J as I,j as e,e as H,l as ee,V as se,W as te,n as ae,X as re,Y as M,L as o,x as V,g as le,Z as ie,v as ne,w as de,_ as ce,$ as oe,y as $,Q as xe,z as N,G as x}from"./index-BKdfnJ0H.js";import{u as q}from"./useMutation-C5UsUZj5.js";import{p as me}from"./prescriptionService-CsFaaSS6.js";const ue=[{id:"overview",label:"Overview",icon:le},{id:"history",label:"History",icon:ie},{id:"prescriptions",label:"Prescriptions",icon:V},{id:"bills",label:"Bills",icon:ne},{id:"vitals",label:"Vitals",icon:de}];function be(){var E,D;const{id:a}=Y(),p=_(),B=J(),v=X(),[i,L]=m.useState("overview"),[G,g]=m.useState(!1),{register:l,handleSubmit:T,reset:F,setValue:k,watch:R,formState:{errors:h}}=Z();m.useEffect(()=>{B.pathname.endsWith("/edit")&&g(!0)},[B.pathname]);const{data:t,isLoading:Q,isError:K}=u({queryKey:["patient",a],queryFn:()=>x.getPatient(a),enabled:!!a});m.useEffect(()=>{t&&F({name:t.name||"",phone:t.phone||"",email:t.email||"",gender:t.gender||"",dateOfBirth:t.dateOfBirth?t.dateOfBirth.split("T")[0]:"",age:t.age||"",bloodGroup:t.bloodGroup||"",address:t.address||"",city:t.city||"",emergencyContact:t.emergencyContact||"",allergies:t.allergies&&Array.isArray(t.allergies)?t.allergies.join(", "):"",medicalHistory:t.medicalHistory&&Array.isArray(t.medicalHistory)?t.medicalHistory.join(`
`):"",insurance:t.insurance||""})},[t,F]);const w=R("dateOfBirth");m.useEffect(()=>{if(!w)return;const s=O(w);typeof s=="number"&&!Number.isNaN(s)&&k("age",s,{shouldValidate:!0,shouldDirty:!0})},[w,k]);const{data:b}=u({queryKey:["patientPrescriptions",a],queryFn:()=>me.getByPatientId(a),enabled:!!a&&i==="prescriptions"}),{data:y}=u({queryKey:["patientVitals",a],queryFn:()=>x.getVitals(a),enabled:!!a&&i==="vitals"}),{data:j}=u({queryKey:["patientBills",a],queryFn:()=>x.getBills(a),enabled:!!a&&i==="bills"}),{data:f}=u({queryKey:["patientHistory",a],queryFn:()=>x.getHistory(a),enabled:!!a&&i==="history"}),U=I("prescriptions:create",["DOCTOR","ADMIN","SUPER_ADMIN"]),z=I("appointments:create",["DOCTOR","SUPER_ADMIN","RECEPTIONIST"]),P=q({mutationFn:s=>x.addVitals(a,s),onSuccess:()=>{v.invalidateQueries(["patientVitals",a]),N.success("Vitals added successfully")},onError:()=>{N.error("Failed to add vitals")}}),A=q({mutationFn:s=>x.updatePatient(a,s),onSuccess:()=>{v.invalidateQueries(["patient",a]),v.invalidateQueries(["patients"]),N.success("Patient updated successfully"),g(!1),p(`/patients/${a}`)},onError:s=>{var r,n;N.error(((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to update patient")}}),C=()=>{g(!1),p(`/patients/${a}`)},W=s=>{const r=s.allergies?s.allergies.split(",").map(c=>c.trim()).filter(Boolean):void 0,n=s.medicalHistory?s.medicalHistory.split(`
`).map(c=>c.trim()).filter(Boolean):void 0;A.mutate({...s,dateOfBirth:s.dateOfBirth||void 0,allergies:r,medicalHistory:n,insurance:s.insurance||void 0})},d=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"-",O=s=>{if(!s)return"-";const r=new Date,n=new Date(s);let c=r.getFullYear()-n.getFullYear();const S=r.getMonth()-n.getMonth();return(S<0||S===0&&r.getDate()<n.getDate())&&c--,c};return Q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(H,{className:"animate-spin text-4xl text-blue-600"})}):K||!t?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load patient details"}),e.jsx("button",{onClick:()=>p("/patients"),className:"text-blue-600 hover:underline",children:"Back to Patients"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>p("/patients"),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(ee,{className:"text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Patient Details"}),e.jsxs("p",{className:"text-gray-500",children:["ID: ",t.patientId||`P${String(t.id).padStart(5,"0")}`]})]}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(se,{}),"Edit Patient"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.photo?e.jsx("img",{src:t.photo,alt:t.name,className:"w-24 h-24 rounded-full object-cover"}):e.jsx("span",{className:"text-3xl font-bold text-blue-600",children:((E=t.name)==null?void 0:E.charAt(0))||"P"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[t.age||O(t.dateOfBirth)," years • ",t.gender||"N/A"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(te,{className:"text-blue-500"}),e.jsx("span",{children:t.phone||"No phone"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(ae,{className:"text-blue-500"}),e.jsx("span",{children:t.email||"No email"})]}),e.jsxs("div",{className:"flex items-start gap-3 text-gray-600",children:[e.jsx(re,{className:"text-blue-500 mt-1"}),e.jsx("span",{children:t.address||"No address"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(M,{className:"text-blue-500"}),e.jsxs("span",{children:["Registered: ",d(t.createdAt)]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100 space-y-3",children:[U&&e.jsxs(o,{to:`/prescriptions/new?patientId=${a}`,className:"w-full inline-flex items-center justify-center gap-2 bg-green-600 text-white py-2.5 rounded-lg font-medium hover:bg-green-700 transition",children:[e.jsx(V,{}),"New Prescription"]}),z&&e.jsxs(o,{to:`/appointments/new?patientId=${a}`,className:"w-full inline-flex items-center justify-center gap-2 border border-blue-600 text-blue-600 py-2.5 rounded-lg font-medium hover:bg-blue-50 transition",children:[e.jsx(M,{}),"Book Appointment"]})]})]})}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-6",children:e.jsx("div",{className:"flex overflow-x-auto",children:ue.map(s=>e.jsxs("button",{onClick:()=>L(s.id),className:`flex items-center gap-2 px-6 py-4 font-medium whitespace-nowrap transition border-b-2 ${i===s.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(s.icon,{}),s.label]},s.id))})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[i==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Blood Group"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.bloodGroup||"Not recorded"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),e.jsx("p",{className:"font-medium text-gray-900",children:d(t.dateOfBirth)})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Emergency Contact"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.emergencyContact||"Not recorded"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Insurance"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.insurance||"Not recorded"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ce,{className:"text-red-500"}),"Allergies"]})}),t.allergies&&t.allergies.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:t.allergies.map((s,r)=>e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm",children:s},r))}):e.jsx("p",{className:"text-gray-500",children:"No known allergies"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medical History"}),t.medicalHistory&&t.medicalHistory.length>0?e.jsx("ul",{className:"space-y-2",children:t.medicalHistory.map((s,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"text-blue-500 mt-1 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:s})]},r))}):e.jsx("p",{className:"text-gray-500",children:"No medical history recorded"})]})]}),i==="history"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Visit History"}),((D=f==null?void 0:f.appointments)==null?void 0:D.length)>0?e.jsx("div",{className:"space-y-4",children:f.appointments.map((s,r)=>e.jsxs(o,{to:`/appointments/${s.id}`,className:"block p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.reason||"General Checkup"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="COMPLETED"?"bg-green-100 text-green-700":s.status==="CANCELLED"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:s.status})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:d(s.date)}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s.notes||"No notes"})]},s.id||r))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No visit history available"})]}),i==="prescriptions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Prescriptions"}),e.jsxs(o,{to:`/prescriptions/new?patientId=${a}`,className:"inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx($,{}),"New Prescription"]})]}),(b==null?void 0:b.length)>0?e.jsx("div",{className:"space-y-4",children:b.map(s=>{var r;return e.jsxs(o,{to:`/prescriptions/${s.id}`,className:"block p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.diagnosis||"Prescription"}),e.jsx("span",{className:"text-sm text-gray-500",children:d(s.date)})]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[((r=s.medicines)==null?void 0:r.length)||0," medicines prescribed"]}),e.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Dr. ",s.doctor||"N/A"]})]},s.id)})}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No prescriptions yet"})]}),i==="bills"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bills & Invoices"}),(j==null?void 0:j.length)>0?e.jsx("div",{className:"space-y-4",children:j.map(s=>{var r;return e.jsxs(o,{to:`/billing/${s.id}`,className:"block p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Invoice #",s.billNo]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.paymentStatus==="PAID"?"bg-green-100 text-green-700":s.paymentStatus==="PARTIAL"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:s.paymentStatus})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:d(s.date)}),e.jsxs("p",{className:"font-semibold text-gray-900 mt-2",children:["₹",((r=s.totalAmount)==null?void 0:r.toLocaleString())||0]})]},s.id)})}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No bills generated"})]}),i==="vitals"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Vitals Record"}),e.jsxs("button",{onClick:()=>{const s={bloodPressure:"120/80",pulse:72,temperature:98.6,weight:70,height:170,spO2:98};P.mutate(s)},disabled:P.isPending,className:"inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50",children:[P.isPending?e.jsx(H,{className:"animate-spin"}):e.jsx($,{}),"Add Vitals"]})]}),(y==null?void 0:y.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"BP"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Pulse"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Temp"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Weight"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Height"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"SpO2"})]})}),e.jsx("tbody",{children:y.map((s,r)=>e.jsxs("tr",{className:"border-b border-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900",children:d(s.recordedAt)}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.bloodPressure||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.pulse?`${s.pulse} bpm`:"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.temperature?`${s.temperature}°F`:"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.weight?`${s.weight} kg`:"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.height?`${s.height} cm`:"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.spO2?`${s.spO2}%`:"-"})]},s.id||r))})]})}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No vitals recorded"})]})]})]})]})]}),e.jsx(xe,{isOpen:G,onClose:C,title:"Edit Patient",size:"lg",children:e.jsxs("form",{onSubmit:T(W),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Patient Name *"}),e.jsx("input",{type:"text",...l("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),h.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx("input",{type:"tel",...l("phone",{required:"Phone is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),h.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",...l("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{...l("gender"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",...l("dateOfBirth"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Allergies (comma separated)"}),e.jsx("input",{type:"text",...l("allergies"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g. Penicillin, Pollen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Insurance"}),e.jsx("input",{type:"text",...l("insurance"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Insurance provider / policy"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medical History (one per line)"}),e.jsx("textarea",{...l("medicalHistory"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe medical history entries, one per line"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),e.jsxs("select",{...l("bloodGroup"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Blood Group"}),e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",...l("city"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{...l("address"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Emergency Contact"}),e.jsx("input",{type:"text",...l("emergencyContact"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:A.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:A.isPending?"Saving...":"Save Changes"})]})]})})]})}export{be as default};
