import{T as $e,J as ye,j as e,u as Ue,r as o,b as ze,ac as _e,p as j,a as Ke,I as He,l as Qe,g as Ye,K as ae,al as fe,y as Je,ae as Ve,am as Xe,af as We,z as p,an as je,D as Ze}from"./index-CC2xPFuU.js";import{u as Ne}from"./useMutation-Bq8VOvlw.js";import{b as v}from"./billingService-DMv2HqX5.js";import{p as et}from"./pharmacyService-TQuqLE6t.js";const tt=[{id:"consultation",label:"Consultation",color:"blue"},{id:"pharmacy",label:"Pharmacy",color:"green"},{id:"lab",label:"Lab Test",color:"purple"}],st=[{value:0,label:"No GST (0%)"},{value:5,label:"GST 5%"},{value:10,label:"GST 10%"},{value:12,label:"GST 12%"},{value:18,label:"GST 18%"},{value:20,label:"GST 20%"},{value:30,label:"GST 30%"}],at=[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"upi",label:"UPI"},{value:"netbanking",label:"Net Banking"},{value:"insurance",label:"Insurance"}];function ct(){var ge;const{id:g}=$e(),ve=ye("billing:create",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),we=ye("billing:edit",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),B=!!g;if(B&&!we||!B&&!ve)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Access denied"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["You do not have permission to ",B?"edit":"create"," bills."]})]})})});const A=Ue(),[C,O]=o.useState(""),[x,I]=o.useState(null),[le,F]=o.useState(!1),[d,w]=o.useState("consultation"),[k,ne]=o.useState(""),[re,R]=o.useState(!1),[N,$]=o.useState(""),[u,Se]=o.useState(null),[S,ie]=o.useState(""),[Pe,U]=o.useState(!1),[z,Te]=o.useState(!1),{register:i,control:Ae,handleSubmit:Ce,watch:P,setValue:c,formState:{errors:lt}}=ze({defaultValues:{items:[],discount:0,discountType:"fixed",gstRate:0,paymentMethod:"cash",paymentAmount:0,paymentReference:"",notes:"",defaultConsultationGstPercent:5,defaultPharmacyGstPercent:10,defaultLabTestGstPercent:20,defaultConsultationDiscountPercent:0,defaultPharmacyDiscountPercent:0,defaultLabTestDiscountPercent:0}}),Ie=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Module GST & Discount Defaults"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Consultation GST (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultConsultationGstPercent"),className:"input input-bordered w-full mb-2"}),e.jsx("label",{className:"block text-xs mb-1",children:"Consultation Discount (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultConsultationDiscountPercent"),className:"input input-bordered w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Pharmacy GST (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultPharmacyGstPercent"),className:"input input-bordered w-full mb-2"}),e.jsx("label",{className:"block text-xs mb-1",children:"Pharmacy Discount (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultPharmacyDiscountPercent"),className:"input input-bordered w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Lab Test GST (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultLabTestGstPercent"),className:"input input-bordered w-full mb-2"}),e.jsx("label",{className:"block text-xs mb-1",children:"Lab Test Discount (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i("defaultLabTestDiscountPercent"),className:"input input-bordered w-full"})]})]})]}),{fields:q,append:_,remove:Fe,replace:ke}=_e({control:Ae,name:"items"}),h=P("items")||q,K=P("discount")||0,H=P("discountType"),Q=Number(P("gstRate")||0);o.useEffect(()=>{c("gstRate",0)},[c]);const Y=P("paymentAmount")||0,{data:J}=j({queryKey:["billing-doctors"],queryFn:()=>v.getDoctors(),enabled:!0}),D=(J==null?void 0:J.data)||[],[r,M]=o.useState(null),{user:l,normalizeRole:Re}=Ke(),oe=Re(l==null?void 0:l.role),y=oe==="DOCTOR",b=!!(l!=null&&l.isClinicAdmin||["SUPER_ADMIN","ACCOUNTANT"].includes(oe)),E=o.useMemo(()=>{try{const t=Array.isArray(D)?[...D]:[];return y&&l&&(t.some(s=>s.id===l.id)||t.unshift({id:l.id,name:l.name,email:l.email})),t}catch{return D||[]}},[D,y,l]),{data:V}=j({queryKey:["billing-patients-search",C,r==null?void 0:r.id],queryFn:()=>v.getPatients({search:C,limit:10,doctorId:r==null?void 0:r.id}),enabled:C.length>=2}),{data:X}=j({queryKey:["products-search",k],queryFn:()=>et.getProducts({search:k,limit:10}),enabled:k.length>=2&&d==="pharmacy"}),ce=(V==null?void 0:V.data)||[],de=(X==null?void 0:X.data)||[],{data:W}=j({queryKey:["labs-search",N],queryFn:()=>je.getLabs({search:N,limit:10}),enabled:d==="lab"&&N.length>=1}),ue=(W==null?void 0:W.data)||[],{data:Z}=j({queryKey:["lab-tests",u==null?void 0:u.id,S],queryFn:()=>je.getLabTests(u==null?void 0:u.id,{search:S,limit:50}),enabled:d==="lab"&&!!u&&S.length>=1}),me=(Z==null?void 0:Z.data)||[],{data:ee}=j({queryKey:["consultation-fees"],queryFn:()=>Ze.getConsultationFees()}),L=((ge=ee==null?void 0:ee.data)==null?void 0:ge.fees)||{},xe=t=>Number((L==null?void 0:L[t])||0),m=o.useMemo(()=>{const t=h.reduce((se,he)=>se+(parseFloat(he.quantity)||0)*(parseFloat(he.unitPrice)||0),0);let a=0;H==="percentage"?a=t*(parseFloat(K)||0)/100:a=parseFloat(K)||0;const s=t-a,n=s*(parseFloat(Q)||0)/100,T=s+n;return{subtotal:t,discountAmount:a,afterDiscount:s,gstAmount:n,total:T}},[JSON.stringify(h||[]),K,H,Q]),be=o.useMemo(()=>(h||[]).reduce((t,a)=>{const s=(parseFloat(a.quantity)||0)*(parseFloat(a.unitPrice)||0),n=(a.type||"").toString().toLowerCase();return n==="medicine"&&(t.medicine+=s),n==="lab"&&(t.labTest+=s),t},{medicine:0,labTest:0}),[JSON.stringify(h||[])]),pe=He(),te=Ne({mutationFn:t=>v.createBill(t),onSuccess:t=>{p.success("Bill created successfully"),pe.invalidateQueries(["bills"]),A("/billing")},onError:t=>{var a,s;p.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create bill")}}),{data:G}=j({queryKey:["bill",g],queryFn:()=>g?v.getBill(g):Promise.resolve(null),enabled:!!g});o.useEffect(()=>{if(G&&g){const t=G.data||G;if(I(t.patient||null),t.doctor&&M({id:t.doctor.id,name:t.doctor.name}),t.type){const s=(t.type||"").toString().toUpperCase();w(s==="PHARMACY"?"pharmacy":s==="LAB_TEST"?"lab":"consultation")}const a=(t.items||[]).map(s=>({productId:s.productId||null,description:s.description||"",quantity:s.quantity||1,unitPrice:s.unitPrice||s.amount||0,type:s.type||"other",doctorId:s.doctorId||void 0}));try{c("items",a),t.discountPercent!==null&&t.discountPercent!==void 0?(c("discount",t.discountPercent||0),c("discountType","percentage")):(c("discount",t.discountAmount||0),c("discountType","fixed"));const s=Number(t.subtotal||0),n=Number(t.discountAmount||0),T=s-n;if(T>0){const se=Number(t.taxAmount||0)/T*100||0;c("gstRate",Math.round(se*100)/100)}else c("gstRate",0);c("notes",t.notes||"")}catch{}}},[G,g]);const qe=Ne({mutationFn:({id:t,data:a})=>v.updateBill(t,a),onSuccess:()=>{p.success("Bill updated successfully"),pe.invalidateQueries(["bills"]),A("/billing")},onError:t=>{var a,s;p.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update bill")}}),De=async t=>{var a;I(t),O(t.name),F(!1);try{const s=await v.getPrefill(t.id),n=s==null?void 0:s.data;n!=null&&n.hasPrefill&&Array.isArray(n.items)&&n.items.length>0&&(ke(n.items),c("items",n.items),(a=n.doctor)!=null&&a.id&&M({id:n.doctor.id,name:n.doctor.name}),p.success("Medicine and lab test amounts prefilled from latest prescription"))}catch(s){console.error("Failed to prefill bill from prescription:",s)}},Me=t=>{M(t||null),I(null),O("")};o.useEffect(()=>{if(!b&&y&&l){const t=E.find(a=>a.id===l.id)||{id:l.id,name:l.name};M(t)}},[l,y,b]);const Ee=t=>{const a=h.findIndex(s=>s.productId===t.id);if(a>=0){const s=(parseInt(h[a].quantity)||0)+1;c(`items.${a}.quantity`,s),p.success(`${t.name} quantity updated`)}else _({productId:t.id,description:t.name,quantity:1,unitPrice:t.sellingPrice||t.mrp||0,type:"medicine"}),p.success(`${t.name} added to bill`);ne(""),R(!1)},Le=t=>{Se(t),$(t.name)},Ge=t=>{_({productId:null,description:t.name,quantity:1,unitPrice:t.price||0,type:"lab",meta:{labId:(u==null?void 0:u.id)||t.labId,labTestId:t.id}}),p.success(`${t.name} added to bill`),ie(""),U(!1)},Be=()=>{const t=(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0);_({productId:null,description:"",quantity:1,unitPrice:d==="consultation"?xe(t):0,type:d==="consultation"?"consultation":d==="lab"?"lab":"other",doctorId:d==="consultation"?(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0):void 0})};o.useEffect(()=>{if(d!=="consultation")return;const t=(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0);if(!t)return;const a=xe(t);a<=0||(h||[]).forEach((s,n)=>{((s==null?void 0:s.type)||"").toLowerCase()==="consultation"&&(s!=null&&s.doctorId||c(`items.${n}.doctorId`,t),(!(s!=null&&s.unitPrice)||Number(s.unitPrice)<=0)&&c(`items.${n}.unitPrice`,a))})},[d,r==null?void 0:r.id,L,y,b,l==null?void 0:l.id,h,c]);const Oe=t=>{if(!x){p.error("Please select a patient");return}if(t.items.length===0){p.error("Please add at least one item");return}const a={pharmacy:"PHARMACY",consultation:"CONSULTATION",lab:"LAB_TEST"},s={patientId:x.id,doctorId:r==null?void 0:r.id,type:a[d]||"MIXED",items:t.items.map(n=>({description:n.description,quantity:parseInt(n.quantity),unitPrice:parseFloat(n.unitPrice),gstPercent:parseFloat(t.gstRate)||0,productId:n.productId||void 0,doctorId:n.doctorId||void 0})),discount:m.discountAmount,discountType:"AMOUNT",taxConfig:{gstRate:parseFloat(t.gstRate)||0},notes:t.notes};z&&parseFloat(t.paymentAmount)>0&&(s.payment={amount:parseFloat(t.paymentAmount),method:t.paymentMethod,reference:t.paymentReference}),g?qe.mutate({id:g,data:s}):te.mutate(s)},f=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(t||0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>A("/billing"),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(Qe,{className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Bill"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Create a new invoice"})]})]}),e.jsx("form",{onSubmit:Ce(Oe),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[Ie(),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ye,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsxs("select",{value:(r==null?void 0:r.id)||"",onChange:t=>{const a=t.target.value,s=E.find(n=>n.id===a)||null;Me(s)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[b&&e.jsx("option",{value:"",children:"All Doctors"}),E.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),!b&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Listing patients for all doctors is restricted to clinic admins and accountants."})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:C,onChange:t=>{O(t.target.value),F(!0),t.target.value||I(null)},onFocus:()=>F(!0),placeholder:"Search patient by name or phone...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})]}),le&&ce.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:ce.map(t=>e.jsxs("button",{type:"button",onClick:()=>De(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.phone," ",t.email&&`• ${t.email}`]})]},t.id))})]}),x&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-900",children:x.name}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[x.phone,x.email&&` • ${x.email}`]}),x.patientId&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["ID: ",x.patientId]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Type"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:tt.map(t=>e.jsx("button",{type:"button",onClick:()=>w(t.id),className:`px-4 py-2 rounded-lg font-medium transition ${d===t.id?t.color==="blue"?"bg-blue-600 text-white":t.color==="green"?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Items"})]}),e.jsxs("button",{type:"button",onClick:Be,className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(Je,{}),"Add Item"]})]}),d==="pharmacy"&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:t=>{ne(t.target.value),R(!0)},onFocus:()=>R(!0),placeholder:"Search and add products...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"}),re&&de.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:de.map(t=>e.jsxs("button",{type:"button",onClick:()=>Ee(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",t.quantity," ",t.unit||"units"]})]}),e.jsx("span",{className:"font-medium text-gray-900",children:f(t.sellingPrice||t.mrp)})]},t.id))})]}),d==="lab"&&e.jsxs("div",{className:"mb-4 bg-white rounded p-4 border border-gray-100",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Lab"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:N,onChange:t=>{$(t.target.value)},onFocus:()=>$(N),placeholder:"Search labs...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N&&ue.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto",children:ue.map(t=>{var a;return e.jsx("button",{type:"button",onClick:()=>Le(t),className:"w-full text-left px-4 py-2 hover:bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.contactPerson&&e.jsx("p",{className:"text-xs text-gray-500",children:t.contactPerson})]}),e.jsx("div",{className:"text-sm text-gray-500",children:((a=t._count)==null?void 0:a.bills)||""})]})},t.id)})})]})]}),u&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Selected Lab: ",e.jsx("strong",{children:u.name})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:S,onChange:t=>{ie(t.target.value),U(!0)},onFocus:()=>U(!0),placeholder:"Search lab tests...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),Pe&&S.length>=1&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:me.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:"No lab tests found"}):me.map(t=>e.jsx("button",{type:"button",onClick:()=>Ge(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.category&&e.jsx("p",{className:"text-sm text-gray-500",children:t.category})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[t.price," ",t.currency||"INR"]})]})},t.id))})]})]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(fe,{className:"text-3xl mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No items added yet"}),e.jsx("p",{className:"text-sm mt-1",children:d==="pharmacy"?"Search and add products above":'Click "Add Item" to add items'})]}):e.jsx("div",{className:"space-y-3",children:q.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Description"}),e.jsx("input",{...i(`items.${a}.description`,{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Item description"})]}),t.type==="consultation"&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Doctor"}),e.jsxs("select",{...i(`items.${a}.doctorId`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[!b&&e.jsx("option",{value:l==null?void 0:l.id,children:l==null?void 0:l.name}),b&&e.jsx("option",{value:"",children:"Select doctor"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Qty"}),e.jsx("input",{type:"number",min:"1",...i(`items.${a}.quantity`,{required:!0,min:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",...i(`items.${a}.unitPrice`,{required:!0,min:0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"GST (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i(`items.${a}.gstPercent`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Discount (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",...i(`items.${a}.discountPercent`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Discount Amt"}),e.jsx("input",{type:"number",step:"0.01",min:"0",...i(`items.${a}.discountAmount`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]})]}),e.jsx("button",{type:"button",onClick:()=>Fe(a),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition mt-5",children:e.jsx(Ve,{})})]},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xe,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Discount & GST"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Type"}),e.jsxs("select",{...i("discountType"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"fixed",children:"Fixed Amount (₹)"}),e.jsx("option",{value:"percentage",children:"Percentage (%)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Discount ",H==="percentage"?"(%)":"(₹)"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",...i("discount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GST Rate"}),e.jsx("select",{...i("gstRate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:st.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{...i("notes"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Any additional notes for this bill..."})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Medicine Amount"}),e.jsx("span",{className:"text-gray-900",children:f(be.medicine)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Lab Test Amount"}),e.jsx("span",{className:"text-gray-900",children:f(be.labTest)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsx("span",{className:"text-gray-900",children:f(m.subtotal)})]}),m.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Discount"}),e.jsxs("span",{className:"text-red-600",children:["-",f(m.discountAmount)]})]}),m.gstAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["GST (",Q,"%)"]}),e.jsxs("span",{className:"text-gray-900",children:["+",f(m.gstAmount)]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:"text-gray-900",children:"Total"}),e.jsx("span",{className:"text-blue-600",children:f(m.total)})]})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:t=>Te(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Collect Payment Now"})]}),z&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsx("select",{...i("paymentMethod"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:at.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m.total,...i("paymentAmount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:m.total.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference / Transaction ID"}),e.jsx("input",{...i("paymentReference"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),Y>0&&Y<m.total&&e.jsxs("p",{className:"text-sm text-yellow-600 bg-yellow-50 p-2 rounded",children:["Balance due after payment:"," ",e.jsx("span",{className:"font-medium",children:f(m.total-Y)})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("button",{type:"submit",disabled:te.isPending||!x||q.length===0,className:"w-full inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(We,{}),te.isPending?"Creating...":"Create Bill"]}),e.jsx("button",{type:"button",onClick:()=>A("/billing"),className:"w-full px-4 py-2.5 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"})]})]})})]})})]}),(le||re)&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>{F(!1),R(!1)}})]})}export{ct as default};
