import{H as me,I as xe,U as pe,r as m,b as ge,p as F,J as ye,j as e,a0 as E,y as he,Y as be,K as fe,q as je,B as J,a1 as Ne,k as X,N as Z,Q as ve,a2 as O,a3 as $,z as h,G as Ce}from"./index-adke7x0a.js";import{u as ee}from"./useMutation-lnV0fZGx.js";import{a as k}from"./appointmentService-iZUBgpzF.js";const te={SCHEDULED:"bg-blue-100 text-blue-700",CONFIRMED:"bg-indigo-100 text-indigo-700",COMPLETED:"bg-green-100 text-green-700",CANCELLED:"bg-red-100 text-red-700",NO_SHOW:"bg-gray-100 text-gray-700"},we=[{key:"all",label:"All"},{key:"SCHEDULED",label:"Scheduled"},{key:"COMPLETED",label:"Completed"},{key:"CANCELLED",label:"Cancelled"}],Se=[{value:"CONSULTATION",label:"Consultation"},{value:"FOLLOW_UP",label:"Follow-up"},{value:"PROCEDURE",label:"Procedure"},{value:"EMERGENCY",label:"Emergency"}],C=a=>{const c=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return`${c}-${n}-${l}`},I=a=>{if(!a||typeof a!="string")return"";const c=a.trim(),n=/^(\d{2})\/(\d{2})\/(\d{4})$/.exec(c);if(!n)return"";const[,l,b,d]=n,o=Number(l),x=Number(b),i=Number(d);if(!o||!x||!i||x<1||x>12||o<1||o>31)return"";const f=new Date(i,x-1,o);return f.getFullYear()!==i||f.getMonth()!==x-1||f.getDate()!==o?"":`${d}-${b}-${l}`},De=a=>{if(!a||typeof a!="string"||!a.includes("-"))return"";const[c,n,l]=a.split("-");return!c||!n||!l?"":`${l}/${n}/${c}`};function Pe(){var K,W,B,_,G;const[a,c]=me(),n=xe(),l=pe(),[b,d]=m.useState(a.get("action")==="new"||l.pathname.endsWith("/new")),[o,x]=m.useState("all"),[i,f]=m.useState("today"),[p,q]=m.useState({start:"",end:""}),[M,se]=m.useState(""),[j,N]=m.useState(1),[R,U]=m.useState(null),Y=10;m.useEffect(()=>{(a.get("action")==="new"||l.pathname.endsWith("/new"))&&(d(!0),c({},{replace:!0}))},[a,c,l.pathname]);const{register:w,handleSubmit:ae,reset:P,control:A,formState:{errors:S}}=ge(),re=()=>{const t=new Date;if(t.setHours(0,0,0,0),i==="today")return{startDate:C(t),endDate:C(t)};if(i==="week"){const s=new Date(t);return s.setDate(t.getDate()+7),{startDate:C(t),endDate:C(s)}}else if(i==="custom"&&p.start&&p.end){const s=I(p.start),r=I(p.end);return!s||!r?{}:{startDate:s,endDate:r}}return{}},{data:y,isLoading:le}=F({queryKey:["appointments",j,Y,o,i,p,M],queryFn:()=>k.getAppointments({page:j,limit:Y,status:o==="all"?void 0:o,search:M||void 0,...re()}),placeholderData:t=>t}),H=(y==null?void 0:y.data)||[],D=((K=y==null?void 0:y.pagination)==null?void 0:K.totalPages)||1,{data:L}=F({queryKey:["patients-list"],queryFn:()=>Ce.getPatients({limit:100})}),ne=((L==null?void 0:L.data)||[]).map(t=>({value:t.id,label:`${t.name} (${t.patientId||`P${String(t.id).padStart(5,"0")}`})`})),{data:T}=F({queryKey:["doctors-list"],queryFn:()=>k.getDoctors(),enabled:b}),oe=((T==null?void 0:T.data)||[]).map(t=>({value:t.id,label:t.name})),z=ee({mutationFn:k.createAppointment,onSuccess:()=>{h.success("Appointment created successfully"),n.invalidateQueries({queryKey:["appointments"]}),d(!1),P()},onError:t=>{var s,r;h.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to create appointment")}}),ie=ee({mutationFn:({id:t,status:s})=>k.updateStatus(t,s),onSuccess:()=>{h.success("Status updated"),n.invalidateQueries({queryKey:["appointments"]}),U(null)},onError:t=>{var s,r;h.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update status")}}),ce=t=>{var r,u,g;const s=I(t.date);if(!s){h.error("Use date format dd/mm/yyyy");return}try{if(s&&t.time&&new Date(`${s}T${t.time}`)<new Date){h.error("Appointment date and time cannot be in the past");return}}catch{}z.mutate({patientId:(r=t.patient)==null?void 0:r.value,date:s,timeSlot:t.time,type:((u=t.type)==null?void 0:u.value)||"CONSULTATION",symptoms:t.reason,notes:t.notes,doctorId:(g=t.doctor)==null?void 0:g.value})},v=(t,s)=>{ie.mutate({id:t,status:s})},de=t=>{if(!t)return"-";const[s,r]=t.split(":"),u=parseInt(s,10),g=u>=12?"PM":"AM";return`${u%12||12}:${r} ${g}`},ue=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",Q=ye("appointments:create",["DOCTOR","SUPER_ADMIN","RECEPTIONIST"]);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointments"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage and schedule patient appointments"})]}),Q&&e.jsx(E,{iconLeft:he,onClick:()=>d(!0),children:"New Appointment"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"text-gray-400"}),e.jsxs("select",{value:i,onChange:t=>{f(t.target.value),N(1)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"custom",children:"Custom Range"})]})]}),i==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",inputMode:"numeric",value:p.start,onChange:t=>q(s=>({...s,start:t.target.value})),placeholder:"dd/mm/yyyy",className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"text",inputMode:"numeric",value:p.end,onChange:t=>q(s=>({...s,end:t.target.value})),placeholder:"dd/mm/yyyy",className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:M,onChange:t=>{se(t.target.value),N(1)},placeholder:"Search by patient name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex gap-2 mt-4 pt-4 border-t border-gray-100",children:we.map(t=>e.jsx("button",{onClick:()=>{x(t.key),N(1)},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o===t.key?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:t.label},t.key))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible",children:[e.jsx("div",{className:"overflow-x-auto overflow-y-visible",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Time"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Type"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{children:le?[...Array(5)].map((t,s)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})})]},s)):H.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center",children:[e.jsx(je,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No appointments found"})]})}):H.map(t=>{var s,r,u,g;return e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:de(t.timeSlot)}),e.jsx("p",{className:"text-sm text-gray-500",children:ue(t.date)})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((r=(s=t.patient)==null?void 0:s.name)==null?void 0:r.charAt(0))||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((u=t.patient)==null?void 0:u.name)||"Unknown Patient"}),e.jsx("p",{className:"text-sm text-gray-500",children:((g=t.patient)==null?void 0:g.phone)||"-"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"capitalize text-gray-700",children:t.type||"Consultation"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium capitalize ${te[t.status]||te.scheduled}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 relative overflow-visible",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{onClick:()=>U(R===t.id?null:t.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ne,{className:"text-gray-400"})}),R===t.id&&e.jsxs("div",{className:"absolute right-0 bottom-full mb-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20",children:[t.status!=="COMPLETED"&&e.jsxs("button",{onClick:()=>v(t.id,"COMPLETED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(X,{className:"text-green-500"}),"Mark Completed"]}),t.status==="REVIEW"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>v(t.id,"SCHEDULED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(X,{className:"text-green-500"}),"Approve (Schedule)"]}),e.jsxs("button",{onClick:()=>v(t.id,"CANCELLED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Z,{className:"text-red-500"}),"Reject"]})]}),t.status!=="CANCELLED"&&e.jsxs("button",{onClick:()=>v(t.id,"CANCELLED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Z,{className:"text-red-500"}),"Cancel"]}),t.status==="CANCELLED"&&e.jsxs("button",{onClick:()=>v(t.id,"SCHEDULED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(J,{className:"text-blue-500"}),"Reschedule"]})]})]})})]},t.id)})})]})}),D>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",j," of ",D]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(t=>Math.max(1,t-1)),disabled:j===1,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),e.jsx("button",{onClick:()=>N(t=>Math.min(D,t+1)),disabled:j===D,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})]}),e.jsx(ve,{isOpen:b,onClose:()=>{d(!1),P()},title:"New Appointment",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"secondary",onClick:()=>{d(!1),P()},children:"Cancel"}),Q?e.jsx(E,{onClick:ae(ce),loading:z.isPending,children:"Create Appointment"}):e.jsx(E,{variant:"secondary",disabled:!0,children:"Permission required"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(O,{label:"Patient",name:"patient",control:A,options:ne,placeholder:"Search and select patient...",rules:{required:"Patient is required"},error:(W=S.patient)==null?void 0:W.message,isSearchable:!0}),e.jsx(O,{label:"Doctor",name:"doctor",control:A,options:oe,placeholder:"Select doctor (optional)",error:(B=S.doctor)==null?void 0:B.message,isSearchable:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx($,{label:"Date",type:"text",inputMode:"numeric",placeholder:"dd/mm/yyyy",helperText:`Today: ${De(C(new Date))}`,...w("date",{required:"Date is required"}),error:(_=S.date)==null?void 0:_.message}),e.jsx($,{label:"Time",type:"time",...w("time",{required:"Time is required"}),error:(G=S.time)==null?void 0:G.message})]}),e.jsx(O,{label:"Appointment Type",name:"type",control:A,options:Se,placeholder:"Select type..."}),e.jsx($,{label:"Reason for Visit",placeholder:"Brief description...",...w("reason")}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Notes"}),e.jsx("textarea",{...w("notes"),rows:3,placeholder:"Additional notes...",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]})})]})})}export{Pe as default};
