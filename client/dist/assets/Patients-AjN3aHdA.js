import{u as U,H as V,I as Y,r as x,J,b as W,p as X,j as e,y as Z,K as ee,M as se,N as te,q as M,O as re,P as ae,Q as le,z as O,G as B,R as ne,S as oe}from"./index-BKdfnJ0H.js";import{u as ie}from"./useMutation-C5UsUZj5.js";function xe(){var A,D;const E=U(),[m,b]=V(),I=Y(),[g,S]=x.useState(m.get("search")||""),[l,i]=x.useState(1),[y,H]=x.useState(!1),[T,u]=x.useState(m.get("action")==="new"),[a,F]=x.useState({gender:"",fromDate:"",toDate:""}),h=10,f=J("patients:create",["SUPER_ADMIN","DOCTOR","RECEPTIONIST"]);x.useEffect(()=>{const s=m.get("action"),t=m.get("search");s==="new"&&(f&&u(!0),b({},{replace:!0})),t&&(S(t),b({},{replace:!0}))},[m,b,f]);const{register:n,handleSubmit:q,reset:j,formState:{errors:p}}=W(),{data:o,isLoading:P,isError:L}=X({queryKey:["patients",l,h,g,a],queryFn:()=>B.getAll({page:l,limit:h,search:g,...a}),placeholderData:s=>s}),N=ie({mutationFn:s=>B.createPatient(s),onSuccess:()=>{O.success("Patient added successfully"),I.invalidateQueries(["patients"]),u(!1),j()},onError:s=>{var t,r;O.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to add patient")}}),R=s=>{const t=s.allergies?s.allergies.split(",").map(c=>c.trim()).filter(Boolean):void 0,r=s.medicalHistory?s.medicalHistory.split(`
`).map(c=>c.trim()).filter(Boolean):void 0;N.mutate({...s,dateOfBirth:s.dateOfBirth||void 0,allergies:t,medicalHistory:r,insurance:s.insurance||void 0})},v=(o==null?void 0:o.data)||[],d=((A=o==null?void 0:o.pagination)==null?void 0:A.totalPages)||1,C=((D=o==null?void 0:o.pagination)==null?void 0:D.total)||0,G=s=>{S(s.target.value),i(1)},w=(s,t)=>{F(r=>({...r,[s]:t})),i(1)},Q=()=>{F({gender:"",fromDate:"",toDate:""}),i(1)},$=s=>{E(`/patients/${s}`)},z=s=>(s==null?void 0:s.toLowerCase())==="male"?e.jsx(ne,{className:"text-blue-500"}):(s==null?void 0:s.toLowerCase())==="female"?e.jsx(oe,{className:"text-pink-500"}):e.jsx(M,{className:"text-gray-400"}),_=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"-",K=s=>{if(!s)return null;const t=new Date(s);if(Number.isNaN(t.getTime()))return null;const r=new Date;let c=r.getFullYear()-t.getFullYear();const k=r.getMonth()-t.getMonth();return(k<0||k===0&&r.getDate()<t.getDate())&&c--,c};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Patients"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage and view all patient records"})]}),f&&e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(Z,{}),"Add Patient"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:G,placeholder:"Search by name, phone, or patient ID...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),e.jsxs("button",{onClick:()=>H(!y),className:`inline-flex items-center gap-2 px-4 py-2.5 border rounded-lg font-medium transition ${y||a.gender||a.fromDate||a.toDate?"border-blue-500 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(se,{}),"Filters",(a.gender||a.fromDate||a.toDate)&&e.jsx("span",{className:"bg-blue-600 text-white text-xs px-1.5 py-0.5 rounded-full",children:[a.gender,a.fromDate,a.toDate].filter(Boolean).length})]})]}),y&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{value:a.gender,onChange:s=>w("gender",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:a.fromDate,onChange:s=>w("fromDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:a.toDate,onChange:s=>w("toDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:Q,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition",children:[e.jsx(te,{}),"Clear Filters"]})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient ID"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Name"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Phone"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Age"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Gender"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Last Visit"})]})}),e.jsx("tbody",{children:P?[...Array(5)].map((s,t)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})})]},t)):L?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx("div",{className:"text-red-500 mb-2",children:"Failed to load patients"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"text-blue-600 hover:underline",children:"Try again"})]})}):v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx(M,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No patients found"}),g&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filters"})]})}):v.map(s=>{var t;return e.jsxs("tr",{onClick:()=>$(s.id),className:"border-b border-gray-50 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:s.patientId||`P${String(s.id).padStart(5,"0")}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((t=s.name)==null?void 0:t.charAt(0))||"P"})}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.phone||"-"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.age?`${s.age} yrs`:s.dateOfBirth?`${K(s.dateOfBirth)} yrs`:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[z(s.gender),e.jsx("span",{className:"text-gray-600 capitalize",children:s.gender||"-"})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:_(s.lastVisit)})]},s.id)})})]})}),!P&&v.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",(l-1)*h+1," to"," ",Math.min(l*h,C)," of ",C," patients"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(s=>Math.max(1,s-1)),disabled:l===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(re,{className:"text-gray-600"})}),[...Array(Math.min(5,d))].map((s,t)=>{let r;return d<=5||l<=3?r=t+1:l>=d-2?r=d-4+t:r=l-2+t,e.jsx("button",{onClick:()=>i(r),className:`w-10 h-10 rounded-lg font-medium transition ${l===r?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:r},r)}),e.jsx("button",{onClick:()=>i(s=>Math.min(d,s+1)),disabled:l===d,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(ae,{className:"text-gray-600"})})]})]})]})]}),e.jsx(le,{isOpen:T,onClose:()=>{u(!1),j()},title:"Add New Patient",size:"lg",children:e.jsxs("form",{onSubmit:q(R),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...n("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Patient name"}),p.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",...n("phone",{required:"Phone is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10-digit phone number"}),p.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",...n("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",...n("dateOfBirth"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{...n("gender"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"MALE",children:"Male"}),e.jsx("option",{value:"FEMALE",children:"Female"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),e.jsxs("select",{...n("bloodGroup"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select blood group"}),e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{...n("address"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Allergies (comma separated)"}),e.jsx("input",{type:"text",...n("allergies"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g. Penicillin, Pollen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Insurance"}),e.jsx("input",{type:"text",...n("insurance"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Insurance provider / policy"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medical History (one per line)"}),e.jsx("textarea",{...n("medicalHistory"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe medical history entries, one per line"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),j()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:N.isPending?"Saving...":"Save Patient"})]})]})})]})}export{xe as default};
