import{u as R,I as z,r as x,p as O,J as U,j as e,L as W,a0 as V,y as _,K as $,a4 as q,d as B,a5 as H,a6 as K,O as T,P as G,Q as J,a7 as X,n as Y,z as g}from"./index-adke7x0a.js";import{u as Z}from"./useMutation-lnV0fZGx.js";import{p as C}from"./prescriptionService-Dh_4XLSu.js";function ae(){var N,f,v,w;const u=R();z();const[d,F]=x.useState(""),[l,m]=x.useState(1),[k,h]=x.useState(!1),[r,p]=x.useState(null),c=10,{data:t,isLoading:M}=O({queryKey:["prescriptions",l,c,d],queryFn:()=>C.getPrescriptions({page:l,limit:c,search:d||void 0}),placeholderData:s=>s,refetchInterval:5*60*1e3}),y=(t==null?void 0:t.data)||[],o=((N=t==null?void 0:t.pagination)==null?void 0:N.totalPages)||1,j=((f=t==null?void 0:t.pagination)==null?void 0:f.total)||0,n=Z({mutationFn:({id:s,method:a})=>C.sendPrescription(s,a),onSuccess:s=>{s.whatsappUrl?(window.open(s.whatsappUrl,"_blank"),g.success("WhatsApp opened. Send the message to complete.")):g.success("Prescription sent successfully"),h(!1),p(null)},onError:s=>{var a,i;g.error(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to send prescription")}}),A=s=>{F(s.target.value),m(1)},E=s=>{u(`/prescriptions/${s.id}`)},I=s=>{u(`/prescriptions/${s.id}?print=true`)},D=s=>{p(s),h(!0)},b=s=>{r&&n.mutate({id:r.id,method:s})},L=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",Q=U("prescriptions:create",["DOCTOR","ADMIN","SUPER_ADMIN"]);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Prescriptions"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View and manage patient prescriptions"})]}),Q&&e.jsx(W,{to:"/prescriptions/new",children:e.jsx(V,{iconLeft:_,children:"New Prescription"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:A,placeholder:"Search by patient name or prescription ID...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Prescription ID"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Diagnosis"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{children:M?[...Array(5)].map((s,a)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-40"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})})]},a)):y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center",children:[e.jsx(q,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No prescriptions found"}),d&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search term"})]})}):y.map(s=>{var a,i,P,S;return e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:s.prescriptionNo||`RX${String(s.id).padStart(5,"0")}`})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:L(s.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((i=(a=s.patient)==null?void 0:a.name)==null?void 0:i.charAt(0))||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((P=s.patient)==null?void 0:P.name)||"Unknown Patient"}),e.jsx("p",{className:"text-sm text-gray-500",children:((S=s.patient)==null?void 0:S.patientId)||"-"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-gray-700 truncate max-w-xs",children:s.diagnosis||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(s),className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View",children:e.jsx(B,{})}),e.jsx("button",{onClick:()=>I(s),className:"p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Print",children:e.jsx(H,{})}),e.jsx("button",{onClick:()=>D(s),className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Send",children:e.jsx(K,{})})]})})]},s.id)})})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",(l-1)*c+1," -"," ",Math.min(l*c,j)," of ",j," prescriptions"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(s=>Math.max(1,s-1)),disabled:l===1,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:e.jsx(T,{className:"text-gray-600"})}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",l," of ",o]}),e.jsx("button",{onClick:()=>m(s=>Math.min(o,s+1)),disabled:l===o,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:e.jsx(G,{className:"text-gray-600"})})]})]})]}),e.jsx(J,{isOpen:k,onClose:()=>{h(!1),p(null)},title:"Send Prescription",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"How would you like to send this prescription to the patient?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>b("whatsapp"),disabled:n.isPending,className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"text-green-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WhatsApp"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via WhatsApp to ",((v=r==null?void 0:r.patient)==null?void 0:v.phone)||"patient"]})]})]}),e.jsxs("button",{onClick:()=>b("email"),disabled:n.isPending,className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"text-blue-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Email"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via email to ",((w=r==null?void 0:r.patient)==null?void 0:w.email)||"patient"]})]})]})]}),n.isPending&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Sending..."}),n.isError&&e.jsx("p",{className:"text-center text-sm text-red-600",children:"Failed to send. Please try again."}),n.isSuccess&&e.jsx("p",{className:"text-center text-sm text-green-600",children:"Prescription sent successfully!"})]})})]})})}export{ae as default};
