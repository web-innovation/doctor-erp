import{I as Ee,u as Me,r as l,b as se,p as qe,j as e,J as j,y as ne,ah as Q,B as Fe,K as Re,C as Te,V as Ue,ae as Le,O as Be,P as Ve,Q as f,z as i}from"./index-DPyX6QYN.js";import{u as N}from"./useMutation-B_vLsH4g.js";import{p as x}from"./pharmacyService-BNPpzPf8.js";const Qe=[{id:"all",label:"All Products"},{id:"lowStock",label:"Low Stock"},{id:"expiring",label:"Expiring Soon"}];function He(){var Z,ee;const g=Ee(),v=Me(),[S,re]=l.useState("all"),[k,ae]=l.useState(""),[p,w]=l.useState(1),[le,P]=l.useState(!1),[ie,C]=l.useState(!1),[oe,O]=l.useState(!1),[a,o]=l.useState(null),D=10,{register:r,handleSubmit:G,reset:h,setValue:c,formState:{errors:m}}=se({defaultValues:{name:"",sku:"",genericName:"",category:"",unit:"units",price:"",costPrice:"",stock:"0",minStock:"10",expiryDate:""}}),{register:y,handleSubmit:ce,reset:A}=se({defaultValues:{type:"addition",quantity:"",notes:"",expiryDate:"",batchNumber:""}}),{data:d,isLoading:de}=qe({queryKey:["products",S,p,D,k],queryFn:()=>{const t={page:p,limit:D,search:k};return S==="lowStock"?t.stockStatus="low":S==="expiring"&&(t.expiringWithin=30),x.getProducts(t)},placeholderData:t=>t}),z=(d==null?void 0:d.data)||[],M=((Z=d==null?void 0:d.pagination)==null?void 0:Z.totalPages)||1,$=((ee=d==null?void 0:d.pagination)==null?void 0:ee.total)||0,q=N({mutationFn:t=>x.createProduct(t),onSuccess:()=>{i.success("Product added successfully"),g.invalidateQueries(["products"]),P(!1),h()},onError:t=>{var s,n;i.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to add product")}}),F=N({mutationFn:({id:t,data:s})=>x.updateProduct(t,s),onSuccess:()=>{i.success("Product updated successfully"),g.invalidateQueries(["products"]),C(!1),o(null),h()},onError:t=>{var s,n;i.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to update product")}}),R=N({mutationFn:t=>x.updateStock(t.id,t),onSuccess:()=>{i.success("Stock updated successfully"),g.invalidateQueries(["products"]),O(!1),o(null),A()},onError:t=>{var s,n;i.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to update stock")}}),ue=N({mutationFn:t=>x.updateProduct(t,{isActive:!1}),onSuccess:()=>{i.success("Product deleted successfully"),g.invalidateQueries(["products"])},onError:t=>{var s,n;i.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to delete product")}}),me=t=>{ae(t.target.value),w(1)},xe=t=>{re(t),w(1)},pe=t=>{q.mutate({code:t.sku||void 0,name:t.name,genericName:t.genericName,category:t.category,mrp:parseFloat(t.price),sellingPrice:parseFloat(t.price),purchasePrice:t.costPrice?parseFloat(t.costPrice):void 0,quantity:parseInt(t.stock)||0,minStock:t.minStock?parseInt(t.minStock):10,unit:t.unit||"pcs",expiryDate:t.expiryDate||void 0})},ge=t=>{a&&F.mutate({id:a.id,data:{name:t.name,genericName:t.genericName,category:t.category,mrp:parseFloat(t.price),sellingPrice:parseFloat(t.price),purchasePrice:t.costPrice?parseFloat(t.costPrice):void 0,minStock:t.minStock?parseInt(t.minStock):10,unit:t.unit||"pcs",expiryDate:t.expiryDate||void 0}})},he=t=>{o(t),c("name",t.name),c("sku",t.code),c("genericName",t.genericName||""),c("category",t.category||""),c("price",t.sellingPrice||t.mrp||""),c("costPrice",t.purchasePrice||""),c("minStock",t.minStock||10),c("unit",t.unit||"pcs"),c("expiryDate",t.expiryDate?t.expiryDate.split("T")[0]:""),C(!0)},be=t=>{if(!a)return;const s={addition:"PURCHASE",subtraction:"SALE",adjustment:"ADJUSTMENT"};R.mutate({id:a.id,quantity:parseInt(t.quantity),type:s[t.type]||"ADJUSTMENT",notes:t.notes,expiryDate:t.expiryDate||void 0,batchNumber:t.batchNumber||void 0})},ye=t=>{o(t),A({type:"addition",quantity:"",notes:""}),O(!0)},[je,H]=l.useState(!1),[_,T]=l.useState([]),[fe,J]=l.useState(!1),[Ne,I]=l.useState(!1),[E,K]=l.useState(null),[X,ve]=l.useState(new Date().toISOString().slice(0,10)),[U,Se]=l.useState("Opening Stock Adjustment"),[u,L]=l.useState(null),[W,B]=l.useState([]),b=N({mutationFn:async({dryRun:t})=>{if(!E)throw new Error("Please choose a CSV file");const s=new FormData;return s.append("file",E),x.importOpeningStock(s,{dryRun:t,openingDate:X,creditAccountName:U})},onSuccess:async(t,s)=>{L((t==null?void 0:t.summary)||null),B((t==null?void 0:t.errors)||[]),s.dryRun?((t==null?void 0:t.errors)||[]).length===0?i.success("Validation successful. You can import now."):i.error("Validation found issues. Please fix the CSV and retry."):(i.success("Opening stock imported successfully"),g.invalidateQueries(["products"]),g.invalidateQueries(["dashboardStats"]),I(!1),K(null),L(null),B([]))},onError:t=>{var s,n;i.error(((n=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Opening stock import failed")}}),ke=async()=>{try{const t=await x.downloadOpeningStockTemplate(),s=window.URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="opening_stock_import_sample.csv",document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(s)}catch{i.error("Failed to download template")}},we=async t=>{o(t),H(!0),J(!0);try{const s=await x.getBatches(t.id);T(s.data||[])}catch{T([])}finally{J(!1)}},Pe=t=>{window.confirm(`Are you sure you want to delete "${t.name}"?`)&&ue.mutate(t.id)},Ce=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",V=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(t||0),Y=t=>t.quantity<(t.minStock||10),Oe=t=>{if(!t.expiryDate)return!1;const s=new Date(t.expiryDate),n=new Date;return n.setDate(n.getDate()+30),s<=n};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pharmacy"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage inventory and stock levels"})]}),e.jsxs("div",{className:"flex gap-2",children:[j("pharmacy:create",["SUPER_ADMIN","DOCTOR","PHARMACIST"])&&e.jsxs("button",{onClick:()=>P(!0),className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(ne,{}),"Add Product"]}),j("purchases:create",["SUPER_ADMIN","ACCOUNTANT","PHARMACIST"])&&e.jsxs("button",{type:"button",onClick:()=>v("/pharmacy/upload"),className:"inline-flex items-center justify-center gap-2 bg-indigo-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-indigo-700 transition",children:[e.jsx(Q,{}),"Upload Invoice"]}),j("pharmacy:create",["SUPER_ADMIN","DOCTOR","PHARMACIST"])&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:ke,className:"inline-flex items-center justify-center gap-2 bg-slate-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-slate-700 transition",children:"Download Import Template"}),e.jsx("button",{type:"button",onClick:()=>I(!0),className:"inline-flex items-center justify-center gap-2 bg-violet-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-violet-700 transition",children:"Import Opening Stock"})]}),j("purchases:read",["SUPER_ADMIN","ACCOUNTANT","PHARMACIST"])&&e.jsx("button",{type:"button",onClick:()=>v("/pharmacy/purchases"),className:"inline-flex items-center justify-center gap-2 bg-gray-700 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-gray-800 transition",children:"Draft Purchase"}),j("purchases:read",["SUPER_ADMIN","ACCOUNTANT","PHARMACIST"])&&e.jsx("button",{type:"button",onClick:()=>v("/pharmacy/suppliers"),className:"inline-flex items-center justify-center gap-2 bg-teal-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-teal-700 transition",children:"Suppliers"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-6",children:[e.jsx("div",{className:"flex border-b border-gray-100",children:Qe.map(t=>e.jsxs("button",{onClick:()=>xe(t.id),className:`flex-1 px-4 py-3 text-sm font-medium transition ${S===t.id?"text-blue-600 border-b-2 border-blue-600 bg-blue-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[t.label,t.id==="lowStock"&&e.jsx("span",{className:"ml-2 bg-red-100 text-red-600 px-2 py-0.5 rounded-full text-xs",children:"!"}),t.id==="expiring"&&e.jsx("span",{className:"ml-2 bg-yellow-100 text-yellow-600 px-2 py-0.5 rounded-full text-xs",children:e.jsx(Fe,{className:"inline w-3 h-3"})})]},t.id))}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:me,placeholder:"Search by product name or code...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:de?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(Q,{className:"text-4xl mb-4"}),e.jsx("p",{className:"font-medium",children:"No products found"}),e.jsx("p",{className:"text-sm mt-1",children:k?"Try adjusting your search":"Add your first product to get started"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"MRP"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Expiry"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:z.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-mono text-gray-600",children:t.code||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),t.category&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:t.category})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-sm font-medium ${Y(t)?"text-red-600":"text-gray-900"}`,children:[t.quantity," ",t.unit||"units"]}),Y(t)&&e.jsx(Te,{className:"text-red-500 text-xs"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-gray-900",children:V(t.sellingPrice||t.mrp)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm ${Oe(t)?"text-yellow-600 font-medium":"text-gray-600"}`,children:Ce(t.expiryDate)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:()=>ye(t),className:"inline-flex items-center gap-1 px-3 py-1.5 bg-green-50 text-green-600 rounded-lg text-sm font-medium hover:bg-green-100 transition",children:[e.jsx(ne,{className:"text-xs"}),"Stock"]}),e.jsxs("button",{onClick:()=>we(t),className:"inline-flex items-center gap-1 px-3 py-1.5 bg-gray-50 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100 transition",children:[e.jsx(Q,{className:"text-xs"}),"Batches"]}),e.jsx("button",{onClick:()=>he(t),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition",children:e.jsx(Ue,{})}),e.jsx("button",{onClick:()=>Pe(t),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition",children:e.jsx(Le,{})})]})})]},t.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(p-1)*D+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(p*D,$)})," ","of ",e.jsx("span",{className:"font-medium",children:$})," products"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(t=>Math.max(1,t-1)),disabled:p===1,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition",children:e.jsx(Be,{className:"text-gray-600"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",p," of ",M]}),e.jsx("button",{onClick:()=>w(t=>Math.min(M,t+1)),disabled:p===M,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition",children:e.jsx(Ve,{className:"text-gray-600"})})]})]})]})})]}),e.jsx(f,{isOpen:le,onClose:()=>{P(!1),h()},title:"Add New Product",size:"lg",children:e.jsxs("form",{onSubmit:G(pe),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...r("name",{required:"Product name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter product name"}),m.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU / Code"}),e.jsx("input",{...r("sku"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter SKU or product code"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Generic Name"}),e.jsx("input",{...r("genericName"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter generic name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{...r("category"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Tablets",children:"Tablets"}),e.jsx("option",{value:"Capsules",children:"Capsules"}),e.jsx("option",{value:"Syrups",children:"Syrups"}),e.jsx("option",{value:"Injections",children:"Injections"}),e.jsx("option",{value:"Drops",children:"Drops"}),e.jsx("option",{value:"Ointments",children:"Ointments"}),e.jsx("option",{value:"Supplies",children:"Supplies"}),e.jsx("option",{value:"Equipment",children:"Equipment"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),e.jsxs("select",{...r("unit"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"units",children:"Units"}),e.jsx("option",{value:"strips",children:"Strips"}),e.jsx("option",{value:"bottles",children:"Bottles"}),e.jsx("option",{value:"boxes",children:"Boxes"}),e.jsx("option",{value:"packs",children:"Packs"}),e.jsx("option",{value:"ml",children:"ML"}),e.jsx("option",{value:"gm",children:"GM"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["MRP (₹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",...r("price",{required:"MRP is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),m.price&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",...r("costPrice"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Stock"}),e.jsx("input",{type:"number",...r("stock"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0",defaultValue:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Stock Level"}),e.jsx("input",{type:"number",...r("minStock"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manufacturer"}),e.jsx("input",{...r("manufacturer"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter manufacturer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",...r("expiryDate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",...r("requiresPrescription"),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Requires Prescription"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>{P(!1),h()},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:q.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:q.isPending?"Adding...":"Add Product"})]})]})}),e.jsx(f,{isOpen:oe,onClose:()=>{O(!1),o(null),A()},title:"Update Stock",size:"md",children:a&&e.jsxs("form",{onSubmit:ce(be),className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Current Stock:"," ",e.jsxs("span",{className:"font-medium",children:[a.quantity," ",a.unit||"units"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Transaction Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...y("type",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"addition",children:"Add Stock"}),e.jsx("option",{value:"subtraction",children:"Remove Stock"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",...y("quantity",{required:!0,min:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter quantity"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch Number"}),e.jsx("input",{...y("batchNumber"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional batch number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",...y("expiryDate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{...y("notes"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Optional notes for this transaction"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-3 pt-4 border-t border-gray-100",children:[e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>{const t=(document.querySelector('input[name="quantity"]')||{}).value||"",s=(document.querySelector('input[name="batchNumber"]')||{}).value||"",n=(document.querySelector('input[name="expiryDate"]')||{}).value||"",De={addition:"PURCHASE",subtraction:"RETURN",adjustment:"JOURNAL"},te=document.querySelector('select[name="type"]'),Ae=te&&De[te.value]||"JOURNAL",Ie=[{productId:a.id,name:a.name,quantity:Number(t)||0,unitPrice:a.purchasePrice||a.mrp||0,gstPercent:a.gstPercent||0,batchNumber:s||void 0,expiryDate:n||void 0}];localStorage.setItem("manualPrefill",JSON.stringify({mode:Ae,items:Ie})),v("/ledger/manual")},className:"px-3 py-2 text-sm border rounded text-gray-700 bg-yellow-50 hover:bg-yellow-100",children:"Create Manual Entry"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),o(null),A()},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:R.isPending,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:R.isPending?"Updating...":"Update Stock"})]})]})]})}),e.jsx(f,{isOpen:je,onClose:()=>{H(!1),o(null),T([])},title:`Batches — ${(a==null?void 0:a.name)||""}`,size:"md",children:fe?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"Loading batches…"}):_.length===0?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"No batches found for this product."}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Batch"}),e.jsx("th",{className:"text-left p-2",children:"Expiry"}),e.jsx("th",{className:"text-right p-2",children:"Qty"}),e.jsx("th",{className:"text-right p-2",children:"Cost"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:t.batchNumber||"-"}),e.jsx("td",{className:"p-2",children:t.expiryDate?new Date(t.expiryDate).toLocaleDateString("en-GB"):"-"}),e.jsx("td",{className:"p-2 text-right",children:t.quantity}),e.jsx("td",{className:"p-2 text-right",children:V(t.costPrice)})]},t.id))})]})})}),e.jsx(f,{isOpen:Ne,onClose:()=>{I(!1),L(null),B([])},title:"Import Opening Stock",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Upload the CSV or XLSX template to bulk add existing stock at clinic onboarding. This creates one consolidated ledger entry: Debit ",e.jsx("strong",{children:"Inventory"}),", Credit ",e.jsx("strong",{children:U||"Opening Stock Adjustment"}),"."]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Date"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",value:X,onChange:t=>ve(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Credit Account"}),e.jsx("input",{value:U,onChange:t=>Se(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Opening Stock Adjustment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CSV or XLSX File"}),e.jsx("input",{type:"file",accept:".csv,text/csv,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:t=>{var s;return K(((s=t.target.files)==null?void 0:s[0])||null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),u&&e.jsxs("div",{className:"p-3 rounded border bg-gray-50 text-sm",children:[e.jsxs("div",{children:["Rows: ",e.jsx("strong",{children:u.rows||0})]}),e.jsxs("div",{children:["Total Stock Value: ",e.jsx("strong",{children:V(u.totalStockValue||0)})]}),u.ledgerPreview&&e.jsxs("div",{className:"text-gray-600 mt-1",children:["Ledger Preview: Dr ",u.ledgerPreview.debitAccount," / Cr ",u.ledgerPreview.creditAccount]}),u.ledgerPosted&&e.jsxs("div",{className:"text-gray-600 mt-1",children:["Ledger Posted: Dr ",u.ledgerPosted.debitAccount," / Cr ",u.ledgerPosted.creditAccount]})]}),W.length>0&&e.jsx("div",{className:"p-3 rounded border border-red-200 bg-red-50 text-sm text-red-700 max-h-40 overflow-auto",children:W.map((t,s)=>e.jsxs("div",{children:[t.sheet?`Sheet ${t.sheet}, `:"","Line ",t.line,": ",t.field," - ",t.message]},`${t.line}-${t.field}-${s}`))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>I(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"button",disabled:b.isPending||!E,onClick:()=>b.mutate({dryRun:!0}),className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition disabled:opacity-50",children:b.isPending?"Validating...":"Validate File"}),e.jsx("button",{type:"button",disabled:b.isPending||!E,onClick:()=>b.mutate({dryRun:!1}),className:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition disabled:opacity-50",children:b.isPending?"Importing...":"Import Stock"})]})]})}),e.jsx(f,{isOpen:ie,onClose:()=>{C(!1),o(null),h()},title:"Edit Product",size:"lg",children:e.jsxs("form",{onSubmit:G(ge),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...r("name",{required:"Product name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter product name"}),m.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU / Code"}),e.jsx("input",{...r("sku"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100",placeholder:"SKU",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Generic Name"}),e.jsx("input",{...r("genericName"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter generic name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{...r("category"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Tablets",children:"Tablets"}),e.jsx("option",{value:"Capsules",children:"Capsules"}),e.jsx("option",{value:"Syrups",children:"Syrups"}),e.jsx("option",{value:"Injections",children:"Injections"}),e.jsx("option",{value:"Drops",children:"Drops"}),e.jsx("option",{value:"Ointments",children:"Ointments"}),e.jsx("option",{value:"Supplies",children:"Supplies"}),e.jsx("option",{value:"Equipment",children:"Equipment"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),e.jsxs("select",{...r("unit"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"units",children:"Units"}),e.jsx("option",{value:"strips",children:"Strips"}),e.jsx("option",{value:"bottles",children:"Bottles"}),e.jsx("option",{value:"boxes",children:"Boxes"}),e.jsx("option",{value:"packs",children:"Packs"}),e.jsx("option",{value:"ml",children:"ML"}),e.jsx("option",{value:"gm",children:"GM"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["MRP (₹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",...r("price",{required:"MRP is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),m.price&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",...r("costPrice"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Stock Level"}),e.jsx("input",{type:"number",...r("minStock"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",...r("expiryDate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),o(null),h()},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:F.isPending?"Saving...":"Save Changes"})]})]})})]})}export{He as default};
