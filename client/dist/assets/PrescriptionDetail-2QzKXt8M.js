import{T as D,u as C,r as T,p,j as e,l as q,a5 as M,a6 as W,g as L,$ as U,a8 as E,a9 as z,aa as B,Z as H,ab as I,Q as K,a7 as $,n as O,z as c,D as f}from"./index-CfZ_Qhs7.js";import{p as v}from"./prescriptionService-BxOp1j4b.js";import{r as Q}from"./printTemplates-BhPuBDug.js";function V(){var j,N,b,u,y;const{id:i}=D(),h=C(),[w,d]=T.useState(!1),{data:x,isLoading:P,error:F}=p({queryKey:["prescription",i],queryFn:()=>v.getPrescription(i),enabled:!!i}),{data:S}=p({queryKey:["clinic-settings"],queryFn:()=>f.getClinicSettings()}),{data:k}=p({queryKey:["print-templates"],queryFn:()=>f.getPrintTemplates()}),t=x==null?void 0:x.data,A=()=>{if(!t)return;const s=window.open("","_blank");if(!s){c.error("Please allow popups to print");return}const r=Q(t,S||{},k||{});s.document.write(r),s.document.close(),s.onload=()=>s.print()},g=async s=>{var r,l;try{const n=await v.sendPrescription(i,s);n.whatsappUrl?(window.open(n.whatsappUrl,"_blank"),c.success("WhatsApp opened. Send the message to complete.")):c.success(`Prescription sent via ${s}`),d(!1)}catch(n){c.error(((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to send prescription")}},o=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-";if(P)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(F||!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load prescription"}),e.jsx("button",{onClick:()=>h("/prescriptions"),className:"text-blue-600 hover:underline",children:"Back to Prescriptions"})]})});const a=t.vitalsSnapshot||{},m=Array.isArray(t.diagnosis)?t.diagnosis:[];return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>h("/prescriptions"),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(q,{className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.prescriptionNo||`RX${String(t.id).padStart(5,"0")}`}),e.jsx("p",{className:"text-gray-500 mt-1",children:o(t.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:[e.jsx(M,{}),"Print"]}),e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(W,{}),"Send"]})]})]}),e.jsxs("div",{id:"prescription-print-area",className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-4",children:[e.jsx(L,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Patient Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Name"}),e.jsx("p",{className:"font-medium",children:((j=t.patient)==null?void 0:j.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Patient ID"}),e.jsx("p",{className:"font-medium",children:((N=t.patient)==null?void 0:N.patientId)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"font-medium",children:((b=t.patient)==null?void 0:b.phone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date"}),e.jsx("p",{className:"font-medium",children:o(t.createdAt)})]})]})]}),(a.bp||a.pulse||a.temp||a.spo2||a.weight)&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-4",children:[e.jsx(U,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Vitals"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.bp&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Blood Pressure"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.bp})]}),a.pulse&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pulse"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[a.pulse," bpm"]})]}),a.temp&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Temperature"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[a.temp,"Â°F"]})]}),a.spo2&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"SpO2"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[a.spo2,"%"]})]}),a.weight&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Weight"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[a.weight," kg"]})]})]})]}),(m.length>0||t.clinicalNotes)&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-4",children:[e.jsx(E,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Diagnosis & Notes"})]}),m.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Diagnosis"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,r)=>e.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm",children:s},r))})]}),t.clinicalNotes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Clinical Notes"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.clinicalNotes})]})]}),t.medicines&&t.medicines.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-4",children:[e.jsx(z,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Medicines"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"#"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Medicine"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Dosage"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Frequency"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Duration"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-600",children:"Timing"})]})}),e.jsx("tbody",{children:t.medicines.map((s,r)=>e.jsxs("tr",{className:"border-b border-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-500",children:r+1}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.medicineName}),s.genericName&&e.jsx("p",{className:"text-sm text-gray-500",children:s.genericName})]}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:s.dosage||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:s.frequency||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:s.duration||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:s.timing||"-"})]},s.id))})]})})]}),t.labTests&&t.labTests.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-600 mb-4",children:[e.jsx(B,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Lab Tests"})]}),e.jsx("div",{className:"space-y-3",children:t.labTests.map((s,r)=>{var l;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-sm font-medium",children:r+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.testName}),s.instructions&&e.jsx("p",{className:"text-sm text-gray-500",children:s.instructions}),((l=s.lab)==null?void 0:l.name)&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Lab: ",s.lab.name]})]})]},s.id)})})]}),t.advice&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-4",children:[e.jsx(H,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Advice"})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.advice})]}),t.followUpDate&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-teal-600 mb-4",children:[e.jsx(I,{}),e.jsx("h2",{className:"text-lg font-semibold",children:"Follow-up"})]}),e.jsxs("p",{className:"text-gray-700",children:["Next visit scheduled for: ",e.jsx("span",{className:"font-medium",children:o(t.followUpDate)})]})]})]}),e.jsx(K,{isOpen:w,onClose:()=>d(!1),title:"Send Prescription",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"How would you like to send this prescription to the patient?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>g("whatsapp"),className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"text-green-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WhatsApp"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via WhatsApp to ",((u=t.patient)==null?void 0:u.phone)||"patient"]})]})]}),e.jsxs("button",{onClick:()=>g("email"),className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"text-blue-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Email"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via email to ",((y=t.patient)==null?void 0:y.email)||"patient"]})]})]})]})]})})]})})}export{V as default};
