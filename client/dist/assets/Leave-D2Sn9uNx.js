import{I as ce,r as w,b as oe,p as R,J as k,j as e,y as xe,Y as me,B as F,o as X,as as q,M as ue,aw as ge,k as z,N as Y,d as pe,O as he,P as fe,Q as B,z as m,ar as f}from"./index-gKfW3Eho.js";import{u as _}from"./useMutation-BRI84MRi.js";const H=[{value:"CASUAL",label:"Casual Leave"},{value:"SICK",label:"Sick Leave"},{value:"EARNED",label:"Earned Leave"},{value:"UNPAID",label:"Unpaid Leave"}],W={PENDING:"bg-yellow-100 text-yellow-800 border-yellow-200",APPROVED:"bg-green-100 text-green-800 border-green-200",REJECTED:"bg-red-100 text-red-800 border-red-200"},je={PENDING:F,APPROVED:X,REJECTED:q};function Ne(){var K,$,Q;const j=ce(),[d,E]=w.useState(1),[l,u]=w.useState(""),[Z,y]=w.useState(!1),[a,g]=w.useState(null),b=10,{register:p,handleSubmit:ee,reset:D,watch:se,formState:{errors:i}}=oe(),te=se("startDate"),{data:C,isLoading:ae}=R({queryKey:["staff-list"],queryFn:()=>f.getAll({limit:100}),staleTime:3e4}),P=(C==null?void 0:C.data)||[],re=k("leaves:read"),le=k("leaves:create"),T=k("leaves:update"),{data:n,isLoading:ne,error:O}=R({queryKey:["leaves-list",d,b,l],queryFn:()=>f.getLeaves({page:d,limit:b,status:l||void 0}),staleTime:1e4}),I=(n==null?void 0:n.data)||[],S=((K=n==null?void 0:n.pagination)==null?void 0:K.totalPages)||1,M=(($=n==null?void 0:n.pagination)==null?void 0:$.total)||0,{data:A}=R({queryKey:["leaves-summary"],queryFn:()=>f.getLeaves({limit:500}),staleTime:3e4,refetchOnWindowFocus:!1}),N=(A==null?void 0:A.data)||[],v={total:N.length,pending:N.filter(s=>s.status==="PENDING").length,approved:N.filter(s=>s.status==="APPROVED").length,rejected:N.filter(s=>s.status==="REJECTED").length};if(!re)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-8 border border-gray-100 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"You don't have permission to view Leave Management."})]})})});const L=_({mutationFn:s=>f.applyLeave(s),onSuccess:()=>{m.success("Leave application submitted successfully"),j.invalidateQueries({queryKey:["leaves-list"]}),j.invalidateQueries({queryKey:["leaves-summary"]}),y(!1),D()},onError:s=>{var t,r;m.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to submit leave application")}}),o=_({mutationFn:({id:s,status:t})=>f.updateLeaveStatus(s,{status:t}),onSuccess:(s,t)=>{m.success(`Leave ${t.status.toLowerCase()} successfully`),j.invalidateQueries({queryKey:["leaves-list"]}),j.invalidateQueries({queryKey:["leaves-summary"]})},onError:s=>{var t,r;m.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update leave status")}}),ie=s=>{L.mutate({staffId:s.staffId,startDate:s.startDate,endDate:s.endDate,type:s.type,reason:s.reason})},G=s=>{if(!T){m.error("You don't have permission to update leave status");return}window.confirm(`Approve leave for ${x(s)}?`)&&o.mutate({id:s.id,status:"APPROVED"})},V=s=>{if(!T){m.error("You don't have permission to update leave status");return}window.confirm(`Reject leave for ${x(s)}?`)&&o.mutate({id:s.id,status:"REJECTED"})},h=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",U=(s,t)=>{if(!s||!t)return 0;const r=new Date(s),c=new Date(t),de=Math.abs(c-r);return Math.ceil(de/(1e3*60*60*24))+1},x=s=>{var t,r,c;return((r=(t=s.staff)==null?void 0:t.user)==null?void 0:r.name)||((c=s.staff)==null?void 0:c.name)||"Unknown Staff"},J=s=>{const t=H.find(r=>r.value===s);return(t==null?void 0:t.label)||s};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leave Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Review and manage staff leave requests"})]}),le?e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(xe,{}),"Apply Leave"]}):e.jsx("div",{className:"text-sm text-gray-500",children:"You don't have permission to apply for leave."})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(me,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.total})]})]})}),e.jsx("div",{className:`bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer transition hover:border-yellow-300 ${l==="PENDING"?"ring-2 ring-yellow-400":""}`,onClick:()=>u(l==="PENDING"?"":"PENDING"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center",children:e.jsx(F,{className:"text-yellow-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:v.pending})]})]})}),e.jsx("div",{className:`bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer transition hover:border-green-300 ${l==="APPROVED"?"ring-2 ring-green-400":""}`,onClick:()=>u(l==="APPROVED"?"":"APPROVED"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"text-green-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.approved})]})]})}),e.jsx("div",{className:`bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer transition hover:border-red-300 ${l==="REJECTED"?"ring-2 ring-red-400":""}`,onClick:()=>u(l==="REJECTED"?"":"REJECTED"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(q,{className:"text-red-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:v.rejected})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Filter:"}),e.jsxs("select",{value:l,onChange:s=>{u(s.target.value),E(1)},className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"All Requests"}),e.jsx("option",{value:"PENDING",children:"Pending Only"}),e.jsx("option",{value:"APPROVED",children:"Approved Only"}),e.jsx("option",{value:"REJECTED",children:"Rejected Only"})]})]}),l&&e.jsx("button",{onClick:()=>u(""),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear Filter"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):O?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-500",children:[e.jsx(q,{className:"text-4xl mb-4"}),e.jsx("p",{className:"font-medium",children:"Failed to load leave requests"}),e.jsx("p",{className:"text-sm mt-1",children:O.message})]}):I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(ge,{className:"text-4xl mb-4"}),e.jsx("p",{className:"font-medium",children:"No leave requests found"}),e.jsx("p",{className:"text-sm mt-1",children:l?"Try adjusting your filters":'Click "Apply Leave" to create the first request'})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-gray-100",children:I.map(s=>{var c;const t=je[s.status]||F,r=U(s.startDate,s.endDate);return e.jsx("div",{className:"p-4 hover:bg-gray-50 transition",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:x(s).charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:x(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:((c=s.staff)==null?void 0:c.designation)||"Staff"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-blue-50 text-blue-700 text-xs font-medium",children:J(s.type)}),e.jsxs("span",{className:"text-xs text-gray-500",children:[h(s.startDate)," - ",h(s.endDate)]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-700 text-xs font-medium",children:[r," day",r>1?"s":""]})]}),s.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",s.reason]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium border ${W[s.status]}`,children:[e.jsx(t,{className:"text-xs"}),s.status]}),s.status==="PENDING"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>G(s),disabled:o.isPending,className:"flex items-center gap-1.5 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 transition text-sm",children:[e.jsx(z,{}),"Approve"]}),e.jsxs("button",{onClick:()=>V(s),disabled:o.isPending,className:"flex items-center gap-1.5 px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 disabled:opacity-50 transition text-sm",children:[e.jsx(Y,{}),"Reject"]})]}),e.jsx("button",{onClick:()=>g(s),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition",title:"View Details",children:e.jsx(pe,{})})]})]})},s.id)})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100 bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",(d-1)*b+1," to"," ",Math.min(d*b,M)," of ",M," requests"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(s=>Math.max(1,s-1)),disabled:d===1,className:"p-2 border border-gray-300 rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(he,{className:"text-gray-600"})}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Page ",d," of ",S]}),e.jsx("button",{onClick:()=>E(s=>Math.min(S,s+1)),disabled:d===S,className:"p-2 border border-gray-300 rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(fe,{className:"text-gray-600"})})]})]})]})})]}),e.jsx(B,{isOpen:Z,onClose:()=>{y(!1),D()},title:"Apply for Leave",size:"md",children:e.jsx("form",{onSubmit:ee(ie),className:"space-y-4",children:ae?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):P.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No staff members found."}),e.jsx("p",{className:"text-sm mt-1",children:"Please add staff members first."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Staff Member ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...p("staffId",{required:"Staff member is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Staff Member"}),P.map(s=>{var t;return e.jsxs("option",{value:s.id,children:[((t=s.user)==null?void 0:t.name)||s.name," - ",s.designation||"Staff"]},s.id)})]}),i.staffId&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.staffId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Leave Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...p("type",{required:"Leave type is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Leave Type"}),H.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),i.type&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.type.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",...p("startDate",{required:"Start date is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),i.startDate&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.startDate.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",...p("endDate",{required:"End date is required"}),min:te,className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),i.endDate&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.endDate.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsx("textarea",{...p("reason"),rows:3,className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Enter reason for leave (optional)..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),D()},className:"px-4 py-2.5 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:L.isPending||P.length===0,className:"px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:L.isPending?"Submitting...":"Submit Application"})]})]})})}),e.jsx(B,{isOpen:!!a,onClose:()=>g(null),title:"Leave Details",size:"md",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-2xl",children:x(a).charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 text-xl",children:x(a)}),e.jsx("p",{className:"text-gray-500",children:((Q=a.staff)==null?void 0:Q.designation)||"Staff"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Leave Type"}),e.jsx("p",{className:"font-medium text-gray-900",children:J(a.type)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-sm font-medium ${W[a.status]}`,children:a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Start Date"}),e.jsx("p",{className:"font-medium text-gray-900",children:h(a.startDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"End Date"}),e.jsx("p",{className:"font-medium text-gray-900",children:h(a.endDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duration"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[U(a.startDate,a.endDate)," day(s)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Applied On"}),e.jsx("p",{className:"font-medium text-gray-900",children:h(a.createdAt)})]})]}),a.reason&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Reason"}),e.jsx("p",{className:"text-gray-900",children:a.reason})]}),a.status==="PENDING"&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:()=>{G(a),g(null)},disabled:o.isPending,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 transition",children:[e.jsx(z,{}),"Approve Leave"]}),e.jsxs("button",{onClick:()=>{V(a),g(null)},disabled:o.isPending,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 disabled:opacity-50 transition",children:[e.jsx(Y,{}),"Reject Leave"]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:()=>g(null),className:"px-4 py-2.5 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition",children:"Close"})})]})})]})}export{Ne as default};
