import{r as c,j as e,D as d,E as _,G as $,L as H,H as J,I as K,J as R,K as V,M as f,N as o}from"./index-C3V5QAXj.js";import{a as u}from"./adminService-BP8DU-1f.js";const W=()=>{const[v,A]=c.useState([]),[M,C]=c.useState(!0),[w,D]=c.useState(""),[P,g]=c.useState(!1),[L,j]=c.useState(!1),[O,y]=c.useState(!1),[p,x]=c.useState(null),[s,i]=c.useState({clinicName:"",ownerName:"",ownerEmail:"",ownerPassword:"",phone:"",address:""}),[r,N]=c.useState({page:1,limit:10,total:0});c.useEffect(()=>{h()},[r.page,w]);const h=async()=>{try{C(!0);const a=await u.getClinics({page:r.page,limit:r.limit,search:w});A(a.clinics),N(t=>({...t,total:a.total}))}catch(a){console.error("Failed to fetch clinics:",a)}finally{C(!1)}},B=async a=>{var t,l;a.preventDefault();try{await u.createClinic(s),g(!1),m(),h()}catch(n){console.error("Failed to create clinic:",n),alert(((l=(t=n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to create clinic")}},q=async a=>{var t,l;a.preventDefault();try{await u.updateClinic(p.id,{name:s.clinicName,phone:s.phone,address:s.address}),j(!1),m(),h()}catch(n){console.error("Failed to update clinic:",n),alert(((l=(t=n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to update clinic")}},U=async()=>{var a,t;try{await u.blockClinic(p.id),y(!1),x(null),h()}catch(l){console.error("Failed to block clinic:",l),alert(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to block clinic")}},z=async a=>{var t,l;try{await u.unblockClinic(a.id),h()}catch(n){console.error("Failed to unblock clinic:",n),alert(((l=(t=n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to unblock clinic")}},G=a=>{x(a),i({clinicName:a.name,phone:a.phone||"",address:a.address||""}),j(!0)},I=a=>{x(a),y(!0)},m=()=>{i({clinicName:"",ownerName:"",ownerEmail:"",ownerPassword:"",phone:"",address:""}),x(null)},b=Math.ceil(r.total/r.limit);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Manage all clinics on the platform"})]}),e.jsxs(d,{onClick:()=>g(!0),children:[e.jsx(_,{className:"mr-2"})," Add Clinic"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search clinics...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",value:w,onChange:a=>{D(a.target.value),N(t=>({...t,page:1}))}})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Limits"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"No clinics found"})}):v.map(a=>{var t,l,n,k,S,F,E;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Created ",new Date(a.createdAt).toLocaleDateString("en-GB")]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-gray-900",children:((t=a.owner)==null?void 0:t.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((l=a.owner)==null?void 0:l.email)||"N/A"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-gray-900",children:a.phone||"-"}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",children:a.address||"-"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[((n=a._count)==null?void 0:n.users)||0," users"]}),e.jsxs("div",{className:"text-gray-500",children:[((k=a._count)==null?void 0:k.patients)||0," patients"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-xs",children:[e.jsxs("div",{className:"text-gray-900",children:["Staff: ",((S=a==null?void 0:a.accessControls)==null?void 0:S.staffLimit)??"No limit"]}),e.jsxs("div",{className:"text-gray-500",children:["Upload/month: ",((E=(F=a==null?void 0:a.accessControls)==null?void 0:F.invoiceUploadLimit)==null?void 0:E.monthly)??"No limit"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive?"Active":"Blocked"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(H,{to:`/admin/clinics/${a.id}`,className:"text-purple-600 hover:text-purple-900 p-1",title:"View Details",children:e.jsx(J,{})}),e.jsx("button",{onClick:()=>G(a),className:"text-blue-600 hover:text-blue-900 p-1",title:"Edit",children:e.jsx(K,{})}),a.isActive?e.jsx("button",{onClick:()=>I(a),className:"text-red-600 hover:text-red-900 p-1",title:"Block Clinic",children:e.jsx(R,{})}):e.jsx("button",{onClick:()=>z(a),className:"text-green-600 hover:text-green-900 p-1",title:"Unblock Clinic",children:e.jsx(V,{})})]})})]},a.id)})})]})}),b>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(r.page-1)*r.limit+1," to"," ",Math.min(r.page*r.limit,r.total)," of"," ",r.total," clinics"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",disabled:r.page===1,onClick:()=>N(a=>({...a,page:a.page-1})),children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",disabled:r.page===b,onClick:()=>N(a=>({...a,page:a.page+1})),children:"Next"})]})]})]})}),e.jsx(f,{isOpen:P,onClose:()=>{g(!1),m()},title:"Create New Clinic",children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsx(o,{label:"Clinic Name",value:s.clinicName,onChange:a=>i({...s,clinicName:a.target.value}),required:!0}),e.jsx(o,{label:"Owner Name",value:s.ownerName,onChange:a=>i({...s,ownerName:a.target.value}),required:!0}),e.jsx(o,{label:"Owner Email",type:"email",value:s.ownerEmail,onChange:a=>i({...s,ownerEmail:a.target.value}),required:!0}),e.jsx(o,{label:"Owner Password",type:"password",value:s.ownerPassword,onChange:a=>i({...s,ownerPassword:a.target.value}),required:!0}),e.jsx(o,{label:"Phone",value:s.phone,onChange:a=>i({...s,phone:a.target.value})}),e.jsx(o,{label:"Address",value:s.address,onChange:a=>i({...s,address:a.target.value})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{g(!1),m()},children:"Cancel"}),e.jsx(d,{type:"submit",children:"Create Clinic"})]})]})}),e.jsx(f,{isOpen:L,onClose:()=>{j(!1),m()},title:"Edit Clinic",children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsx(o,{label:"Clinic Name",value:s.clinicName,onChange:a=>i({...s,clinicName:a.target.value}),required:!0}),e.jsx(o,{label:"Phone",value:s.phone,onChange:a=>i({...s,phone:a.target.value})}),e.jsx(o,{label:"Address",value:s.address,onChange:a=>i({...s,address:a.target.value})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{j(!1),m()},children:"Cancel"}),e.jsx(d,{type:"submit",children:"Update Clinic"})]})]})}),e.jsx(f,{isOpen:O,onClose:()=>{y(!1),x(null)},title:"Block Clinic",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to block ",e.jsx("strong",{children:p==null?void 0:p.name}),"? All users will be deactivated and unable to access the clinic until it is unblocked."]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>{y(!1),x(null)},children:"Cancel"}),e.jsx(d,{variant:"danger",onClick:U,children:"Block Clinic"})]})]})})]})};export{W as default};
