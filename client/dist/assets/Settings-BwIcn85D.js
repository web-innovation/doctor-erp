import{ag as S,I as $,r as h,b as V,p as G,z as x,j as e,n as le,o as oe,i as je,aE as Ne,aF as we,aG as ve,aH as z,aI as Q,c as T,d as C,a6 as de,af as O,aJ as ke,as as Se,a7 as K,h as ce,W as Pe,D as A,a0 as U,a as Ae,g as ne,aK as Te,aL as Ce,k as Ee}from"./index-BZojoe5g.js";import{u as P}from"./useMutation-CsgJd_y7.js";const B={getEmailConfig:async()=>{var s;return((s=(await S.get("/notifications/email/config")).data)==null?void 0:s.data)||null},saveEmailConfig:async l=>(await S.post("/notifications/email/config",l)).data,testEmailConfig:async()=>(await S.post("/notifications/email/test")).data,sendAppointmentReminder:async l=>(await S.post(`/notifications/appointment-reminder/${l}`)).data,sendPrescriptionEmail:async l=>(await S.post(`/notifications/prescription/${l}`)).data,sendBillEmail:async l=>(await S.post(`/notifications/bill/${l}`)).data,sendBulkReminders:async(l=24)=>(await S.post("/notifications/bulk-reminders",{hours:l})).data,getEmailLogs:async(l={})=>{var f;return((f=(await S.get("/notifications/email/logs",{params:l})).data)==null?void 0:f.data)||{logs:[],pagination:{}}},getOtpTemplate:async()=>{var s;return((s=(await S.get("/notifications/email/otp-template")).data)==null?void 0:s.data)||null},saveOtpTemplate:async l=>(await S.post("/notifications/email/otp-template",l)).data,getWhatsAppConfig:async()=>{var s;return((s=(await S.get("/notifications/whatsapp/config")).data)==null?void 0:s.data)||null},saveWhatsAppConfig:async l=>(await S.post("/notifications/whatsapp/config",l)).data,testWhatsAppConfig:async l=>(await S.post("/notifications/whatsapp/test",{phoneNumber:l})).data},Fe=[{id:"gmail-app-password",name:"Gmail (App Password)",icon:je,color:"text-green-500",recommended:!0},{id:"gmail",name:"Gmail (OAuth2)",icon:Ne,color:"text-red-500"},{id:"outlook",name:"Outlook (OAuth2)",icon:we,color:"text-blue-500"},{id:"smtp",name:"SMTP (Custom)",icon:ve,color:"text-gray-500"}];function We(){const l=$(),[s,f]=h.useState("gmail-app-password"),[m,E]=h.useState({}),[j,y]=h.useState(!1),{register:o,handleSubmit:F,reset:W,setValue:c,watch:N,formState:{errors:n}}=V({defaultValues:{provider:"gmail-app-password",userEmail:"",fromName:"Docsy",appPassword:"",clientId:"",clientSecret:"",refreshToken:"",tenantId:"",host:"",port:587,user:"",password:"",secure:!1}});N("provider");const{data:r,isLoading:k}=G({queryKey:["emailConfig"],queryFn:()=>B.getEmailConfig()});h.useEffect(()=>{r!=null&&r.configured&&(f(r.provider),c("provider",r.provider),c("userEmail",r.userEmail||""),c("fromName",r.fromName||"Docsy"))},[r,c]);const w=P({mutationFn:B.saveEmailConfig,onSuccess:()=>{x.success("Email configuration saved successfully"),l.invalidateQueries(["emailConfig"])},onError:a=>{var d,M;x.error(((M=(d=a.response)==null?void 0:d.data)==null?void 0:M.message)||"Failed to save configuration")}}),p=P({mutationFn:B.testEmailConfig,onSuccess:a=>{x.success(a.message||"Test email sent successfully")},onError:a=>{var d,M;x.error(((M=(d=a.response)==null?void 0:d.data)==null?void 0:M.message)||"Failed to send test email")}}),{data:v,isLoading:q}=G({queryKey:["otpTemplate"],queryFn:()=>B.getOtpTemplate()}),[I,i]=h.useState(""),[u,R]=h.useState([]);h.useEffect(()=>{typeof v<"u"&&(v&&typeof v=="object"?(i(v.template||""),R(v.placeholders||[])):(i(v||""),R([])))},[v]);const D=P({mutationFn:a=>B.saveOtpTemplate(a),onSuccess:()=>{x.success("OTP email template saved"),l.invalidateQueries(["otpTemplate"])},onError:a=>{var d,M;x.error(((M=(d=a.response)==null?void 0:d.data)==null?void 0:M.message)||"Failed to save template")}}),ee=()=>{D.mutate({template:I})},se=a=>{const d={provider:s,userEmail:a.userEmail,fromName:a.fromName};s==="gmail-app-password"?d.appPassword=a.appPassword:s==="gmail"?(d.clientId=a.clientId,d.clientSecret=a.clientSecret,d.refreshToken=a.refreshToken):s==="outlook"?(d.clientId=a.clientId,d.clientSecret=a.clientSecret,d.refreshToken=a.refreshToken,d.tenantId=a.tenantId):s==="smtp"&&(d.host=a.host,d.port=parseInt(a.port),d.user=a.user,d.password=a.password,d.secure=a.secure),w.mutate(d)},re=()=>{y(!0),p.mutate(void 0,{onSettled:()=>y(!1)})},L=a=>{E(d=>({...d,[a]:!d[a]}))};return k?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(le,{className:"text-sky-500"}),"Email Notifications"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure OAuth2 email for appointment reminders, prescriptions, and bills"})]}),(r==null?void 0:r.configured)&&e.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600 bg-green-50 px-3 py-1 rounded-full",children:[e.jsx(oe,{})," Configured"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Fe.map(a=>e.jsxs("button",{type:"button",onClick:()=>{f(a.id),c("provider",a.id)},className:`p-4 rounded-lg border-2 transition-all relative ${s===a.id?"border-sky-500 bg-sky-50":"border-gray-200 hover:border-gray-300"}`,children:[a.recommended&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:"Easy"}),e.jsx(a.icon,{className:`text-2xl mx-auto ${a.color}`}),e.jsx("p",{className:"text-sm font-medium mt-2",children:a.name})]},a.id))}),e.jsxs("form",{onSubmit:F(se),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",...o("userEmail",{required:"Email is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-email@gmail.com"}),n.userEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:n.userEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",...o("fromName"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Docsy"})]})]}),s==="gmail-app-password"&&e.jsxs("div",{className:"space-y-4 p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-700",children:[e.jsx(z,{}),e.jsx("span",{children:"Simple setup - just need Gmail App Password"}),e.jsxs("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:underline flex items-center gap-1",children:["Get App Password ",e.jsx(Q,{className:"text-xs"})]})]}),e.jsxs("div",{className:"bg-green-100 p-3 rounded-lg text-sm text-green-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How to get App Password:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Enable 2-Factor Authentication on your Google Account"}),e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"myaccount.google.com/apppasswords"})]}),e.jsx("li",{children:'Select "Mail" and your device, click Generate'}),e.jsx("li",{children:"Copy the 16-character password (no spaces needed)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["App Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.appPassword?"text":"password",...o("appPassword",{required:s==="gmail-app-password"&&"App Password is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx xxxx xxxx xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("appPassword"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.appPassword?e.jsx(T,{}):e.jsx(C,{})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"16-character password from Google App Passwords"})]})]}),s==="gmail"&&e.jsxs("div",{className:"space-y-4 p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-700",children:[e.jsx(z,{}),e.jsx("span",{children:"Requires Google Cloud Console OAuth2 credentials"}),e.jsxs("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer",className:"text-red-600 hover:underline flex items-center gap-1",children:["Get Credentials ",e.jsx(Q,{className:"text-xs"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("clientId",{required:s==="gmail"&&"Client ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx.apps.googleusercontent.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Secret ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.clientSecret?"text":"password",...o("clientSecret",{required:s==="gmail"&&"Client Secret is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"GOCSPX-xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("clientSecret"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.clientSecret?e.jsx(T,{}):e.jsx(C,{})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Refresh Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.refreshToken?"text":"password",...o("refreshToken",{required:s==="gmail"&&"Refresh Token is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"1//xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("refreshToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.refreshToken?e.jsx(T,{}):e.jsx(C,{})})]})]})]}),s==="outlook"&&e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(z,{}),e.jsx("span",{children:"Requires Azure AD App Registration"}),e.jsxs("a",{href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Get Credentials ",e.jsx(Q,{className:"text-xs"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("clientId",{required:s==="outlook"&&"Client ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tenant ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("tenantId",{required:s==="outlook"&&"Tenant ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Secret ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.clientSecret?"text":"password",...o("clientSecret",{required:s==="outlook"&&"Client Secret is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx~xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("clientSecret"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.clientSecret?e.jsx(T,{}):e.jsx(C,{})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Refresh Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.refreshToken?"text":"password",...o("refreshToken",{required:s==="outlook"&&"Refresh Token is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"M.xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("refreshToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.refreshToken?e.jsx(T,{}):e.jsx(C,{})})]})]})]}),s==="smtp"&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(z,{}),e.jsx("span",{children:"Use any SMTP server (AWS SES, SendGrid, Mailgun, etc.)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SMTP Host ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("host",{required:s==="smtp"&&"Host is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"smtp.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),e.jsx("input",{type:"number",...o("port"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"587"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("user",{required:s==="smtp"&&"Username is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-smtp-user"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.password?"text":"password",...o("password",{required:s==="smtp"&&"Password is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-smtp-password"}),e.jsx("button",{type:"button",onClick:()=>L("password"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.password?e.jsx(T,{}):e.jsx(C,{})})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...o("secure"),className:"w-4 h-4 text-sky-500 rounded focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Use TLS/SSL (port 465)"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:re,disabled:j||!(r!=null&&r.configured),className:"flex items-center gap-2 px-4 py-2 text-sky-600 bg-sky-50 rounded-lg hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-sky-500 border-t-transparent rounded-full animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{})," Send Test Email"]})}),e.jsx("button",{type:"submit",disabled:w.isPending,className:"flex items-center gap-2 px-6 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 disabled:opacity-50",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{})," Save Configuration"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"OTP Email Template"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Customize the HTML template used for email OTPs. Use ",e.jsx("span",{className:"font-mono",children:"{{code}}"})," and ",e.jsx("span",{className:"font-mono",children:"{{expiryMinutes}}"})," as placeholders."]})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("textarea",{value:I,onChange:a=>i(a.target.value),className:"w-full h-48 p-3 border border-gray-200 rounded-lg font-sans",placeholder:"<p>Your OTP is <strong>{{code}}</strong></p>"})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{type:"button",onClick:ee,disabled:D==null?void 0:D.isLoading,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(O,{})," ",D!=null&&D.isLoading?"Saving...":"Save Template"]})})]}),(u==null?void 0:u.length)>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:"Available placeholders:"}),e.jsx("ul",{className:"list-disc list-inside",children:u.map(a=>e.jsx("li",{className:"font-mono",children:a},a))})]})]})}function me(l){return ke({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 0C5.381-.008.008 5.352 0 11.971V12c0 6.64 5.359 12 12 12 6.64 0 12-5.36 12-12 0-6.641-5.36-12-12-12zm0 20.801c-4.846.015-8.786-3.904-8.801-8.75V12c-.014-4.846 3.904-8.786 8.75-8.801H12c4.847-.014 8.786 3.904 8.801 8.75V12c.015 4.847-3.904 8.786-8.75 8.801H12zm5.44-11.76c0 1.359-1.12 2.479-2.481 2.479-1.366-.007-2.472-1.113-2.479-2.479 0-1.361 1.12-2.481 2.479-2.481 1.361 0 2.481 1.12 2.481 2.481zm0 5.919c0 1.36-1.12 2.48-2.481 2.48-1.367-.008-2.473-1.114-2.479-2.48 0-1.359 1.12-2.479 2.479-2.479 1.361-.001 2.481 1.12 2.481 2.479zm-5.919 0c0 1.36-1.12 2.48-2.479 2.48-1.368-.007-2.475-1.113-2.481-2.48 0-1.359 1.12-2.479 2.481-2.479 1.358-.001 2.479 1.12 2.479 2.479zm0-5.919c0 1.359-1.12 2.479-2.479 2.479-1.367-.007-2.475-1.112-2.481-2.479 0-1.361 1.12-2.481 2.481-2.481 1.358 0 2.479 1.12 2.479 2.481z"},child:[]}]})(l)}const qe=[{id:"manual",name:"Manual (wa.me links)",icon:K,color:"text-green-500",description:"Opens WhatsApp Web for staff to send manually",recommended:!0},{id:"twilio",name:"Twilio WhatsApp",icon:me,color:"text-red-500",description:"Automated sending via Twilio API"},{id:"whatsapp-business",name:"WhatsApp Business API",icon:ce,color:"text-green-600",description:"Official WhatsApp Business Cloud API"}];function Ie(){const l=$(),[s,f]=h.useState("manual"),[m,E]=h.useState({}),[j,y]=h.useState(!1),{register:o,handleSubmit:F,reset:W,setValue:c,watch:N,formState:{errors:n}}=V({defaultValues:{provider:"manual",clinicWhatsAppNumber:"",clinicWhatsAppName:"",twilioAccountSid:"",twilioAuthToken:"",twilioWhatsAppNumber:"",wabAccessToken:"",wabPhoneNumberId:"",wabBusinessId:""}});N("provider");const{data:r,isLoading:k}=G({queryKey:["whatsappConfig"],queryFn:()=>B.getWhatsAppConfig()});h.useEffect(()=>{r!=null&&r.configured&&(f(r.provider),c("provider",r.provider),c("clinicWhatsAppNumber",r.clinicWhatsAppNumber||""),c("clinicWhatsAppName",r.clinicWhatsAppName||""))},[r,c]);const w=P({mutationFn:B.saveWhatsAppConfig,onSuccess:()=>{x.success("WhatsApp configuration saved successfully"),l.invalidateQueries(["whatsappConfig"])},onError:i=>{var u,R;x.error(((R=(u=i.response)==null?void 0:u.data)==null?void 0:R.message)||"Failed to save configuration")}}),p=P({mutationFn:B.testWhatsAppConfig,onSuccess:i=>{i.url?(window.open(i.url,"_blank"),x.success("WhatsApp Web opened. Send the test message to verify.")):x.success(i.message||"Test message sent successfully")},onError:i=>{var u,R;x.error(((R=(u=i.response)==null?void 0:u.data)==null?void 0:R.message)||"Failed to send test message")}}),v=i=>{const u={provider:s,clinicWhatsAppNumber:i.clinicWhatsAppNumber,clinicWhatsAppName:i.clinicWhatsAppName};s==="twilio"?(u.twilioAccountSid=i.twilioAccountSid,u.twilioAuthToken=i.twilioAuthToken,u.twilioWhatsAppNumber=i.twilioWhatsAppNumber):s==="whatsapp-business"&&(u.wabAccessToken=i.wabAccessToken,u.wabPhoneNumberId=i.wabPhoneNumberId,u.wabBusinessId=i.wabBusinessId),w.mutate(u)},q=()=>{y(!0),p.mutate(void 0,{onSettled:()=>y(!1)})},I=i=>{E(u=>({...u,[i]:!u[i]}))};return k?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"WhatsApp Notifications"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure WhatsApp messaging for your clinic"})]}),e.jsx("div",{className:"flex items-center gap-2",children:r!=null&&r.configured?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm",children:[e.jsx(oe,{}),"Configured"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-sm",children:[e.jsx(Se,{}),"Not Configured"]})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(z,{className:"text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Multi-Clinic WhatsApp Setup"}),e.jsx("p",{children:"Each clinic can have its own WhatsApp number. Messages will appear to patients as coming from your clinic's WhatsApp account."}),e.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside text-blue-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Manual:"})," Staff sends from clinic's phone with pre-filled message"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Twilio:"})," Automated sending from your Twilio WhatsApp number"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Business API:"})," Official WhatsApp Business for verified business accounts"]})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"WhatsApp Provider"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:qe.map(i=>{const u=i.icon;return e.jsxs("button",{type:"button",onClick:()=>{f(i.id),c("provider",i.id)},className:`relative p-4 border-2 rounded-xl text-left transition-all ${s===i.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[i.recommended&&e.jsx("span",{className:"absolute top-2 right-2 text-xs bg-green-500 text-white px-2 py-0.5 rounded-full",children:"Recommended"}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(u,{className:`text-2xl ${i.color}`}),e.jsx("span",{className:"font-medium text-gray-900",children:i.name})]}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.id)})})]}),e.jsxs("form",{onSubmit:F(v),className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(K,{className:"text-green-500"}),"Clinic WhatsApp Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic WhatsApp Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",...o("clinicWhatsAppNumber",{required:"Phone number is required"}),placeholder:"+91 9876543210",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),n.clinicWhatsAppNumber&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.clinicWhatsAppNumber.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This is the phone number patients will see as the sender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name (as shown in WhatsApp)"}),e.jsx("input",{type:"text",...o("clinicWhatsAppName"),placeholder:"City Health Clinic",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your WhatsApp Business profile name"})]})]})]}),s==="twilio"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(me,{className:"text-red-500"}),"Twilio Configuration"]}),e.jsxs("a",{href:"https://console.twilio.com",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-red-600 hover:underline flex items-center gap-1",children:["Get credentials ",e.jsx(Q,{className:"text-xs"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account SID *"}),e.jsx("input",{type:"text",...o("twilioAccountSid",{required:s==="twilio"?"Account SID is required":!1}),placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auth Token *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.twilioAuthToken?"text":"password",...o("twilioAuthToken",{required:s==="twilio"?"Auth Token is required":!1}),placeholder:"Your Auth Token",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("button",{type:"button",onClick:()=>I("twilioAuthToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.twilioAuthToken?e.jsx(T,{}):e.jsx(C,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Twilio WhatsApp Number *"}),e.jsx("input",{type:"text",...o("twilioWhatsAppNumber",{required:s==="twilio"?"WhatsApp number is required":!1}),placeholder:"+14155238886",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Twilio sandbox number or your registered WhatsApp number"})]})]})]}),s==="whatsapp-business"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ce,{className:"text-green-600"}),"WhatsApp Business API Configuration"]}),e.jsxs("a",{href:"https://developers.facebook.com/docs/whatsapp/cloud-api/get-started",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-green-600 hover:underline flex items-center gap-1",children:["Setup Guide ",e.jsx(Q,{className:"text-xs"})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," WhatsApp Business API requires a verified Facebook Business account and approved WhatsApp Business phone number."]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Token *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m.wabAccessToken?"text":"password",...o("wabAccessToken",{required:s==="whatsapp-business"?"Access Token is required":!1}),placeholder:"Your permanent access token",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("button",{type:"button",onClick:()=>I("wabAccessToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m.wabAccessToken?e.jsx(T,{}):e.jsx(C,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number ID *"}),e.jsx("input",{type:"text",...o("wabPhoneNumberId",{required:s==="whatsapp-business"?"Phone Number ID is required":!1}),placeholder:"1234567890123456",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp Business Account ID"}),e.jsx("input",{type:"text",...o("wabBusinessId"),placeholder:"1234567890123456",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),s==="manual"&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-green-900 flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"text-green-500"}),"How Manual Mode Works"]}),e.jsxs("ol",{className:"text-sm text-green-800 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:'When you click "Send via WhatsApp", a new tab opens with WhatsApp Web'}),e.jsx("li",{children:"The message is pre-filled with prescription/appointment details"}),e.jsx("li",{children:'Staff clicks "Send" in WhatsApp Web to complete sending'}),e.jsx("li",{children:"The message appears to come from your clinic's WhatsApp account (the one logged into WhatsApp Web)"})]}),e.jsxs("p",{className:"text-sm text-green-700 mt-3",children:[e.jsx("strong",{children:"Tip:"})," Keep WhatsApp Web logged in on the clinic's computer with the clinic's WhatsApp Business account."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:q,disabled:j||!(r!=null&&r.configured),className:"inline-flex items-center gap-2 px-4 py-2 text-green-600 bg-green-50 rounded-lg hover:bg-green-100 transition disabled:opacity-50",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"○"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{}),"Send Test Message"]})}),e.jsx("button",{type:"submit",disabled:w.isPending,className:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"○"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{}),"Save Configuration"]})})]})]})]})}const ie=["DOCTOR","RECEPTIONIST","PHARMACIST","ACCOUNTANT","STAFF","PATIENT"],Z=["dashboard:view","patients:read","patients:create","patients:update","appointments:read","appointments:create","appointments:update","prescriptions:read","prescriptions:create","pharmacy:read","pharmacy:create","billing:read","billing:create","billing:edit","reports:opd","purchases:read","purchases:create","ledger:read","ledger:create","ledger:update","ledger:delete"];Z.push("leaves:read","leaves:create","leaves:update");const Me=["labs:read","labs:create","labs:update","labs:tests"],Re=["agents:read","agents:create","agents:update","commissions:read","commissions:pay"];function Le(){const l=$(),{data:s,isLoading:f,isError:m,error:E,refetch:j}=G({queryKey:["rolePermissions"],queryFn:()=>A.getRolePermissions()}),[y,o]=h.useState(null);h.useEffect(()=>{if(s!=null&&s.data)o(s.data);else if(!f&&!m){const n={};ie.forEach(r=>{n[r]=Z.slice()}),o(n)}},[s,f,m]);const F=P({mutationFn:A.updateRolePermissions,onSuccess:()=>{l.invalidateQueries({queryKey:["rolePermissions"]}),x.success("Role permissions updated")},onError:n=>{var r,k;x.error(((k=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:k.message)||"Failed to update role permissions")}}),W={"labs:manage":["labs:read"],"labs:create":["labs:read"],"labs:update":["labs:read"],"labs:tests":["labs:read"],"agents:manage":["agents:read"],"agents:create":["agents:read"],"agents:update":["agents:read"],"commissions:pay":["commissions:read"],"ledger:create":["ledger:read"],"ledger:update":["ledger:read"],"ledger:delete":["ledger:read"],"leaves:create":["leaves:read"],"leaves:update":["leaves:read"]},c=Object.keys(W).reduce((n,r)=>(W[r].forEach(k=>{n[k]=n[k]||[],n[k].push(r)}),n),{}),N=(n,r)=>{o(k=>{const w=new Set(k[n]||[]);if(w.has(r)){w.delete(r);const p=[r];for(;p.length;){const v=p.shift(),q=c[v]||[];for(const I of q)w.has(I)&&(w.delete(I),p.push(I))}}else{w.add(r);const p=W[r]||[];for(const v of p)w.add(v)}return{...k,[n]:Array.from(w)}})};return f?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."})]}):m?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsxs("p",{className:"text-sm text-red-500 mb-4",children:["Failed to load role permissions: ",(E==null?void 0:E.message)||"Unknown error"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"secondary",onClick:()=>j(),children:"Retry"}),e.jsx(U,{variant:"ghost",onClick:()=>{alert("If this persists, ensure the backend migration/role-permissions endpoint is applied and the server is running.")},children:"Help"})]})]}):y?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Grant or revoke feature access per role. Changes affect only this clinic."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ie.map(n=>e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("strong",{children:n})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"General"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map(r=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(r),onChange:()=>N(n,r)}),e.jsx("span",{className:"text-sm",children:r})]},r))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Labs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Me.map(r=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(r),onChange:()=>N(n,r)}),e.jsx("span",{className:"text-sm",children:r})]},r))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Agents & Commissions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(r=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(r),onChange:()=>N(n,r)}),e.jsx("span",{className:"text-sm",children:r})]},r))})]})]},n))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(U,{variant:"primary",onClick:()=>F.mutate(y),loading:F.isLoading,children:"Save Role Permissions"})})]}):null}const De=["appointments:read","prescriptions:read","billing:read","pharmacy:read"];function Oe(){const l=$(),{data:s,isLoading:f,isError:m,refetch:E}=G({queryKey:["rolePermissions"],queryFn:()=>A.getRolePermissions()}),[j,y]=h.useState([]);h.useEffect(()=>{s&&s.data&&s.data.PATIENT?y(Array.isArray(s.data.PATIENT)?s.data.PATIENT:[]):!f&&!m&&y([])},[s,f,m]);const o=P({mutationFn:c=>A.updateRolePermissions(c),onSuccess:()=>{l.invalidateQueries({queryKey:["rolePermissions"]}),x.success("Mobile access updated")},onError:c=>{var N,n;x.error(((n=(N=c==null?void 0:c.response)==null?void 0:N.data)==null?void 0:n.message)||"Failed to update mobile access")}}),F=c=>{y(N=>{const n=new Set(N||[]);return n.has(c)?n.delete(c):n.add(c),Array.from(n)})},W=()=>{const c=s&&s.data?{...s.data}:{};c.PATIENT=j,o.mutate(c)};return f?e.jsx("div",{className:"p-4",children:"Loading mobile access..."}):m?e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-red-600",children:"Failed to load mobile access settings."}),e.jsx("div",{className:"mt-2",children:e.jsx(U,{variant:"ghost",onClick:()=>E(),children:"Retry"})})]}):e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Mobile App"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Grant mobile (patient) access to select features."}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:De.map(c=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-3 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(j||[]).includes(c),onChange:()=>F(c)}),e.jsx("span",{className:"text-sm",children:c})]},c))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(U,{variant:"primary",onClick:W,loading:o.isLoading,children:"Save Mobile Access"})})]})}const Be=[{id:"profile",label:"Profile",icon:ne},{id:"clinic",label:"Clinic",icon:Te},{id:"email",label:"Email",icon:le},{id:"whatsapp",label:"WhatsApp",icon:K},{id:"preferences",label:"Preferences",icon:Ce},{id:"access",label:"Access Management",icon:ne}],Ge=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ve=[{id:"todayAppointments",label:"Today's Appointments",enabled:!0},{id:"revenue",label:"Revenue Stats",enabled:!0},{id:"recentPatients",label:"Recent Patients",enabled:!0},{id:"lowStock",label:"Low Stock Alerts",enabled:!0},{id:"pendingBills",label:"Pending Bills",enabled:!0},{id:"upcomingFollowups",label:"Upcoming Follow-ups",enabled:!1}];function Qe(){const l=$(),{user:s,loadUser:f}=Ae(),[m,E]=h.useState("profile"),[j,y]=h.useState(!1),[o,F]=h.useState(!1),{register:W,handleSubmit:c,formState:{errors:N}}=V({defaultValues:{name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||""}}),{register:n,handleSubmit:r,reset:k,watch:w,formState:{errors:p}}=V(),v=w("newPassword"),{register:q,handleSubmit:I,setValue:i,formState:{errors:u}}=V(),{register:R,handleSubmit:D,setValue:ee}=V(),[se,re]=h.useState(Ge.map(t=>({day:t,isOpen:t!=="Sunday",openTime:"09:00",closeTime:"18:00",breakStart:"13:00",breakEnd:"14:00"}))),[L,a]=h.useState(Ve),{data:d,isLoading:M}=G({queryKey:["clinic-settings"],queryFn:()=>A.getClinicSettings()});h.useEffect(()=>{d&&(i("clinicName",d.clinicName||""),i("address",d.address||""),i("phone",d.phone||""),i("email",d.email||""),i("website",d.website||""),i("registrationNo",d.registrationNo||""),i("gstNo",d.gstNo||""))},[d,i]);const{data:_,isLoading:xe}=G({queryKey:["preferences"],queryFn:()=>A.getPreferences()});h.useEffect(()=>{_!=null&&_.dashboardWidgets&&a(_.dashboardWidgets)},[_]);const Y=P({mutationFn:t=>A.updateProfile(t),onSuccess:async()=>{x.success("Profile updated successfully"),l.invalidateQueries(["user"]),await f()},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to update profile")}}),H=P({mutationFn:t=>A.changePassword(t),onSuccess:()=>{x.success("Password changed successfully"),k()},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to change password")}}),J=P({mutationFn:t=>A.updateClinicSettings(t),onSuccess:()=>{x.success("Clinic settings updated successfully"),l.invalidateQueries(["clinic-settings"])},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to update clinic settings")}});P({mutationFn:t=>A.updateTaxSettings(t),onSuccess:()=>{x.success("Tax settings updated successfully"),l.invalidateQueries(["tax-settings"])},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to update tax settings")}}),P({mutationFn:t=>A.updateWorkingHours(t),onSuccess:()=>{x.success("Working hours updated successfully"),l.invalidateQueries(["working-hours"])},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to update working hours")}});const X=P({mutationFn:t=>A.updatePreferences(t),onSuccess:()=>{x.success("Preferences updated successfully"),l.invalidateQueries(["preferences"])},onError:t=>{var b,g;x.error(((g=(b=t.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to update preferences")}}),ue=t=>{Y.mutate(t)},te=t=>{H.mutate({currentPassword:t.currentPassword,newPassword:t.newPassword})},pe=t=>{J.mutate(t)},ge=t=>{a(b=>b.map(g=>g.id===t?{...g,enabled:!g.enabled}:g))},he=()=>{X.mutate({dashboardWidgets:L})},ae=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Profile Information"}),e.jsxs("form",{onSubmit:c(ue),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...W("name",{required:"Name is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N.name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",...W("email",{required:"Email is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",...W("phone"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:Y.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(O,{}),Y.isPending?"Saving...":"Save Changes"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:r(te),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",...n("currentPassword",{required:"Current password is required"}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>y(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:j?e.jsx(T,{}):e.jsx(C,{})})]}),p.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.currentPassword.message})]}),e.jsx("div",{}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",...n("newPassword",{required:"New password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>F(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(T,{}):e.jsx(C,{})})]}),p.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.newPassword.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",...n("confirmPassword",{required:"Please confirm your password",validate:t=>t===v||"Passwords do not match"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),p.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.confirmPassword.message})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:H.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(O,{}),H.isPending?"Changing...":"Change Password"]})})]})]})]});if((s==null?void 0:s.role)==="STAFF")return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:r(te),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",...n("currentPassword",{required:"Current password is required"}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>y(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:j?e.jsx(T,{}):e.jsx(C,{})})]}),p.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.currentPassword.message})]}),e.jsx("div",{}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",...n("newPassword",{required:"New password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>F(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(T,{}):e.jsx(C,{})})]}),p.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.newPassword.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",...n("confirmPassword",{required:"Please confirm your password",validate:t=>t===v||"Passwords do not match"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),p.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.confirmPassword.message})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:H.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(O,{}),H.isPending?"Changing...":"Change Password"]})})]})]})]})});const be=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clinic Information"}),M?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("form",{onSubmit:I(pe),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...q("clinicName",{required:"Clinic name is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name"}),u.clinicName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:u.clinicName.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{...q("address"),rows:2,className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",...q("phone"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",...q("email"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Website"}),e.jsx("input",{type:"url",...q("website"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registration Number"}),e.jsx("input",{type:"text",...q("registrationNo"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter registration number"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:J.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(O,{}),J.isPending?"Saving...":"Save Changes"]})})]})]}),fe=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dashboard Customization"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Choose which widgets to display on your dashboard"}),xe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(t=>e.jsx("div",{onClick:()=>ge(t.id),className:`p-4 border rounded-lg cursor-pointer transition ${t.enabled?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${t.enabled?"text-blue-700":"text-gray-700"}`,children:t.label}),e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t.enabled?"bg-blue-600":"bg-gray-200"}`,children:t.enabled&&e.jsx(Ee,{className:"text-white text-xs"})})]})},t.id))}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{onClick:he,disabled:X.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(O,{}),X.isPending?"Saving...":"Save Preferences"]})})]})]}),ye=()=>{switch(m){case"profile":return ae();case"clinic":return be();case"tax":return renderTaxTab();case"hours":return renderHoursTab();case"email":return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(We,{})});case"whatsapp":return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(Ie,{})});case"preferences":return fe();case"access":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(Le,{})}),e.jsx("div",{children:e.jsx(Oe,{})})]});default:return ae()}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your account and clinic settings"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-64 flex-shrink-0",children:e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:Be.map(t=>e.jsxs("button",{onClick:()=>E(t.id),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition ${m===t.id?"bg-blue-50 text-blue-600 border-l-4 border-blue-600":"text-gray-600 hover:bg-gray-50 border-l-4 border-transparent"}`,children:[e.jsx(t.icon,{className:m===t.id?"text-blue-600":"text-gray-400"}),e.jsx("span",{className:"font-medium",children:t.label})]},t.id))})}),e.jsx("div",{className:"flex-1",children:ye()})]})]})})}export{Qe as default};
