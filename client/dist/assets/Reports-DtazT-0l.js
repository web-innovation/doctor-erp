import{ag as b,r as N,J as y,j as e,s as v,ax as w,a9 as J,ay as K,p as oe,az as le,Y as ie,aA as f,w as S,aB as ce,aC as de}from"./index-DfbFSgDY.js";import{D as ge,L as z,B as me,C as pe,a as xe,b as he,P as ue,c as be,d as ye,A as je,p as ve,e as Ne,f as fe,i as we}from"./index-6379zpR0.js";const j={getSalesReport:async(n={})=>(await b.get("/reports/sales",{params:n})).data,getOPDReport:async(n={})=>(await b.get("/reports/opd",{params:n})).data,getPatientReport:async(n={})=>(await b.get("/reports/patients",{params:n})).data,getPharmacyReport:async(n={})=>(await b.get("/reports/pharmacy",{params:n})).data,getCommissionReport:async(n={})=>(await b.get("/reports/commissions",{params:n})).data};pe.register(xe,he,ue,be,ye,je,ve,Ne,fe,we);const De=[{id:"sales",label:"Sales",icon:v},{id:"opd",label:"OPD",icon:w},{id:"pharmacy",label:"Pharmacy",icon:J},{id:"commissions",label:"Commissions",icon:K}],o=({title:n,value:c,change:l,changeType:d,icon:g,color:D})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:n}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:c}),l!==void 0&&e.jsxs("p",{className:`text-sm mt-1 flex items-center gap-1 ${d==="increase"?"text-green-600":"text-red-600"}`,children:[d==="increase"?e.jsx(ce,{className:"text-xs"}):e.jsx(de,{className:"text-xs"}),Math.abs(l),"% from last period"]})]}),e.jsx("div",{className:`w-12 h-12 ${D} rounded-xl flex items-center justify-center`,children:e.jsx(g,{className:"text-xl text-white"})})]})});function Ae(){var B,M,E,V,_,$,G;const[n,c]=N.useState("sales"),[l,d]=N.useState({startDate:new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),[g,D]=N.useState("day"),A=y("reports:sales",["SUPER_ADMIN","DOCTOR","ACCOUNTANT"]),O=y("reports:opd",["SUPER_ADMIN","DOCTOR","ACCOUNTANT"]),P=y("reports:pharmacy",["SUPER_ADMIN","DOCTOR","ACCOUNTANT"]),k=y("reports:commissions",["SUPER_ADMIN","DOCTOR","ACCOUNTANT"]);if(!(y("reports:view",["DOCTOR","SUPER_ADMIN","ACCOUNTANT"])||A||O||P||k))return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Reports not available"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Your role does not have access to reports. Contact the clinic administrator if you need access."})]})})});const Q=De.filter(a=>{switch(a.id){case"sales":return A;case"opd":return O;case"pharmacy":return P;case"commissions":return k;default:return!1}}),{data:C,isLoading:X}=oe({queryKey:["report",n,l,g],queryFn:()=>{const a={startDate:l.startDate,endDate:l.endDate,groupBy:g};switch(n){case"sales":return j.getSalesReport(a);case"opd":return j.getOPDReport(a);case"pharmacy":return j.getPharmacyReport(a);case"commissions":return j.getCommissionReport(a);default:return j.getSalesReport(a)}}}),s=(C==null?void 0:C.data)||{},L={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},ee={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}},se={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}},m=N.useMemo(()=>{const a=[],t=new Date(l.startDate),p=new Date(l.endDate),r=new Date(t);for(;r<=p;)g==="day"?(a.push(r.toLocaleDateString("en-IN",{day:"2-digit",month:"short"})),r.setDate(r.getDate()+1)):g==="week"?(a.push(`Week ${Math.ceil(r.getDate()/7)}`),r.setDate(r.getDate()+7)):(a.push(r.toLocaleDateString("en-IN",{month:"short",year:"numeric"})),r.setMonth(r.getMonth()+1));return a.slice(0,30)},[l,g]),F={labels:((B=s.chartData)==null?void 0:B.labels)||m,datasets:[{label:"Revenue",data:((M=s.chartData)==null?void 0:M.revenue)||m.map(()=>0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4}]},I={labels:((E=s.chartData)==null?void 0:E.labels)||m,datasets:[{label:"New Patients",data:((V=s.chartData)==null?void 0:V.patients)||m.map(()=>0),backgroundColor:"rgba(16, 185, 129, 0.8)",borderRadius:4},{label:"Consultations",data:((_=s.chartData)==null?void 0:_.consultations)||m.map(()=>0),backgroundColor:"rgba(59, 130, 246, 0.8)",borderRadius:4}]},U={labels:(($=s.chartData)==null?void 0:$.labels)||m,datasets:[{label:"Sales",data:((G=s.chartData)==null?void 0:G.sales)||m.map(()=>0),borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",fill:!0,tension:.4}]},ae={labels:["Doctors","Agents","Labs","Others"],datasets:[{data:s.breakdown||[45,25,20,10],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(251, 146, 60, 0.8)","rgba(168, 85, 247, 0.8)"],borderWidth:0}]},i=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0),te=()=>{const a=[["Report Type",n.toUpperCase()],["Date Range",`${l.startDate} to ${l.endDate}`],["Generated On",new Date().toLocaleString()],[],["Date","Value"],...m.map((x,h)=>[x,n==="sales"?F.datasets[0].data[h]:n==="opd"?I.datasets[0].data[h]:U.datasets[0].data[h]])].map(x=>x.join(",")).join(`
`),t=new Blob([a],{type:"text/csv"}),p=window.URL.createObjectURL(t),r=document.createElement("a");r.href=p,r.download=`${n}-report-${l.startDate}-${l.endDate}.csv`,r.click(),window.URL.revokeObjectURL(p)},ne=()=>{var a,t,p,r,x,h,H,W,q;switch(n){case"sales":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{title:"Total Revenue",value:i(s.totalRevenue||0),change:s.revenueChange,changeType:"increase",icon:v,color:"bg-blue-500"}),e.jsx(o,{title:"Total Transactions",value:s.totalTransactions||0,change:s.transactionsChange,changeType:"increase",icon:f,color:"bg-green-500"}),e.jsx(o,{title:"Average Bill",value:i(s.avgBill||0),change:s.avgBillChange,changeType:"increase",icon:S,color:"bg-purple-500"}),e.jsx(o,{title:"Outstanding",value:i(s.outstanding||0),change:s.outstandingChange,changeType:"decrease",icon:v,color:"bg-orange-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Revenue Trend"}),e.jsx("div",{className:"h-80",children:e.jsx(z,{data:F,options:L})})]})]});case"opd":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{title:"Total Patients",value:s.totalPatients||0,change:s.patientsChange,changeType:"increase",icon:w,color:"bg-blue-500"}),e.jsx(o,{title:"Consultations",value:s.totalConsultations||0,change:s.consultationsChange,changeType:"increase",icon:f,color:"bg-green-500"}),e.jsx(o,{title:"New Patients",value:s.newPatients||0,change:s.newPatientsChange,changeType:"increase",icon:S,color:"bg-purple-500"}),e.jsx(o,{title:"Revisits",value:s.revisits||0,change:s.revisitsChange,changeType:"increase",icon:w,color:"bg-orange-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Patient & Consultation Trends"}),e.jsx("div",{className:"h-80",children:e.jsx(me,{data:I,options:ee})})]})]});case"pharmacy":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{title:"Total Sales",value:i(s.totalSales||0),change:s.salesChange,changeType:"increase",icon:v,color:"bg-purple-500"}),e.jsx(o,{title:"Transactions",value:s.totalTransactions||0,change:s.transactionsChange,changeType:"increase",icon:J,color:"bg-blue-500"}),e.jsx(o,{title:"Low Stock Items",value:s.lowStockCount||0,change:s.lowStockChange,changeType:"decrease",icon:f,color:"bg-red-500"}),e.jsx(o,{title:"Total Products",value:s.totalProducts||0,change:s.productsChange,changeType:"increase",icon:S,color:"bg-green-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pharmacy Sales Trend"}),e.jsx("div",{className:"h-80",children:e.jsx(z,{data:U,options:L})})]})]});case"commissions":const Y=((a=s.summary)==null?void 0:a.totalCommission)||0,re=Y-(((t=s.summary)==null?void 0:t.pendingAmount)||0),Z=((p=s.summary)==null?void 0:p.pendingAmount)||0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{title:"Total Commissions",value:i(Y),change:s.commissionsChange,changeType:"increase",icon:K,color:"bg-green-500"}),e.jsx(o,{title:"Paid",value:i(re),change:s.paidChange,changeType:"increase",icon:v,color:"bg-blue-500"}),e.jsx(o,{title:"Pending",value:i(Z),change:s.pendingChange,changeType:"decrease",icon:f,color:"bg-orange-500"}),e.jsx(o,{title:"Total Records",value:((r=s.summary)==null?void 0:r.count)||0,change:s.recordsChange,changeType:"increase",icon:w,color:"bg-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Commission Breakdown"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{data:ae,options:se})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Commission Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-semibold text-sm",children:"L"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Lab Commissions"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((x=s.byLab)==null?void 0:x.length)||0," labs"]})]})]}),e.jsx("span",{className:"font-semibold text-green-600",children:i(((h=s.byLab)==null?void 0:h.reduce((T,R)=>{var u;return T+(((u=R._sum)==null?void 0:u.amount)||0)},0))||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 font-semibold text-sm",children:"A"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Agent Commissions"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((H=s.byAgent)==null?void 0:H.length)||0," agents"]})]})]}),e.jsx("span",{className:"font-semibold text-green-600",children:i(((W=s.byAgent)==null?void 0:W.reduce((T,R)=>{var u;return T+(((u=R._sum)==null?void 0:u.amount)||0)},0))||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 font-semibold text-sm",children:"P"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Pending Payments"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((q=s.summary)==null?void 0:q.pendingCount)||0," records"]})]})]}),e.jsx("span",{className:"font-semibold text-orange-600",children:i(Z)})]})]})]})]})]});default:return null}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View detailed reports and insights"})]}),e.jsxs("button",{onClick:te,className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(le,{}),"Export Report"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-6",children:[e.jsx("div",{className:"flex border-b border-gray-100",children:Q.map(a=>e.jsxs("button",{onClick:()=>c(a.id),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium transition ${n===a.id?"text-blue-600 border-b-2 border-blue-600 bg-blue-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(a.icon,{}),a.label]},a.id))}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"From:"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",value:l.startDate,onChange:a=>d(t=>({...t,startDate:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"To:"}),e.jsx("input",{type:"date",lang:"en-GB",placeholder:"dd/mm/yyyy",value:l.endDate,onChange:a=>d(t=>({...t,endDate:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("select",{value:g,onChange:a=>D(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"day",children:"Daily"}),e.jsx("option",{value:"week",children:"Weekly"}),e.jsx("option",{value:"month",children:"Monthly"})]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx("button",{onClick:()=>{const a=new Date,t=new Date(a);t.setDate(t.getDate()-7),d({startDate:t.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]})},className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Last 7 Days"}),e.jsx("button",{onClick:()=>{const a=new Date,t=new Date(a);t.setDate(t.getDate()-30),d({startDate:t.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]})},className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Last 30 Days"}),e.jsx("button",{onClick:()=>{const a=new Date,t=new Date(a);t.setMonth(t.getMonth()-3),d({startDate:t.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]})},className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Last 3 Months"})]})]})})]}),X?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):ne()]})})}export{Ae as default};
