import{T as q,I as P,r as h,b as f,p as I,j as e,L as D,y as M,V as z,ae as V,Q as T,z as l,an as m}from"./index-nhLMFlzE.js";import{u as y}from"./useMutation-B2ZX3zFK.js";function R(){const{labId:a}=q(),p=P(),[w,i]=h.useState(!1),[v,o]=h.useState(!1),[j,x]=h.useState(null),{register:d,handleSubmit:k,reset:g}=f(),{register:c,handleSubmit:C,setValue:n,reset:u}=f(),{data:b,isLoading:E}=I({queryKey:["labTests",a],queryFn:()=>m.getLabTests(a,{limit:100}),enabled:!!a}),L=y({mutationFn:s=>m.createLabTest(a,s),onSuccess:()=>{l.success("Test created"),p.invalidateQueries(["labTests",a]),i(!1),g()},onError:s=>{var t,r;return l.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create")}}),F=y({mutationFn:({id:s,data:t})=>m.updateLabTest(a,s,t),onSuccess:()=>{l.success("Test updated"),p.invalidateQueries(["labTests",a]),o(!1),x(null),u()},onError:s=>{var t,r;return l.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update")}}),S=y({mutationFn:s=>m.deleteLabTest(a,s),onSuccess:()=>{l.success("Test deleted"),p.invalidateQueries(["labTests",a])},onError:s=>{var t,r;return l.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to delete")}}),N=(b==null?void 0:b.data)||[],A=s=>{L.mutate({name:s.name,code:s.code,category:s.category,price:parseFloat(s.price||0),description:s.description})},O=s=>{j&&F.mutate({id:j.id,data:{name:s.name,code:s.code,category:s.category,price:parseFloat(s.price||0),description:s.description}})},Q=s=>{x(s),n("name",s.name),n("code",s.code),n("category",s.category),n("price",s.price),n("description",s.description),o(!0)};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Lab Tests"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage tests for the selected lab"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Lab: ",e.jsx(D,{to:"/labs-agents",className:"text-blue-600",children:"Back to Labs"})]})]}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg",children:[" ",e.jsx(M,{})," Add Test"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:E?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):N.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No tests found. Add one to get started."}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm text-gray-600",children:"Name"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm text-gray-600",children:"Code"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm text-gray-600",children:"Category"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm text-gray-600",children:"Price"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:s.name}),e.jsx("td",{className:"px-4 py-3",children:s.code||"-"}),e.jsx("td",{className:"px-4 py-3",children:s.category||"-"}),e.jsx("td",{className:"px-4 py-3",children:s.price?`â‚¹${s.price}`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>Q(s),className:"p-2 text-blue-600 mr-2",children:e.jsx(z,{})}),e.jsx("button",{onClick:()=>{confirm("Delete test?")&&S.mutate(s.id)},className:"p-2 text-red-600",children:e.jsx(V,{})})]})]},s.id))})]})}),e.jsx(T,{isOpen:w,onClose:()=>{i(!1),g()},title:"Add Lab Test",children:e.jsxs("form",{onSubmit:k(A),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Name"}),e.jsx("input",{...d("name",{required:!0}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Code"}),e.jsx("input",{...d("code"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Category"}),e.jsx("input",{...d("category"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",...d("price"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Description"}),e.jsx("textarea",{...d("description"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Add"})]})]})}),e.jsx(T,{isOpen:v,onClose:()=>{o(!1),x(null),u()},title:"Edit Lab Test",children:e.jsxs("form",{onSubmit:C(O),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Name"}),e.jsx("input",{...c("name",{required:!0}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Code"}),e.jsx("input",{...c("code"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Category"}),e.jsx("input",{...c("category"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",...c("price"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Description"}),e.jsx("textarea",{...c("description"),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{o(!1),x(null),u()},className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Save"})]})]})})]})})}export{R as default};
