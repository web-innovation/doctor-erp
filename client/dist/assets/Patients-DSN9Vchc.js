import{u as _,H as U,I as V,r as h,J,b as W,p as X,j as e,y as Z,K as ee,M as se,N as te,q as I,O as re,P as ae,Q as le,z as A,G,R as ne,S as oe}from"./index-CMIIMqsb.js";import{u as ie}from"./useMutation-BV74XL4h.js";const de=p=>{if(!p||typeof p!="string")return"";const d=p.trim(),x=/^(\d{2})\/(\d{2})\/(\d{4})$/.exec(d);if(!x)return"";const[,j,c,b]=x,a=Number(j),n=Number(c),m=Number(b);if(!a||!n||!m||n<1||n>12||a<1||a>31)return"";const y=new Date(m,n-1,a);return y.getFullYear()!==m||y.getMonth()!==n-1||y.getDate()!==a?"":`${b}-${c}-${j}`};function xe(){var O,E;const p=_(),[d,x]=U(),j=V(),[c,b]=h.useState(d.get("search")||""),[a,n]=h.useState(1),[m,y]=h.useState(!1),[T,f]=h.useState(d.get("action")==="new"),[l,k]=h.useState({gender:"",fromDate:"",toDate:""}),N=10,S=J("patients:create",["SUPER_ADMIN","DOCTOR","RECEPTIONIST"]);h.useEffect(()=>{const s=d.get("action"),t=d.get("search");s==="new"&&(S&&f(!0),x({},{replace:!0})),t&&(b(t),x({},{replace:!0}))},[d,x,S]);const{register:o,handleSubmit:$,reset:F,formState:{errors:v}}=W(),{data:i,isLoading:B,isError:q}=X({queryKey:["patients",a,N,c,l],queryFn:()=>G.getAll({page:a,limit:N,search:c,...l}),placeholderData:s=>s}),D=ie({mutationFn:s=>G.createPatient(s),onSuccess:()=>{A.success("Patient added successfully"),j.invalidateQueries({queryKey:["patients"]}),f(!1),F()},onError:s=>{var t,r;A.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to add patient")}}),H=s=>{const t=s.dateOfBirth?de(s.dateOfBirth):"";if(s.dateOfBirth&&!t){A.error("Date of birth format should be dd/mm/yyyy");return}const r=s.allergies?s.allergies.split(",").map(g=>g.trim()).filter(Boolean):void 0,w=s.medicalHistory?s.medicalHistory.split(`
`).map(g=>g.trim()).filter(Boolean):void 0;D.mutate({...s,dateOfBirth:t||void 0,allergies:r,medicalHistory:w,insurance:s.insurance?s.insurance.trim():void 0})},P=(i==null?void 0:i.data)||[],u=((O=i==null?void 0:i.pagination)==null?void 0:O.totalPages)||1,M=((E=i==null?void 0:i.pagination)==null?void 0:E.total)||0,L=s=>{b(s.target.value),n(1)},C=(s,t)=>{k(r=>({...r,[s]:t})),n(1)},R=()=>{k({gender:"",fromDate:"",toDate:""}),n(1)},Y=s=>{p(`/patients/${s}`)},Q=s=>(s==null?void 0:s.toLowerCase())==="male"?e.jsx(ne,{className:"text-blue-500"}):(s==null?void 0:s.toLowerCase())==="female"?e.jsx(oe,{className:"text-pink-500"}):e.jsx(I,{className:"text-gray-400"}),z=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",K=s=>{if(!s)return null;const t=new Date(s);if(Number.isNaN(t.getTime()))return null;const r=new Date;let w=r.getFullYear()-t.getFullYear();const g=r.getMonth()-t.getMonth();return(g<0||g===0&&r.getDate()<t.getDate())&&w--,w};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Patients"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage and view all patient records"})]}),S&&e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition",children:[e.jsx(Z,{}),"Add Patient"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:L,placeholder:"Search by name, phone, or patient ID...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),e.jsxs("button",{onClick:()=>y(!m),className:`inline-flex items-center gap-2 px-4 py-2.5 border rounded-lg font-medium transition ${m||l.gender||l.fromDate||l.toDate?"border-blue-500 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(se,{}),"Filters",(l.gender||l.fromDate||l.toDate)&&e.jsx("span",{className:"bg-blue-600 text-white text-xs px-1.5 py-0.5 rounded-full",children:[l.gender,l.fromDate,l.toDate].filter(Boolean).length})]})]}),m&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{value:l.gender,onChange:s=>C("gender",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",lang:"en-GB",value:l.fromDate,onChange:s=>C("fromDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",lang:"en-GB",value:l.toDate,onChange:s=>C("toDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:R,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition",children:[e.jsx(te,{}),"Clear Filters"]})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient ID"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Name"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Phone"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Age"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Gender"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Last Visit"})]})}),e.jsx("tbody",{children:B?[...Array(5)].map((s,t)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})})]},t)):q?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx("div",{className:"text-red-500 mb-2",children:"Failed to load patients"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"text-blue-600 hover:underline",children:"Try again"})]})}):P.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx(I,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No patients found"}),c&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filters"})]})}):P.map(s=>{var t;return e.jsxs("tr",{onClick:()=>Y(s.id),className:"border-b border-gray-50 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:s.patientId||`P${String(s.id).padStart(5,"0")}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((t=s.name)==null?void 0:t.charAt(0))||"P"})}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.phone||"-"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.age?`${s.age} yrs`:s.dateOfBirth?`${K(s.dateOfBirth)} yrs`:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Q(s.gender),e.jsx("span",{className:"text-gray-600 capitalize",children:s.gender||"-"})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:z(s.lastVisit)})]},s.id)})})]})}),!B&&P.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",(a-1)*N+1," to"," ",Math.min(a*N,M)," of ",M," patients"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(s=>Math.max(1,s-1)),disabled:a===1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(re,{className:"text-gray-600"})}),[...Array(Math.min(5,u))].map((s,t)=>{let r;return u<=5||a<=3?r=t+1:a>=u-2?r=u-4+t:r=a-2+t,e.jsx("button",{onClick:()=>n(r),className:`w-10 h-10 rounded-lg font-medium transition ${a===r?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:r},r)}),e.jsx("button",{onClick:()=>n(s=>Math.min(u,s+1)),disabled:a===u,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(ae,{className:"text-gray-600"})})]})]})]})]}),e.jsx(le,{isOpen:T,onClose:()=>{f(!1),F()},title:"Add New Patient",size:"lg",children:e.jsxs("form",{onSubmit:$(H),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Patient name"}),v.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",...o("phone",{required:"Phone is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10-digit phone number"}),v.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",...o("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"text",inputMode:"numeric",...o("dateOfBirth"),placeholder:"dd/mm/yyyy",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{...o("gender"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"MALE",children:"Male"}),e.jsx("option",{value:"FEMALE",children:"Female"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Group"}),e.jsxs("select",{...o("bloodGroup"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select blood group"}),e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{...o("address"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Allergies (comma separated)"}),e.jsx("input",{type:"text",...o("allergies"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g. Penicillin, Pollen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Insurance"}),e.jsx("input",{type:"text",...o("insurance"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Insurance provider / policy"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medical History (one per line)"}),e.jsx("textarea",{...o("medicalHistory"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe medical history entries, one per line"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),F()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:D.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:D.isPending?"Saving...":"Save Patient"})]})]})})]})}export{xe as default};
