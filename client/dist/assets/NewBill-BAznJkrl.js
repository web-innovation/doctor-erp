import{T as Ee,J as be,j as e,u as De,r as n,b as Be,ac as Oe,p as j,a as Le,I as Ue,l as $e,g as ze,K as te,al as ge,y as Ge,ae as _e,am as Ke,af as He,z as g,an as pe}from"./index-BKdfnJ0H.js";import{u as he}from"./useMutation-C5UsUZj5.js";import{b as T}from"./billingService-BogwGKFh.js";import{p as Qe}from"./pharmacyService-BAPmmZUZ.js";const Ye=[{id:"consultation",label:"Consultation",color:"blue"},{id:"pharmacy",label:"Pharmacy",color:"green"},{id:"lab",label:"Lab Test",color:"purple"}],Je=[{value:0,label:"No GST (0%)"},{value:5,label:"GST 5%"},{value:12,label:"GST 12%"},{value:18,label:"GST 18%"}],Ve=[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"upi",label:"UPI"},{value:"netbanking",label:"Net Banking"},{value:"insurance",label:"Insurance"}];function st(){const{id:b}=Ee(),ye=be("billing:create",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),fe=be("billing:edit",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),B=!!b;if(B&&!fe||!B&&!ye)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Access denied"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["You do not have permission to ",B?"edit":"create"," bills."]})]})})});const P=De(),[A,O]=n.useState(""),[x,I]=n.useState(null),[se,C]=n.useState(!1),[c,N]=n.useState("consultation"),[F,ae]=n.useState(""),[le,R]=n.useState(!1),[y,L]=n.useState(""),[i,je]=n.useState(null),[v,ne]=n.useState(""),[Ne,U]=n.useState(!1),[$,ve]=n.useState(!1),{register:d,control:we,handleSubmit:Se,watch:w,setValue:u,formState:{errors:Xe}}=Be({defaultValues:{items:[],discount:0,discountType:"fixed",gstRate:0,paymentMethod:"cash",paymentAmount:0,paymentReference:"",notes:""}}),{fields:k,append:z,remove:Te}=Oe({control:we,name:"items"}),f=w("items")||k,G=w("discount")||0,_=w("discountType"),K=Number(w("gstRate")||0);n.useEffect(()=>{u("gstRate",0)},[u]);const H=w("paymentAmount")||0,{data:Q}=j({queryKey:["billing-doctors"],queryFn:()=>T.getDoctors(),enabled:!0}),q=(Q==null?void 0:Q.data)||[],[o,Y]=n.useState(null),{user:l,normalizeRole:Pe}=Le(),re=Pe(l==null?void 0:l.role),S=re==="DOCTOR",h=!!(l!=null&&l.isClinicAdmin||["SUPER_ADMIN","ACCOUNTANT"].includes(re)),M=n.useMemo(()=>{try{const t=Array.isArray(q)?[...q]:[];return S&&l&&(t.some(s=>s.id===l.id)||t.unshift({id:l.id,name:l.name,email:l.email})),t}catch{return q||[]}},[q,S,l]),{data:J}=j({queryKey:["billing-patients-search",A,o==null?void 0:o.id],queryFn:()=>T.getPatients({search:A,limit:10,doctorId:o==null?void 0:o.id}),enabled:A.length>=2}),{data:V}=j({queryKey:["products-search",F],queryFn:()=>Qe.getProducts({search:F,limit:10}),enabled:F.length>=2&&c==="pharmacy"}),ie=(J==null?void 0:J.data)||[],oe=(V==null?void 0:V.data)||[],{data:X}=j({queryKey:["labs-search",y],queryFn:()=>pe.getLabs({search:y,limit:10}),enabled:c==="lab"&&y.length>=1}),ce=(X==null?void 0:X.data)||[],{data:W}=j({queryKey:["lab-tests",i==null?void 0:i.id,v],queryFn:()=>pe.getLabTests(i==null?void 0:i.id,{search:v,limit:50}),enabled:c==="lab"&&!!i&&v.length>=1}),de=(W==null?void 0:W.data)||[],m=n.useMemo(()=>{const t=f.reduce((ee,xe)=>ee+(parseFloat(xe.quantity)||0)*(parseFloat(xe.unitPrice)||0),0);let a=0;_==="percentage"?a=t*(parseFloat(G)||0)/100:a=parseFloat(G)||0;const s=t-a,r=s*(parseFloat(K)||0)/100,D=s+r;return{subtotal:t,discountAmount:a,afterDiscount:s,gstAmount:r,total:D}},[JSON.stringify(f||[]),G,_,K]),ue=n.useMemo(()=>(f||[]).reduce((t,a)=>{const s=(parseFloat(a.quantity)||0)*(parseFloat(a.unitPrice)||0),r=(a.type||"").toString().toLowerCase();return r==="medicine"&&(t.medicine+=s),r==="lab"&&(t.labTest+=s),t},{medicine:0,labTest:0}),[JSON.stringify(f||[])]),me=Ue(),Z=he({mutationFn:t=>T.createBill(t),onSuccess:t=>{g.success("Bill created successfully"),me.invalidateQueries(["bills"]),P("/billing")},onError:t=>{var a,s;g.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create bill")}}),{data:E}=j({queryKey:["bill",b],queryFn:()=>b?T.getBill(b):Promise.resolve(null),enabled:!!b});n.useEffect(()=>{if(E&&b){const t=E.data||E;if(I(t.patient||null),t.doctor&&Y({id:t.doctor.id,name:t.doctor.name}),t.type){const s=(t.type||"").toString().toUpperCase();N(s==="PHARMACY"?"pharmacy":s==="LAB_TEST"?"lab":"consultation")}const a=(t.items||[]).map(s=>({productId:s.productId||null,description:s.description||"",quantity:s.quantity||1,unitPrice:s.unitPrice||s.amount||0,type:s.type||"other",doctorId:s.doctorId||void 0}));try{u("items",a),t.discountPercent!==null&&t.discountPercent!==void 0?(u("discount",t.discountPercent||0),u("discountType","percentage")):(u("discount",t.discountAmount||0),u("discountType","fixed"));const s=Number(t.subtotal||0),r=Number(t.discountAmount||0),D=s-r;if(D>0){const ee=Number(t.taxAmount||0)/D*100||0;u("gstRate",Math.round(ee*100)/100)}else u("gstRate",0);u("notes",t.notes||"")}catch{}}},[E,b]);const Ae=he({mutationFn:({id:t,data:a})=>T.updateBill(t,a),onSuccess:()=>{g.success("Bill updated successfully"),me.invalidateQueries(["bills"]),P("/billing")},onError:t=>{var a,s;g.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update bill")}}),Ie=t=>{I(t),O(t.name),C(!1)},Ce=t=>{Y(t||null),I(null),O("")};n.useEffect(()=>{if(!h&&S&&l){const t=M.find(a=>a.id===l.id)||{id:l.id,name:l.name};Y(t)}},[l,S,h]);const Fe=t=>{const a=f.findIndex(s=>s.productId===t.id);if(a>=0){const s=(parseInt(f[a].quantity)||0)+1;u(`items.${a}.quantity`,s),g.success(`${t.name} quantity updated`)}else z({productId:t.id,description:t.name,quantity:1,unitPrice:t.sellingPrice||t.mrp||0,type:"medicine"}),g.success(`${t.name} added to bill`);ae(""),R(!1)},Re=t=>{je(t),L(t.name)},ke=t=>{z({productId:null,description:t.name,quantity:1,unitPrice:t.price||0,type:"lab",meta:{labId:(i==null?void 0:i.id)||t.labId,labTestId:t.id}}),g.success(`${t.name} added to bill`),ne(""),U(!1)},qe=()=>{z({productId:null,description:"",quantity:1,unitPrice:0,type:c==="consultation"?"consultation":c==="lab"?"lab":"other",doctorId:c==="consultation"&&S&&!h?l==null?void 0:l.id:void 0})},Me=t=>{if(!x){g.error("Please select a patient");return}if(t.items.length===0){g.error("Please add at least one item");return}const a={pharmacy:"PHARMACY",consultation:"CONSULTATION",lab:"LAB_TEST"},s={patientId:x.id,doctorId:o==null?void 0:o.id,type:a[c]||"MIXED",items:t.items.map(r=>({description:r.description,quantity:parseInt(r.quantity),unitPrice:parseFloat(r.unitPrice),gstPercent:parseFloat(t.gstRate)||0,productId:r.productId||void 0,doctorId:r.doctorId||void 0})),discount:m.discountAmount,discountType:"AMOUNT",taxConfig:{gstRate:parseFloat(t.gstRate)||0},notes:t.notes};$&&parseFloat(t.paymentAmount)>0&&(s.payment={amount:parseFloat(t.paymentAmount),method:t.paymentMethod,reference:t.paymentReference}),b?Ae.mutate({id:b,data:s}):Z.mutate(s)},p=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(t||0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>P("/billing"),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx($e,{className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Bill"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Create a new invoice"})]})]}),e.jsx("form",{onSubmit:Se(Me),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ze,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsxs("select",{value:(o==null?void 0:o.id)||"",onChange:t=>{const a=t.target.value,s=M.find(r=>r.id===a)||null;Ce(s)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[h&&e.jsx("option",{value:"",children:"All Doctors"}),M.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),!h&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Listing patients for all doctors is restricted to clinic admins and accountants."})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:A,onChange:t=>{O(t.target.value),C(!0),t.target.value||I(null)},onFocus:()=>C(!0),placeholder:"Search patient by name or phone...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})]}),se&&ie.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:ie.map(t=>e.jsxs("button",{type:"button",onClick:()=>Ie(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.phone," ",t.email&&`• ${t.email}`]})]},t.id))})]}),x&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-900",children:x.name}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[x.phone,x.email&&` • ${x.email}`]}),x.patientId&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["ID: ",x.patientId]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Type"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ye.map(t=>e.jsx("button",{type:"button",onClick:()=>N(t.id),className:`px-4 py-2 rounded-lg font-medium transition ${c===t.id?t.color==="blue"?"bg-blue-600 text-white":t.color==="green"?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Items"})]}),e.jsxs("button",{type:"button",onClick:qe,className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(Ge,{}),"Add Item"]})]}),c==="pharmacy"&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:F,onChange:t=>{ae(t.target.value),R(!0)},onFocus:()=>R(!0),placeholder:"Search and add products...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"}),le&&oe.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:oe.map(t=>e.jsxs("button",{type:"button",onClick:()=>Fe(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",t.quantity," ",t.unit||"units"]})]}),e.jsx("span",{className:"font-medium text-gray-900",children:p(t.sellingPrice||t.mrp)})]},t.id))})]}),c==="lab"&&e.jsxs("div",{className:"mb-4 bg-white rounded p-4 border border-gray-100",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Lab"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:y,onChange:t=>{L(t.target.value)},onFocus:()=>L(y),placeholder:"Search labs...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),y&&ce.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto",children:ce.map(t=>{var a;return e.jsx("button",{type:"button",onClick:()=>Re(t),className:"w-full text-left px-4 py-2 hover:bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.contactPerson&&e.jsx("p",{className:"text-xs text-gray-500",children:t.contactPerson})]}),e.jsx("div",{className:"text-sm text-gray-500",children:((a=t._count)==null?void 0:a.bills)||""})]})},t.id)})})]})]}),i&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Selected Lab: ",e.jsx("strong",{children:i.name})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:v,onChange:t=>{ne(t.target.value),U(!0)},onFocus:()=>U(!0),placeholder:"Search lab tests...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),Ne&&v.length>=1&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:de.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:"No lab tests found"}):de.map(t=>e.jsx("button",{type:"button",onClick:()=>ke(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.category&&e.jsx("p",{className:"text-sm text-gray-500",children:t.category})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[t.price," ",t.currency||"INR"]})]})},t.id))})]})]})]}),k.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ge,{className:"text-3xl mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No items added yet"}),e.jsx("p",{className:"text-sm mt-1",children:c==="pharmacy"?"Search and add products above":'Click "Add Item" to add items'})]}):e.jsx("div",{className:"space-y-3",children:k.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Description"}),e.jsx("input",{...d(`items.${a}.description`,{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Item description"})]}),t.type==="consultation"&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Doctor"}),e.jsxs("select",{...d(`items.${a}.doctorId`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[!h&&e.jsx("option",{value:l==null?void 0:l.id,children:l==null?void 0:l.name}),h&&e.jsx("option",{value:"",children:"Select doctor"}),M.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Qty"}),e.jsx("input",{type:"number",min:"1",...d(`items.${a}.quantity`,{required:!0,min:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",...d(`items.${a}.unitPrice`,{required:!0,min:0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]})]}),e.jsx("button",{type:"button",onClick:()=>Te(a),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition mt-5",children:e.jsx(_e,{})})]},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ke,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Discount & GST"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Type"}),e.jsxs("select",{...d("discountType"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"fixed",children:"Fixed Amount (₹)"}),e.jsx("option",{value:"percentage",children:"Percentage (%)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Discount ",_==="percentage"?"(%)":"(₹)"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",...d("discount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GST Rate"}),e.jsx("select",{...d("gstRate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Je.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{...d("notes"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Any additional notes for this bill..."})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Medicine Amount"}),e.jsx("span",{className:"text-gray-900",children:p(ue.medicine)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Lab Test Amount"}),e.jsx("span",{className:"text-gray-900",children:p(ue.labTest)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsx("span",{className:"text-gray-900",children:p(m.subtotal)})]}),m.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Discount"}),e.jsxs("span",{className:"text-red-600",children:["-",p(m.discountAmount)]})]}),m.gstAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["GST (",K,"%)"]}),e.jsxs("span",{className:"text-gray-900",children:["+",p(m.gstAmount)]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:"text-gray-900",children:"Total"}),e.jsx("span",{className:"text-blue-600",children:p(m.total)})]})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:t=>ve(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Collect Payment Now"})]}),$&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsx("select",{...d("paymentMethod"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m.total,...d("paymentAmount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:m.total.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference / Transaction ID"}),e.jsx("input",{...d("paymentReference"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),H>0&&H<m.total&&e.jsxs("p",{className:"text-sm text-yellow-600 bg-yellow-50 p-2 rounded",children:["Balance due after payment:"," ",e.jsx("span",{className:"font-medium",children:p(m.total-H)})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("button",{type:"submit",disabled:Z.isPending||!x||k.length===0,className:"w-full inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(He,{}),Z.isPending?"Creating...":"Create Bill"]}),e.jsx("button",{type:"button",onClick:()=>P("/billing"),className:"w-full px-4 py-2.5 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"})]})]})})]})})]}),(se||le)&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>{C(!1),R(!1)}})]})}export{st as default};
