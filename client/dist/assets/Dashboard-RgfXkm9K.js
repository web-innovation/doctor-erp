import{a as z,r as U,p as c,j as e,L as m,q as V,s as G,t as Z,v as ee,w as se,x as ae,y as te,A as le,B as ne,m as re,C as ie,D as de,E as y,G as oe}from"./index-nhLMFlzE.js";import{L as ce,B as me,C as xe,a as pe,b as he,P as ge,c as ue,d as be,p as je,e as ye,f as Ne,i as fe}from"./index-iewveBhW.js";import{a as ve}from"./appointmentService-C1mZ-7f_.js";xe.register(pe,he,ge,ue,be,je,ye,Ne,fe);const N=({icon:t,title:d,value:r,change:s,changeType:o,color:g})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:d}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:r}),s&&e.jsxs("p",{className:`text-sm mt-1 ${o==="increase"?"text-green-600":"text-red-600"}`,children:[o==="increase"?"+":"-",s,"% from yesterday"]})]}),e.jsx("div",{className:`w-12 h-12 ${g} rounded-xl flex items-center justify-center`,children:e.jsx(t,{className:"text-xl text-white"})})]})}),f=({icon:t,title:d,to:r,color:s})=>e.jsxs(m,{to:r,className:"flex items-center gap-3 p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`w-10 h-10 ${s} rounded-lg flex items-center justify-center`,children:e.jsx(t,{className:"text-white"})}),e.jsx("span",{className:"font-medium text-gray-700",children:d}),e.jsx(re,{className:"ml-auto text-gray-400"})]}),we=({type:t,message:d,time:r})=>{const s={warning:"bg-yellow-100 text-yellow-800 border-yellow-200",danger:"bg-red-100 text-red-800 border-red-200",info:"bg-blue-100 text-blue-800 border-blue-200"};return e.jsxs("div",{className:`p-3 rounded-lg border ${s[t]} flex items-start gap-3`,children:[e.jsx(ie,{className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:d}),e.jsx("p",{className:"text-xs opacity-75 mt-1",children:r})]})]})};function Pe(){var w,C,F,S,A,P,D,R,T,k,q,L,E,O,$,B,M,K,I,W,_,Q;const{user:t,normalizeRole:d}=z(),[r]=U.useState("7days"),{activeViewUser:s}=z(),{data:o}=c({queryKey:["rolePermissions"],queryFn:()=>de.getRolePermissions(),staleTime:5*60*1e3}),g=(o==null?void 0:o.data)||o||null,h=d?d((s==null?void 0:s.role)||(t==null?void 0:t.role)||"STAFF"):s&&s.role||t&&t.role||"STAFF",J=!!(s&&s.id&&t&&s.id!==t.id),l=n=>{if(t!=null&&t.isClinicAdmin&&!J)return!0;if(!g)return["DOCTOR","SUPER_ADMIN"].includes((h||"").toString().toUpperCase());const i=g[h==null?void 0:h.toString().toUpperCase()];return i?i.includes(n):!1},{data:a,isLoading:Ce}=c({queryKey:["dashboardStats",(s==null?void 0:s.id)||null],queryFn:()=>y.getStats((s==null?void 0:s.id)||null),placeholderData:{todayOPD:0,totalRevenue:0,appointments:0,pendingBills:0},enabled:l("dashboard:view")}),{data:x}=c({queryKey:["patientTrend",r,(s==null?void 0:s.id)||null],queryFn:()=>y.getPatientTrend(r,(s==null?void 0:s.id)||null),placeholderData:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],data:[12,19,15,25,22,30,28]},enabled:l("dashboard:view")}),{data:p}=c({queryKey:["revenueTrend",r,(s==null?void 0:s.id)||null],queryFn:()=>y.getRevenueTrend(r,(s==null?void 0:s.id)||null),placeholderData:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],data:[5e3,8e3,6500,9e3,7500,12e3,10500]},enabled:l("dashboard:view")}),{data:u}=c({queryKey:["todayAppointments"],queryFn:()=>ve.getTodayAppointments(),placeholderData:[],enabled:l("dashboard:view")}),{data:b}=c({queryKey:["recentPatients"],queryFn:()=>oe.getRecent(5),placeholderData:[],enabled:l("dashboard:view")}),{data:j}=c({queryKey:["dashboardAlerts",(s==null?void 0:s.id)||null],queryFn:()=>y.getAlerts((s==null?void 0:s.id)||null),placeholderData:[],enabled:l("dashboard:view")});if(!l("dashboard:view"))return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-8 border border-gray-100 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome to your workspace"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Hi ",(t==null?void 0:t.name)||"there",", welcome to DocClinic."]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[l("patients:read")||l("patients:create")?e.jsxs(m,{to:"/patients",className:"block p-4 bg-blue-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-blue-700",children:"Patients"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Search and manage patient records"})]}):null,l("appointments:read")||l("appointments:create")?e.jsxs(m,{to:"/appointments",className:"block p-4 bg-green-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-green-700",children:"Appointments"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View schedule or book a patient"})]}):null,l("prescriptions:read")||l("prescriptions:create")?e.jsxs(m,{to:"/prescriptions",className:"block p-4 bg-purple-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-purple-700",children:"Prescriptions"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create and view prescriptions"})]}):null]})]})})});const X={labels:(x==null?void 0:x.labels)||[],datasets:[{label:"Patients",data:(x==null?void 0:x.data)||[],fill:!0,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},Y={labels:(p==null?void 0:p.labels)||[],datasets:[{label:"Revenue (₹)",data:(p==null?void 0:p.data)||[],backgroundColor:"rgba(16, 185, 129, 0.8)",borderRadius:8}]},v={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:["DOCTOR","SUPER_ADMIN"].includes((h||"").toString().toUpperCase())?`Welcome back, Dr. ${(t==null?void 0:t.name)||"Doctor"}!`:`Welcome, ${(t==null?void 0:t.name)||"Staff"}.`}),e.jsx("p",{className:"text-gray-500 mt-1",children:l("appointments:read")||l("patients:read")?"Here's what's happening at your clinic today.":"Welcome to your workspace."})]}),l("appointments:read")||l("reports:collections")?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(N,{icon:V,title:"Today's OPD",value:((C=(w=a==null?void 0:a.data)==null?void 0:w.appointments)==null?void 0:C.total)||0,change:Math.abs((S=(F=a==null?void 0:a.data)==null?void 0:F.appointments)==null?void 0:S.growth)||0,changeType:((P=(A=a==null?void 0:a.data)==null?void 0:A.appointments)==null?void 0:P.growth)>=0?"increase":"decrease",color:"bg-blue-500"}),e.jsx(N,{icon:G,title:"Today's Revenue",value:`₹${(((R=(D=a==null?void 0:a.data)==null?void 0:D.revenue)==null?void 0:R.total)||0).toLocaleString()}`,change:Math.abs((k=(T=a==null?void 0:a.data)==null?void 0:T.revenue)==null?void 0:k.growth)||0,changeType:((L=(q=a==null?void 0:a.data)==null?void 0:q.revenue)==null?void 0:L.growth)>=0?"increase":"decrease",color:"bg-green-500"}),e.jsx(N,{icon:Z,title:"New Patients",value:((O=(E=a==null?void 0:a.data)==null?void 0:E.patients)==null?void 0:O.newToday)||0,change:((B=($=a==null?void 0:a.data)==null?void 0:$.appointments)==null?void 0:B.completed)||0,changeType:"increase",color:"bg-purple-500"}),e.jsx(N,{icon:ee,title:"Bills Today",value:((K=(M=a==null?void 0:a.data)==null?void 0:M.bills)==null?void 0:K.count)||0,change:((W=(I=a==null?void 0:a.data)==null?void 0:I.appointments)==null?void 0:W.pending)||0,changeType:"decrease",color:"bg-orange-500"})]}):null,e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient Count"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Last 7 days trend"})]}),e.jsx(se,{className:"text-blue-500"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ce,{data:X,options:v})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Revenue"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Last 7 days"})]}),e.jsx(G,{className:"text-green-500"})]}),e.jsx("div",{className:"h-64",children:e.jsx(me,{data:Y,options:v})})]})]}),(l("appointments:create")||l("prescriptions:create")||l("patients:create"))&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l("appointments:create")&&e.jsx(f,{icon:Z,title:"New Appointment",to:"/appointments/new",color:"bg-blue-500"}),l("prescriptions:create")&&e.jsx(f,{icon:ae,title:"New Prescription",to:"/prescriptions/new",color:"bg-purple-500"}),l("patients:create")&&e.jsx(f,{icon:te,title:"Add Patient",to:"/patients/new",color:"bg-green-500"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alerts"}),e.jsx(le,{className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:((Q=(_=j==null?void 0:j.data)==null?void 0:_.alerts)==null?void 0:Q.length)>0?j.data.alerts.map((n,i)=>e.jsx(we,{type:n.type,message:n.message,time:n.title},i)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No alerts at this time"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Patients"}),e.jsx(m,{to:"/patients",className:"text-blue-600 text-sm hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:(b==null?void 0:b.length)>0?b.map(n=>{var i;return e.jsxs(m,{to:`/patients/${n.id}`,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium",children:((i=n.name)==null?void 0:i.charAt(0))||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:n.name}),e.jsx("p",{className:"text-sm text-gray-500",children:n.phone})]})]},n.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent patients"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Today's Appointments"}),e.jsx(m,{to:"/appointments",className:"text-blue-600 text-sm hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:(u==null?void 0:u.length)>0?u.slice(0,5).map(n=>{var i,H;return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:((i=n.patient)==null?void 0:i.name)||n.patientName||"Unknown Patient"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n.timeSlot||n.time||"-"," - ",n.type||"Consultation"]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n.status==="CONFIRMED"||n.status==="confirmed"?"bg-green-100 text-green-700":n.status==="COMPLETED"||n.status==="completed"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:((H=n.status)==null?void 0:H.toLowerCase())||"scheduled"})]},n.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No appointments today"})})]})]})]})})}export{Pe as default};
