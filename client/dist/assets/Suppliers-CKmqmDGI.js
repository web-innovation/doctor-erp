import{p as y,r as h,I as C,j as e,z as i}from"./index-DfbFSgDY.js";import{u as p}from"./useMutation-bt9QuOne.js";import{p as u}from"./purchaseService-FJAkHuKk.js";function E(){const{data:n,isLoading:x,refetch:o}=y({queryKey:["suppliers"],queryFn:()=>u.getSuppliers(""),keepPreviousData:!0}),N=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:[],[m,c]=h.useState(null),[t,r]=h.useState({name:"",phone:"",email:"",address:"",gstNumber:"",notes:""}),d=C(),g=p({mutationFn:s=>u.createSupplier(s),onSuccess:async()=>{i.success("Supplier created"),r({name:"",phone:"",email:"",address:"",gstNumber:"",notes:""}),await o()}}),b=p({mutationFn:({id:s,body:a})=>u.updateSupplier(s,a),onSuccess:async()=>{i.success("Supplier updated"),c(null),await o()}}),j=p({mutationFn:s=>u.deleteSupplier(s),onMutate:async s=>{await d.cancelQueries({queryKey:["suppliers"]});const a=d.getQueryData(["suppliers"]);return d.setQueryData(["suppliers"],l=>(Array.isArray(l)?l:Array.isArray(l==null?void 0:l.data)?l.data:[]).filter(v=>v.id!==s)),{previous:a}},onError:(s,a,l)=>{l!=null&&l.previous&&d.setQueryData(["suppliers"],l.previous),i.error("Failed to delete supplier")},onSettled:async()=>{i.success("Supplier deleted"),await o()}});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Suppliers"})}),e.jsxs("div",{className:"bg-white rounded p-4 mb-6",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Create Supplier"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"p-2 border rounded",placeholder:"Name",value:t.name,onChange:s=>r(a=>({...a,name:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Phone",value:t.phone,onChange:s=>r(a=>({...a,phone:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Email",value:t.email,onChange:s=>r(a=>({...a,email:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"GST Number",value:t.gstNumber,onChange:s=>r(a=>({...a,gstNumber:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded col-span-2",placeholder:"Address",value:t.address,onChange:s=>r(a=>({...a,address:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded col-span-2",placeholder:"Notes",value:t.notes,onChange:s=>r(a=>({...a,notes:s.target.value}))})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded",onClick:()=>g.mutate(t),children:"Create"}),e.jsx("button",{className:"px-3 py-2 border rounded",onClick:()=>r({name:"",phone:"",email:"",address:"",gstNumber:"",notes:""}),children:"Reset"})]})]}),e.jsxs("div",{className:"bg-white rounded p-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Supplier List"}),x?e.jsx("div",{children:"Loadingâ€¦"}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2",children:"Phone"}),e.jsx("th",{className:"p-2",children:"GST"}),e.jsx("th",{className:"p-2",children:" "})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.phone||"-"}),e.jsx("td",{className:"p-2",children:s.gstNumber||"-"}),e.jsxs("td",{className:"p-2 text-right",children:[e.jsx("button",{className:"px-2 py-1 mr-2 text-sm border rounded",onClick:()=>{c(s),r({name:s.name,phone:s.phone||"",email:s.email||"",address:s.address||"",gstNumber:s.gstNumber||"",notes:s.notes||""})},children:"Edit"}),e.jsx("button",{className:"px-2 py-1 text-sm bg-red-600 text-white rounded",onClick:()=>{confirm("Delete supplier?")&&j.mutate(s.id)},children:"Delete"})]})]},s.id))})]}),m&&e.jsxs("div",{className:"mt-4 p-3 border rounded",children:[e.jsx("h4",{className:"font-medium",children:"Edit Supplier"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("input",{className:"p-2 border rounded",placeholder:"Name",value:t.name,onChange:s=>r(a=>({...a,name:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Phone",value:t.phone,onChange:s=>r(a=>({...a,phone:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Email",value:t.email,onChange:s=>r(a=>({...a,email:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded",placeholder:"GST Number",value:t.gstNumber,onChange:s=>r(a=>({...a,gstNumber:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded col-span-2",placeholder:"Address",value:t.address,onChange:s=>r(a=>({...a,address:s.target.value}))}),e.jsx("input",{className:"p-2 border rounded col-span-2",placeholder:"Notes",value:t.notes,onChange:s=>r(a=>({...a,notes:s.target.value}))})]}),e.jsxs("div",{className:"mt-3 flex gap-2 justify-end",children:[e.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>c(null),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:()=>b.mutate({id:m.id,body:t}),children:"Save"})]})]})]})]})})}export{E as default};
