import{ag as A,I as J,r as h,b as H,p as V,z as p,j as e,n as me,o as xe,i as Te,aE as Ee,aF as Fe,aG as We,aH as U,aI as $,c as C,d as T,a6 as ue,af as D,aJ as qe,as as Ie,a7 as X,h as pe,W as Me,D as k,a0 as Y,a as Re,g as de,aK as Le,s as Oe,aL as De,k as Be}from"./index-R75PvMZ4.js";import{u as P}from"./useMutation-DakZEmRO.js";const G={getEmailConfig:async()=>{var s;return((s=(await A.get("/notifications/email/config")).data)==null?void 0:s.data)||null},saveEmailConfig:async l=>(await A.post("/notifications/email/config",l)).data,testEmailConfig:async()=>(await A.post("/notifications/email/test")).data,sendAppointmentReminder:async l=>(await A.post(`/notifications/appointment-reminder/${l}`)).data,sendPrescriptionEmail:async l=>(await A.post(`/notifications/prescription/${l}`)).data,sendBillEmail:async l=>(await A.post(`/notifications/bill/${l}`)).data,sendBulkReminders:async(l=24)=>(await A.post("/notifications/bulk-reminders",{hours:l})).data,getEmailLogs:async(l={})=>{var f;return((f=(await A.get("/notifications/email/logs",{params:l})).data)==null?void 0:f.data)||{logs:[],pagination:{}}},getOtpTemplate:async()=>{var s;return((s=(await A.get("/notifications/email/otp-template")).data)==null?void 0:s.data)||null},saveOtpTemplate:async l=>(await A.post("/notifications/email/otp-template",l)).data,getWhatsAppConfig:async()=>{var s;return((s=(await A.get("/notifications/whatsapp/config")).data)==null?void 0:s.data)||null},saveWhatsAppConfig:async l=>(await A.post("/notifications/whatsapp/config",l)).data,testWhatsAppConfig:async l=>(await A.post("/notifications/whatsapp/test",{phoneNumber:l})).data},Ge=[{id:"gmail-app-password",name:"Gmail (App Password)",icon:Te,color:"text-green-500",recommended:!0},{id:"gmail",name:"Gmail (OAuth2)",icon:Ee,color:"text-red-500"},{id:"outlook",name:"Outlook (OAuth2)",icon:Fe,color:"text-blue-500"},{id:"smtp",name:"SMTP (Custom)",icon:We,color:"text-gray-500"}];function Ve(){const l=J(),[s,f]=h.useState("gmail-app-password"),[u,E]=h.useState({}),[j,y]=h.useState(!1),{register:o,handleSubmit:F,reset:W,setValue:c,watch:N,formState:{errors:n}}=H({defaultValues:{provider:"gmail-app-password",userEmail:"",fromName:"Docsy",appPassword:"",clientId:"",clientSecret:"",refreshToken:"",tenantId:"",host:"",port:587,user:"",password:"",secure:!1}});N("provider");const{data:t,isLoading:S}=V({queryKey:["emailConfig"],queryFn:()=>G.getEmailConfig()});h.useEffect(()=>{t!=null&&t.configured&&(f(t.provider),c("provider",t.provider),c("userEmail",t.userEmail||""),c("fromName",t.fromName||"Docsy"))},[t,c]);const w=P({mutationFn:G.saveEmailConfig,onSuccess:()=>{p.success("Email configuration saved successfully"),l.invalidateQueries(["emailConfig"])},onError:a=>{var x,M;p.error(((M=(x=a.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to save configuration")}}),b=P({mutationFn:G.testEmailConfig,onSuccess:a=>{p.success(a.message||"Test email sent successfully")},onError:a=>{var x,M;p.error(((M=(x=a.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to send test email")}}),{data:v,isLoading:q}=V({queryKey:["otpTemplate"],queryFn:()=>G.getOtpTemplate()}),[I,i]=h.useState(""),[g,R]=h.useState([]);h.useEffect(()=>{typeof v<"u"&&(v&&typeof v=="object"?(i(v.template||""),R(v.placeholders||[])):(i(v||""),R([])))},[v]);const B=P({mutationFn:a=>G.saveOtpTemplate(a),onSuccess:()=>{p.success("OTP email template saved"),l.invalidateQueries(["otpTemplate"])},onError:a=>{var x,M;p.error(((M=(x=a.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to save template")}}),ae=()=>{B.mutate({template:I})},ne=a=>{const x={provider:s,userEmail:a.userEmail,fromName:a.fromName};s==="gmail-app-password"?x.appPassword=a.appPassword:s==="gmail"?(x.clientId=a.clientId,x.clientSecret=a.clientSecret,x.refreshToken=a.refreshToken):s==="outlook"?(x.clientId=a.clientId,x.clientSecret=a.clientSecret,x.refreshToken=a.refreshToken,x.tenantId=a.tenantId):s==="smtp"&&(x.host=a.host,x.port=parseInt(a.port),x.user=a.user,x.password=a.password,x.secure=a.secure),w.mutate(x)},ie=()=>{y(!0),b.mutate(void 0,{onSettled:()=>y(!1)})},L=a=>{E(x=>({...x,[a]:!x[a]}))};return S?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(me,{className:"text-sky-500"}),"Email Notifications"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure OAuth2 email for appointment reminders, prescriptions, and bills"})]}),(t==null?void 0:t.configured)&&e.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600 bg-green-50 px-3 py-1 rounded-full",children:[e.jsx(xe,{})," Configured"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ge.map(a=>e.jsxs("button",{type:"button",onClick:()=>{f(a.id),c("provider",a.id)},className:`p-4 rounded-lg border-2 transition-all relative ${s===a.id?"border-sky-500 bg-sky-50":"border-gray-200 hover:border-gray-300"}`,children:[a.recommended&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:"Easy"}),e.jsx(a.icon,{className:`text-2xl mx-auto ${a.color}`}),e.jsx("p",{className:"text-sm font-medium mt-2",children:a.name})]},a.id))}),e.jsxs("form",{onSubmit:F(ne),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",...o("userEmail",{required:"Email is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-email@gmail.com"}),n.userEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:n.userEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",...o("fromName"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"Docsy"})]})]}),s==="gmail-app-password"&&e.jsxs("div",{className:"space-y-4 p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-700",children:[e.jsx(U,{}),e.jsx("span",{children:"Simple setup - just need Gmail App Password"}),e.jsxs("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:underline flex items-center gap-1",children:["Get App Password ",e.jsx($,{className:"text-xs"})]})]}),e.jsxs("div",{className:"bg-green-100 p-3 rounded-lg text-sm text-green-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How to get App Password:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Enable 2-Factor Authentication on your Google Account"}),e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"myaccount.google.com/apppasswords"})]}),e.jsx("li",{children:'Select "Mail" and your device, click Generate'}),e.jsx("li",{children:"Copy the 16-character password (no spaces needed)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["App Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.appPassword?"text":"password",...o("appPassword",{required:s==="gmail-app-password"&&"App Password is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx xxxx xxxx xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("appPassword"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.appPassword?e.jsx(C,{}):e.jsx(T,{})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"16-character password from Google App Passwords"})]})]}),s==="gmail"&&e.jsxs("div",{className:"space-y-4 p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-700",children:[e.jsx(U,{}),e.jsx("span",{children:"Requires Google Cloud Console OAuth2 credentials"}),e.jsxs("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer",className:"text-red-600 hover:underline flex items-center gap-1",children:["Get Credentials ",e.jsx($,{className:"text-xs"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("clientId",{required:s==="gmail"&&"Client ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx.apps.googleusercontent.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Secret ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.clientSecret?"text":"password",...o("clientSecret",{required:s==="gmail"&&"Client Secret is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"GOCSPX-xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("clientSecret"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.clientSecret?e.jsx(C,{}):e.jsx(T,{})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Refresh Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.refreshToken?"text":"password",...o("refreshToken",{required:s==="gmail"&&"Refresh Token is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"1//xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("refreshToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.refreshToken?e.jsx(C,{}):e.jsx(T,{})})]})]})]}),s==="outlook"&&e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(U,{}),e.jsx("span",{children:"Requires Azure AD App Registration"}),e.jsxs("a",{href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Get Credentials ",e.jsx($,{className:"text-xs"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("clientId",{required:s==="outlook"&&"Client ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tenant ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("tenantId",{required:s==="outlook"&&"Tenant ID is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Secret ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.clientSecret?"text":"password",...o("clientSecret",{required:s==="outlook"&&"Client Secret is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"xxxx~xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("clientSecret"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.clientSecret?e.jsx(C,{}):e.jsx(T,{})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Refresh Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.refreshToken?"text":"password",...o("refreshToken",{required:s==="outlook"&&"Refresh Token is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"M.xxxx"}),e.jsx("button",{type:"button",onClick:()=>L("refreshToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.refreshToken?e.jsx(C,{}):e.jsx(T,{})})]})]})]}),s==="smtp"&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(U,{}),e.jsx("span",{children:"Use any SMTP server (AWS SES, SendGrid, Mailgun, etc.)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SMTP Host ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("host",{required:s==="smtp"&&"Host is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"smtp.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),e.jsx("input",{type:"number",...o("port"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"587"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...o("user",{required:s==="smtp"&&"Username is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-smtp-user"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.password?"text":"password",...o("password",{required:s==="smtp"&&"Password is required"}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent",placeholder:"your-smtp-password"}),e.jsx("button",{type:"button",onClick:()=>L("password"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.password?e.jsx(C,{}):e.jsx(T,{})})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...o("secure"),className:"w-4 h-4 text-sky-500 rounded focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Use TLS/SSL (port 465)"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:ie,disabled:j||!(t!=null&&t.configured),className:"flex items-center gap-2 px-4 py-2 text-sky-600 bg-sky-50 rounded-lg hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-sky-500 border-t-transparent rounded-full animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{})," Send Test Email"]})}),e.jsx("button",{type:"submit",disabled:w.isPending,className:"flex items-center gap-2 px-6 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 disabled:opacity-50",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{})," Save Configuration"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"OTP Email Template"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Customize the HTML template used for email OTPs. Use ",e.jsx("span",{className:"font-mono",children:"{{code}}"})," and ",e.jsx("span",{className:"font-mono",children:"{{expiryMinutes}}"})," as placeholders."]})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("textarea",{value:I,onChange:a=>i(a.target.value),className:"w-full h-48 p-3 border border-gray-200 rounded-lg font-sans",placeholder:"<p>Your OTP is <strong>{{code}}</strong></p>"})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{type:"button",onClick:ae,disabled:B==null?void 0:B.isLoading,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(D,{})," ",B!=null&&B.isLoading?"Saving...":"Save Template"]})})]}),(g==null?void 0:g.length)>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:"Available placeholders:"}),e.jsx("ul",{className:"list-disc list-inside",children:g.map(a=>e.jsx("li",{className:"font-mono",children:a},a))})]})]})}function ge(l){return qe({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 0C5.381-.008.008 5.352 0 11.971V12c0 6.64 5.359 12 12 12 6.64 0 12-5.36 12-12 0-6.641-5.36-12-12-12zm0 20.801c-4.846.015-8.786-3.904-8.801-8.75V12c-.014-4.846 3.904-8.786 8.75-8.801H12c4.847-.014 8.786 3.904 8.801 8.75V12c.015 4.847-3.904 8.786-8.75 8.801H12zm5.44-11.76c0 1.359-1.12 2.479-2.481 2.479-1.366-.007-2.472-1.113-2.479-2.479 0-1.361 1.12-2.481 2.479-2.481 1.361 0 2.481 1.12 2.481 2.481zm0 5.919c0 1.36-1.12 2.48-2.481 2.48-1.367-.008-2.473-1.114-2.479-2.48 0-1.359 1.12-2.479 2.479-2.479 1.361-.001 2.481 1.12 2.481 2.479zm-5.919 0c0 1.36-1.12 2.48-2.479 2.48-1.368-.007-2.475-1.113-2.481-2.48 0-1.359 1.12-2.479 2.481-2.479 1.358-.001 2.479 1.12 2.479 2.479zm0-5.919c0 1.359-1.12 2.479-2.479 2.479-1.367-.007-2.475-1.112-2.481-2.479 0-1.361 1.12-2.481 2.481-2.481 1.358 0 2.479 1.12 2.479 2.481z"},child:[]}]})(l)}const _e=[{id:"manual",name:"Manual (wa.me links)",icon:X,color:"text-green-500",description:"Opens WhatsApp Web for staff to send manually",recommended:!0},{id:"twilio",name:"Twilio WhatsApp",icon:ge,color:"text-red-500",description:"Automated sending via Twilio API"},{id:"whatsapp-business",name:"WhatsApp Business API",icon:pe,color:"text-green-600",description:"Official WhatsApp Business Cloud API"}];function He(){const l=J(),[s,f]=h.useState("manual"),[u,E]=h.useState({}),[j,y]=h.useState(!1),{register:o,handleSubmit:F,reset:W,setValue:c,watch:N,formState:{errors:n}}=H({defaultValues:{provider:"manual",clinicWhatsAppNumber:"",clinicWhatsAppName:"",twilioAccountSid:"",twilioAuthToken:"",twilioWhatsAppNumber:"",wabAccessToken:"",wabPhoneNumberId:"",wabBusinessId:""}});N("provider");const{data:t,isLoading:S}=V({queryKey:["whatsappConfig"],queryFn:()=>G.getWhatsAppConfig()});h.useEffect(()=>{t!=null&&t.configured&&(f(t.provider),c("provider",t.provider),c("clinicWhatsAppNumber",t.clinicWhatsAppNumber||""),c("clinicWhatsAppName",t.clinicWhatsAppName||""))},[t,c]);const w=P({mutationFn:G.saveWhatsAppConfig,onSuccess:()=>{p.success("WhatsApp configuration saved successfully"),l.invalidateQueries(["whatsappConfig"])},onError:i=>{var g,R;p.error(((R=(g=i.response)==null?void 0:g.data)==null?void 0:R.message)||"Failed to save configuration")}}),b=P({mutationFn:G.testWhatsAppConfig,onSuccess:i=>{i.url?(window.open(i.url,"_blank"),p.success("WhatsApp Web opened. Send the test message to verify.")):p.success(i.message||"Test message sent successfully")},onError:i=>{var g,R;p.error(((R=(g=i.response)==null?void 0:g.data)==null?void 0:R.message)||"Failed to send test message")}}),v=i=>{const g={provider:s,clinicWhatsAppNumber:i.clinicWhatsAppNumber,clinicWhatsAppName:i.clinicWhatsAppName};s==="twilio"?(g.twilioAccountSid=i.twilioAccountSid,g.twilioAuthToken=i.twilioAuthToken,g.twilioWhatsAppNumber=i.twilioWhatsAppNumber):s==="whatsapp-business"&&(g.wabAccessToken=i.wabAccessToken,g.wabPhoneNumberId=i.wabPhoneNumberId,g.wabBusinessId=i.wabBusinessId),w.mutate(g)},q=()=>{y(!0),b.mutate(void 0,{onSettled:()=>y(!1)})},I=i=>{E(g=>({...g,[i]:!g[i]}))};return S?e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"WhatsApp Notifications"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure WhatsApp messaging for your clinic"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t!=null&&t.configured?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm",children:[e.jsx(xe,{}),"Configured"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-sm",children:[e.jsx(Ie,{}),"Not Configured"]})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(U,{className:"text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Multi-Clinic WhatsApp Setup"}),e.jsx("p",{children:"Each clinic can have its own WhatsApp number. Messages will appear to patients as coming from your clinic's WhatsApp account."}),e.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside text-blue-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Manual:"})," Staff sends from clinic's phone with pre-filled message"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Twilio:"})," Automated sending from your Twilio WhatsApp number"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Business API:"})," Official WhatsApp Business for verified business accounts"]})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"WhatsApp Provider"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:_e.map(i=>{const g=i.icon;return e.jsxs("button",{type:"button",onClick:()=>{f(i.id),c("provider",i.id)},className:`relative p-4 border-2 rounded-xl text-left transition-all ${s===i.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[i.recommended&&e.jsx("span",{className:"absolute top-2 right-2 text-xs bg-green-500 text-white px-2 py-0.5 rounded-full",children:"Recommended"}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(g,{className:`text-2xl ${i.color}`}),e.jsx("span",{className:"font-medium text-gray-900",children:i.name})]}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.id)})})]}),e.jsxs("form",{onSubmit:F(v),className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(X,{className:"text-green-500"}),"Clinic WhatsApp Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic WhatsApp Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",...o("clinicWhatsAppNumber",{required:"Phone number is required"}),placeholder:"+91 9876543210",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),n.clinicWhatsAppNumber&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.clinicWhatsAppNumber.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This is the phone number patients will see as the sender"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name (as shown in WhatsApp)"}),e.jsx("input",{type:"text",...o("clinicWhatsAppName"),placeholder:"City Health Clinic",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your WhatsApp Business profile name"})]})]})]}),s==="twilio"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ge,{className:"text-red-500"}),"Twilio Configuration"]}),e.jsxs("a",{href:"https://console.twilio.com",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-red-600 hover:underline flex items-center gap-1",children:["Get credentials ",e.jsx($,{className:"text-xs"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account SID *"}),e.jsx("input",{type:"text",...o("twilioAccountSid",{required:s==="twilio"?"Account SID is required":!1}),placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auth Token *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.twilioAuthToken?"text":"password",...o("twilioAuthToken",{required:s==="twilio"?"Auth Token is required":!1}),placeholder:"Your Auth Token",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("button",{type:"button",onClick:()=>I("twilioAuthToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.twilioAuthToken?e.jsx(C,{}):e.jsx(T,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Twilio WhatsApp Number *"}),e.jsx("input",{type:"text",...o("twilioWhatsAppNumber",{required:s==="twilio"?"WhatsApp number is required":!1}),placeholder:"+14155238886",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Twilio sandbox number or your registered WhatsApp number"})]})]})]}),s==="whatsapp-business"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(pe,{className:"text-green-600"}),"WhatsApp Business API Configuration"]}),e.jsxs("a",{href:"https://developers.facebook.com/docs/whatsapp/cloud-api/get-started",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-green-600 hover:underline flex items-center gap-1",children:["Setup Guide ",e.jsx($,{className:"text-xs"})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," WhatsApp Business API requires a verified Facebook Business account and approved WhatsApp Business phone number."]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Token *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.wabAccessToken?"text":"password",...o("wabAccessToken",{required:s==="whatsapp-business"?"Access Token is required":!1}),placeholder:"Your permanent access token",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx("button",{type:"button",onClick:()=>I("wabAccessToken"),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u.wabAccessToken?e.jsx(C,{}):e.jsx(T,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number ID *"}),e.jsx("input",{type:"text",...o("wabPhoneNumberId",{required:s==="whatsapp-business"?"Phone Number ID is required":!1}),placeholder:"1234567890123456",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp Business Account ID"}),e.jsx("input",{type:"text",...o("wabBusinessId"),placeholder:"1234567890123456",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),s==="manual"&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-green-900 flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"text-green-500"}),"How Manual Mode Works"]}),e.jsxs("ol",{className:"text-sm text-green-800 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:'When you click "Send via WhatsApp", a new tab opens with WhatsApp Web'}),e.jsx("li",{children:"The message is pre-filled with prescription/appointment details"}),e.jsx("li",{children:'Staff clicks "Send" in WhatsApp Web to complete sending'}),e.jsx("li",{children:"The message appears to come from your clinic's WhatsApp account (the one logged into WhatsApp Web)"})]}),e.jsxs("p",{className:"text-sm text-green-700 mt-3",children:[e.jsx("strong",{children:"Tip:"})," Keep WhatsApp Web logged in on the clinic's computer with the clinic's WhatsApp Business account."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:q,disabled:j||!(t!=null&&t.configured),className:"inline-flex items-center gap-2 px-4 py-2 text-green-600 bg-green-50 rounded-lg hover:bg-green-100 transition disabled:opacity-50",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"○"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{}),"Send Test Message"]})}),e.jsx("button",{type:"submit",disabled:w.isPending,className:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"○"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{}),"Save Configuration"]})})]})]})]})}const ce=["DOCTOR","RECEPTIONIST","PHARMACIST","ACCOUNTANT","STAFF","PATIENT"],te=["dashboard:view","patients:read","patients:create","patients:update","appointments:read","appointments:create","appointments:update","prescriptions:read","prescriptions:create","pharmacy:read","pharmacy:create","billing:read","billing:create","billing:edit","reports:opd","purchases:read","purchases:create","ledger:read","ledger:create","ledger:update","ledger:delete"];te.push("leaves:read","leaves:create","leaves:update");const ze=["labs:read","labs:create","labs:update","labs:tests"],Qe=["agents:read","agents:create","agents:update","commissions:read","commissions:pay"];function Ke(){const l=J(),{data:s,isLoading:f,isError:u,error:E,refetch:j}=V({queryKey:["rolePermissions"],queryFn:()=>k.getRolePermissions()}),[y,o]=h.useState(null);h.useEffect(()=>{if(s!=null&&s.data)o(s.data);else if(!f&&!u){const n={};ce.forEach(t=>{n[t]=te.slice()}),o(n)}},[s,f,u]);const F=P({mutationFn:k.updateRolePermissions,onSuccess:()=>{l.invalidateQueries({queryKey:["rolePermissions"]}),p.success("Role permissions updated")},onError:n=>{var t,S;p.error(((S=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:S.message)||"Failed to update role permissions")}}),W={"labs:manage":["labs:read"],"labs:create":["labs:read"],"labs:update":["labs:read"],"labs:tests":["labs:read"],"agents:manage":["agents:read"],"agents:create":["agents:read"],"agents:update":["agents:read"],"commissions:pay":["commissions:read"],"ledger:create":["ledger:read"],"ledger:update":["ledger:read"],"ledger:delete":["ledger:read"],"leaves:create":["leaves:read"],"leaves:update":["leaves:read"]},c=Object.keys(W).reduce((n,t)=>(W[t].forEach(S=>{n[S]=n[S]||[],n[S].push(t)}),n),{}),N=(n,t)=>{o(S=>{const w=new Set(S[n]||[]);if(w.has(t)){w.delete(t);const b=[t];for(;b.length;){const v=b.shift(),q=c[v]||[];for(const I of q)w.has(I)&&(w.delete(I),b.push(I))}}else{w.add(t);const b=W[t]||[];for(const v of b)w.add(v)}return{...S,[n]:Array.from(w)}})};return f?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."})]}):u?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsxs("p",{className:"text-sm text-red-500 mb-4",children:["Failed to load role permissions: ",(E==null?void 0:E.message)||"Unknown error"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{variant:"secondary",onClick:()=>j(),children:"Retry"}),e.jsx(Y,{variant:"ghost",onClick:()=>{alert("If this persists, ensure the backend migration/role-permissions endpoint is applied and the server is running.")},children:"Help"})]})]}):y?e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Role-based Feature Access"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Grant or revoke feature access per role. Changes affect only this clinic."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ce.map(n=>e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("strong",{children:n})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"General"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:te.map(t=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(t),onChange:()=>N(n,t)}),e.jsx("span",{className:"text-sm",children:t})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Labs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ze.map(t=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(t),onChange:()=>N(n,t)}),e.jsx("span",{className:"text-sm",children:t})]},t))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Agents & Commissions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Qe.map(t=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-2 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(y[n]||[]).includes(t),onChange:()=>N(n,t)}),e.jsx("span",{className:"text-sm",children:t})]},t))})]})]},n))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(Y,{variant:"primary",onClick:()=>F.mutate(y),loading:F.isLoading,children:"Save Role Permissions"})})]}):null}const Ue=["appointments:read","prescriptions:read","billing:read","pharmacy:read"];function $e(){const l=J(),{data:s,isLoading:f,isError:u,refetch:E}=V({queryKey:["rolePermissions"],queryFn:()=>k.getRolePermissions()}),[j,y]=h.useState([]);h.useEffect(()=>{s&&s.data&&s.data.PATIENT?y(Array.isArray(s.data.PATIENT)?s.data.PATIENT:[]):!f&&!u&&y([])},[s,f,u]);const o=P({mutationFn:c=>k.updateRolePermissions(c),onSuccess:()=>{l.invalidateQueries({queryKey:["rolePermissions"]}),p.success("Mobile access updated")},onError:c=>{var N,n;p.error(((n=(N=c==null?void 0:c.response)==null?void 0:N.data)==null?void 0:n.message)||"Failed to update mobile access")}}),F=c=>{y(N=>{const n=new Set(N||[]);return n.has(c)?n.delete(c):n.add(c),Array.from(n)})},W=()=>{const c=s&&s.data?{...s.data}:{};c.PATIENT=j,o.mutate(c)};return f?e.jsx("div",{className:"p-4",children:"Loading mobile access..."}):u?e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-red-600",children:"Failed to load mobile access settings."}),e.jsx("div",{className:"mt-2",children:e.jsx(Y,{variant:"ghost",onClick:()=>E(),children:"Retry"})})]}):e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Mobile App"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Grant mobile (patient) access to select features."}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Ue.map(c=>e.jsxs("label",{className:"inline-flex items-center space-x-2 bg-gray-50 px-3 py-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:(j||[]).includes(c),onChange:()=>F(c)}),e.jsx("span",{className:"text-sm",children:c})]},c))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Y,{variant:"primary",onClick:W,loading:o.isLoading,children:"Save Mobile Access"})})]})}const Ye=[{id:"profile",label:"Profile",icon:de},{id:"clinic",label:"Clinic",icon:Le},{id:"consultation",label:"Consultation Fees",icon:Oe},{id:"email",label:"Email",icon:me},{id:"whatsapp",label:"WhatsApp",icon:X},{id:"preferences",label:"Preferences",icon:De},{id:"access",label:"Access Management",icon:de}],Je=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Xe=[{id:"todayAppointments",label:"Today's Appointments",enabled:!0},{id:"revenue",label:"Revenue Stats",enabled:!0},{id:"recentPatients",label:"Recent Patients",enabled:!0},{id:"lowStock",label:"Low Stock Alerts",enabled:!0},{id:"pendingBills",label:"Pending Bills",enabled:!0},{id:"upcomingFollowups",label:"Upcoming Follow-ups",enabled:!1}];function rs(){const l=J(),{user:s,loadUser:f}=Re(),[u,E]=h.useState("profile"),[j,y]=h.useState(!1),[o,F]=h.useState(!1),{register:W,handleSubmit:c,formState:{errors:N}}=H({defaultValues:{name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||""}}),{register:n,handleSubmit:t,reset:S,watch:w,formState:{errors:b}}=H(),v=w("newPassword"),{register:q,handleSubmit:I,setValue:i,formState:{errors:g}}=H(),{register:R,handleSubmit:B,setValue:ae}=H(),[ne,ie]=h.useState(Je.map(r=>({day:r,isOpen:r!=="Sunday",openTime:"09:00",closeTime:"18:00",breakStart:"13:00",breakEnd:"14:00"}))),[L,a]=h.useState(Xe),[x,M]=h.useState({}),{data:O,isLoading:he}=V({queryKey:["clinic-settings"],queryFn:()=>k.getClinicSettings()});h.useEffect(()=>{O&&(i("clinicName",O.clinicName||""),i("address",O.address||""),i("phone",O.phone||""),i("email",O.email||""),i("website",O.website||""),i("registrationNo",O.registrationNo||""),i("gstNo",O.gstNo||""))},[O,i]);const{data:z,isLoading:be}=V({queryKey:["preferences"],queryFn:()=>k.getPreferences()});h.useEffect(()=>{z!=null&&z.dashboardWidgets&&a(z.dashboardWidgets)},[z]);const{data:_,isLoading:fe}=V({queryKey:["consultation-fees"],queryFn:()=>k.getConsultationFees()});h.useEffect(()=>{var m;const r=((m=_==null?void 0:_.data)==null?void 0:m.fees)||{};M(r)},[_]);const Z=P({mutationFn:r=>k.updateProfile(r),onSuccess:async()=>{p.success("Profile updated successfully"),l.invalidateQueries(["user"]),await f()},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update profile")}}),Q=P({mutationFn:r=>k.changePassword(r),onSuccess:()=>{p.success("Password changed successfully"),S()},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to change password")}}),ee=P({mutationFn:r=>k.updateClinicSettings(r),onSuccess:()=>{p.success("Clinic settings updated successfully"),l.invalidateQueries(["clinic-settings"])},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update clinic settings")}});P({mutationFn:r=>k.updateTaxSettings(r),onSuccess:()=>{p.success("Tax settings updated successfully"),l.invalidateQueries(["tax-settings"])},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update tax settings")}}),P({mutationFn:r=>k.updateWorkingHours(r),onSuccess:()=>{p.success("Working hours updated successfully"),l.invalidateQueries(["working-hours"])},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update working hours")}});const se=P({mutationFn:r=>k.updatePreferences(r),onSuccess:()=>{p.success("Preferences updated successfully"),l.invalidateQueries(["preferences"])},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update preferences")}}),re=P({mutationFn:r=>k.updateConsultationFees(r),onSuccess:()=>{p.success("Consultation fees updated successfully"),l.invalidateQueries(["consultation-fees"])},onError:r=>{var m,d;p.error(((d=(m=r.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update consultation fees")}}),ye=r=>{Z.mutate(r)},le=r=>{Q.mutate({currentPassword:r.currentPassword,newPassword:r.newPassword})},je=r=>{ee.mutate(r)},Ne=r=>{a(m=>m.map(d=>d.id===r?{...d,enabled:!d.enabled}:d))},we=()=>{se.mutate({dashboardWidgets:L})},ve=(r,m)=>{M(d=>({...d,[r]:m===""?"":Math.max(0,Number(m))}))},Se=()=>{const r={};Object.entries(x||{}).forEach(([m,d])=>{const K=Number(d);Number.isFinite(K)&&K>=0&&(r[m]=K)}),re.mutate(r)},oe=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Profile Information"}),e.jsxs("form",{onSubmit:c(ye),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...W("name",{required:"Name is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N.name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",...W("email",{required:"Email is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",...W("phone"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:Z.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),Z.isPending?"Saving...":"Save Changes"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:t(le),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",...n("currentPassword",{required:"Current password is required"}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>y(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:j?e.jsx(C,{}):e.jsx(T,{})})]}),b.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.currentPassword.message})]}),e.jsx("div",{}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",...n("newPassword",{required:"New password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>F(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(C,{}):e.jsx(T,{})})]}),b.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.newPassword.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",...n("confirmPassword",{required:"Please confirm your password",validate:r=>r===v||"Passwords do not match"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),b.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.confirmPassword.message})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:Q.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),Q.isPending?"Changing...":"Change Password"]})})]})]})]});if((s==null?void 0:s.role)==="STAFF")return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:t(le),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",...n("currentPassword",{required:"Current password is required"}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>y(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:j?e.jsx(C,{}):e.jsx(T,{})})]}),b.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.currentPassword.message})]}),e.jsx("div",{}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",...n("newPassword",{required:"New password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>F(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(C,{}):e.jsx(T,{})})]}),b.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.newPassword.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",...n("confirmPassword",{required:"Please confirm your password",validate:r=>r===v||"Passwords do not match"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),b.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.confirmPassword.message})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:Q.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),Q.isPending?"Changing...":"Change Password"]})})]})]})]})});const ke=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clinic Information"}),he?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("form",{onSubmit:I(je),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...q("clinicName",{required:"Clinic name is required"}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name"}),g.clinicName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g.clinicName.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{...q("address"),rows:2,className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",...q("phone"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",...q("email"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Website"}),e.jsx("input",{type:"url",...q("website"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registration Number"}),e.jsx("input",{type:"text",...q("registrationNo"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter registration number"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:ee.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),ee.isPending?"Saving...":"Save Changes"]})})]})]}),Pe=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dashboard Customization"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Choose which widgets to display on your dashboard"}),be?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(r=>e.jsx("div",{onClick:()=>Ne(r.id),className:`p-4 border rounded-lg cursor-pointer transition ${r.enabled?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${r.enabled?"text-blue-700":"text-gray-700"}`,children:r.label}),e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${r.enabled?"bg-blue-600":"bg-gray-200"}`,children:r.enabled&&e.jsx(Be,{className:"text-white text-xs"})})]})},r.id))}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{onClick:we,disabled:se.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),se.isPending?"Saving...":"Save Preferences"]})})]})]}),Ae=()=>{var m;const r=((m=_==null?void 0:_.data)==null?void 0:m.doctors)||[];return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Doctor Consultation Fees"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Set consultation amount per doctor. These values are used in new bills and auto-bill from prescription."}),fe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No doctors found in this clinic."}):e.jsxs("div",{className:"space-y-3",children:[r.map(d=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-center border border-gray-100 rounded-lg p-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),d.email&&e.jsx("p",{className:"text-xs text-gray-500",children:d.email})]}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:(x==null?void 0:x[d.id])??"",onChange:K=>ve(d.id,K.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})})]},d.id)),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{onClick:Se,disabled:re.isPending,className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition",children:[e.jsx(D,{}),re.isPending?"Saving...":"Save Consultation Fees"]})})]})]})},Ce=()=>{switch(u){case"profile":return oe();case"clinic":return ke();case"consultation":return Ae();case"tax":return renderTaxTab();case"hours":return renderHoursTab();case"email":return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(Ve,{})});case"whatsapp":return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(He,{})});case"preferences":return Pe();case"access":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx(Ke,{})}),e.jsx("div",{children:e.jsx($e,{})})]});default:return oe()}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your account and clinic settings"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-64 flex-shrink-0",children:e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:Ye.map(r=>e.jsxs("button",{onClick:()=>E(r.id),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition ${u===r.id?"bg-blue-50 text-blue-600 border-l-4 border-blue-600":"text-gray-600 hover:bg-gray-50 border-l-4 border-transparent"}`,children:[e.jsx(r.icon,{className:u===r.id?"text-blue-600":"text-gray-400"}),e.jsx("span",{className:"font-medium",children:r.label})]},r.id))})}),e.jsx("div",{className:"flex-1",children:Ce()})]})]})})}export{rs as default};
