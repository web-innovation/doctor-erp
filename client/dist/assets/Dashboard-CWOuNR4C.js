import{a as Z,r as ee,p as x,j as e,L as p,q as se,s as J,t as X,v as ae,w as te,x as le,y as ne,A as re,B as ie,m as de,C as oe,D as ce,E as j,G as me}from"./index-gKfW3Eho.js";import{L as xe,B as pe,C as he,a as ge,b as ue,P as be,c as ye,d as je,p as Ne,e as fe,f as ve,i as we}from"./index-D_l2JIuL.js";import{a as Fe}from"./appointmentService-BRlpkyCo.js";he.register(ge,ue,be,ye,je,Ne,fe,ve,we);const N=({icon:t,title:o,value:r,change:s,changeType:i,color:m})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:o}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:r}),s&&e.jsxs("p",{className:`text-sm mt-1 ${i==="increase"?"text-green-600":"text-red-600"}`,children:[i==="increase"?"+":"-",s,"% from yesterday"]})]}),e.jsx("div",{className:`w-12 h-12 ${m} rounded-xl flex items-center justify-center`,children:e.jsx(t,{className:"text-xl text-white"})})]})}),v=({icon:t,title:o,to:r,color:s})=>e.jsxs(p,{to:r,className:"flex items-center gap-3 p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`w-10 h-10 ${s} rounded-lg flex items-center justify-center`,children:e.jsx(t,{className:"text-white"})}),e.jsx("span",{className:"font-medium text-gray-700",children:o}),e.jsx(de,{className:"ml-auto text-gray-400"})]}),Ce=({type:t,message:o,time:r})=>{const s={warning:"bg-yellow-100 text-yellow-800 border-yellow-200",danger:"bg-red-100 text-red-800 border-red-200",info:"bg-blue-100 text-blue-800 border-blue-200"};return e.jsxs("div",{className:`p-3 rounded-lg border ${s[t]} flex items-start gap-3`,children:[e.jsx(oe,{className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:o}),e.jsx("p",{className:"text-xs opacity-75 mt-1",children:r})]})]})};function Re(){var F,C,A,S,T,D,R,P,k,L,q,E,O,K,B,$,I,M,W,_,H,Q,z;const{user:t,normalizeRole:o}=Z(),[r]=ee.useState("7days"),{activeViewUser:s}=Z(),{data:i}=x({queryKey:["rolePermissions"],queryFn:()=>ce.getRolePermissions(),staleTime:5*60*1e3}),m=((F=i==null?void 0:i.data)==null?void 0:F.data)||(i==null?void 0:i.data)||i||null,f=o?o((s==null?void 0:s.role)||(t==null?void 0:t.role)||"STAFF"):s&&s.role||t&&t.role||"STAFF",Y=!!(s&&s.id&&t&&s.id!==t.id),l=n=>{if(t!=null&&t.isClinicAdmin&&!Y)return!0;if(!m)return["DOCTOR","SUPER_ADMIN"].includes((f||"").toString().toUpperCase());let d=(f||"").toString().toUpperCase();m[d]||(["NURSE","LAB_TECHNICIAN"].includes(d)&&m.STAFF?d="STAFF":d==="STAFF"&&m.DOCTOR&&(d="DOCTOR"));const G=m[d];return G?G.includes(n):!1},{data:a,isLoading:Ae}=x({queryKey:["dashboardStats",(s==null?void 0:s.id)||null],queryFn:()=>j.getStats((s==null?void 0:s.id)||null),placeholderData:{todayOPD:0,totalRevenue:0,appointments:0,pendingBills:0},enabled:l("dashboard:view")}),{data:h}=x({queryKey:["patientTrend",r,(s==null?void 0:s.id)||null],queryFn:()=>j.getPatientTrend(r,(s==null?void 0:s.id)||null),placeholderData:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],data:[12,19,15,25,22,30,28]},enabled:l("dashboard:view")}),{data:g}=x({queryKey:["revenueTrend",r,(s==null?void 0:s.id)||null],queryFn:()=>j.getRevenueTrend(r,(s==null?void 0:s.id)||null),placeholderData:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],data:[5e3,8e3,6500,9e3,7500,12e3,10500]},enabled:l("dashboard:view")}),{data:u}=x({queryKey:["todayAppointments"],queryFn:()=>Fe.getTodayAppointments(),placeholderData:[],enabled:l("dashboard:view")}),{data:b}=x({queryKey:["recentPatients"],queryFn:()=>me.getRecent(5),placeholderData:[],enabled:l("dashboard:view")}),{data:y}=x({queryKey:["dashboardAlerts",(s==null?void 0:s.id)||null],queryFn:()=>j.getAlerts((s==null?void 0:s.id)||null),placeholderData:[],enabled:l("dashboard:view")});if(!l("dashboard:view"))return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-8 border border-gray-100 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome to your workspace"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Hi ",(t==null?void 0:t.name)||"there",", welcome to DocClinic."]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[l("patients:read")||l("patients:create")?e.jsxs(p,{to:"/patients",className:"block p-4 bg-blue-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-blue-700",children:"Patients"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Search and manage patient records"})]}):null,l("appointments:read")||l("appointments:create")?e.jsxs(p,{to:"/appointments",className:"block p-4 bg-green-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-green-700",children:"Appointments"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View schedule or book a patient"})]}):null,l("prescriptions:read")||l("prescriptions:create")?e.jsxs(p,{to:"/prescriptions",className:"block p-4 bg-purple-50 rounded-lg hover:shadow-md transition",children:[e.jsx("p",{className:"font-medium text-purple-700",children:"Prescriptions"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create and view prescriptions"})]}):null]})]})})});const U={labels:(h==null?void 0:h.labels)||[],datasets:[{label:"Patients",data:(h==null?void 0:h.data)||[],fill:!0,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},V={labels:(g==null?void 0:g.labels)||[],datasets:[{label:"Revenue (₹)",data:(g==null?void 0:g.data)||[],backgroundColor:"rgba(16, 185, 129, 0.8)",borderRadius:8}]},w={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:["DOCTOR","SUPER_ADMIN"].includes((f||"").toString().toUpperCase())?`Welcome back, Dr. ${(t==null?void 0:t.name)||"Doctor"}!`:`Welcome, ${(t==null?void 0:t.name)||"Staff"}.`}),e.jsx("p",{className:"text-gray-500 mt-1",children:l("appointments:read")||l("patients:read")?"Here's what's happening at your clinic today.":"Welcome to your workspace."})]}),l("appointments:read")||l("reports:collections")?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(N,{icon:se,title:"Today's OPD",value:((A=(C=a==null?void 0:a.data)==null?void 0:C.appointments)==null?void 0:A.total)||0,change:Math.abs((T=(S=a==null?void 0:a.data)==null?void 0:S.appointments)==null?void 0:T.growth)||0,changeType:((R=(D=a==null?void 0:a.data)==null?void 0:D.appointments)==null?void 0:R.growth)>=0?"increase":"decrease",color:"bg-blue-500"}),e.jsx(N,{icon:J,title:"Today's Revenue",value:`₹${(((k=(P=a==null?void 0:a.data)==null?void 0:P.revenue)==null?void 0:k.total)||0).toLocaleString()}`,change:Math.abs((q=(L=a==null?void 0:a.data)==null?void 0:L.revenue)==null?void 0:q.growth)||0,changeType:((O=(E=a==null?void 0:a.data)==null?void 0:E.revenue)==null?void 0:O.growth)>=0?"increase":"decrease",color:"bg-green-500"}),e.jsx(N,{icon:X,title:"New Patients",value:((B=(K=a==null?void 0:a.data)==null?void 0:K.patients)==null?void 0:B.newToday)||0,change:((I=($=a==null?void 0:a.data)==null?void 0:$.appointments)==null?void 0:I.completed)||0,changeType:"increase",color:"bg-purple-500"}),e.jsx(N,{icon:ae,title:"Bills Today",value:((W=(M=a==null?void 0:a.data)==null?void 0:M.bills)==null?void 0:W.count)||0,change:((H=(_=a==null?void 0:a.data)==null?void 0:_.appointments)==null?void 0:H.pending)||0,changeType:"decrease",color:"bg-orange-500"})]}):null,e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient Count"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Last 7 days trend"})]}),e.jsx(te,{className:"text-blue-500"})]}),e.jsx("div",{className:"h-64",children:e.jsx(xe,{data:U,options:w})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Revenue"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Last 7 days"})]}),e.jsx(J,{className:"text-green-500"})]}),e.jsx("div",{className:"h-64",children:e.jsx(pe,{data:V,options:w})})]})]}),(l("appointments:create")||l("prescriptions:create")||l("patients:create"))&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l("appointments:create")&&e.jsx(v,{icon:X,title:"New Appointment",to:"/appointments/new",color:"bg-blue-500"}),l("prescriptions:create")&&e.jsx(v,{icon:le,title:"New Prescription",to:"/prescriptions/new",color:"bg-purple-500"}),l("patients:create")&&e.jsx(v,{icon:ne,title:"Add Patient",to:"/patients/new",color:"bg-green-500"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alerts"}),e.jsx(re,{className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:((z=(Q=y==null?void 0:y.data)==null?void 0:Q.alerts)==null?void 0:z.length)>0?y.data.alerts.map((n,c)=>e.jsx(Ce,{type:n.type,message:n.message,time:n.title},c)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No alerts at this time"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Patients"}),e.jsx(p,{to:"/patients",className:"text-blue-600 text-sm hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:(b==null?void 0:b.length)>0?b.map(n=>{var c;return e.jsxs(p,{to:`/patients/${n.id}`,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium",children:((c=n.name)==null?void 0:c.charAt(0))||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:n.name}),e.jsx("p",{className:"text-sm text-gray-500",children:n.phone})]})]},n.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent patients"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Today's Appointments"}),e.jsx(p,{to:"/appointments",className:"text-blue-600 text-sm hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:(u==null?void 0:u.length)>0?u.slice(0,5).map(n=>{var c,d;return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:((c=n.patient)==null?void 0:c.name)||n.patientName||"Unknown Patient"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n.timeSlot||n.time||"-"," - ",n.type||"Consultation"]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n.status==="CONFIRMED"||n.status==="confirmed"?"bg-green-100 text-green-700":n.status==="COMPLETED"||n.status==="completed"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:((d=n.status)==null?void 0:d.toLowerCase())||"scheduled"})]},n.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No appointments today"})})]})]})]})})}export{Re as default};
