import{r as i,j as e,K as c,M as Z,N as ee,L as ae,O as te,P as se,Q as le,S as re,T as ne,U as b,V as m}from"./index-DWDU381E.js";import{a as u}from"./adminService-C_3Xahnk.js";const de=()=>{const[k,q]=i.useState([]),[H,S]=i.useState(!0),[C,I]=i.useState(""),[z,j]=i.useState(!1),[V,y]=i.useState(!1),[_,f]=i.useState(!1),[$,N]=i.useState(!1),[v,g]=i.useState(""),[r,x]=i.useState(null),[t,o]=i.useState({clinicName:"",ownerName:"",ownerEmail:"",ownerPassword:"",phone:"",address:""}),[n,w]=i.useState({page:1,limit:10,total:0});i.useEffect(()=>{p()},[n.page,C]);const p=async()=>{try{S(!0);const a=await u.getClinics({page:n.page,limit:n.limit,search:C});q(a.clinics),w(s=>({...s,total:a.total}))}catch(a){console.error("Failed to fetch clinics:",a)}finally{S(!1)}},G=async a=>{var s,l;a.preventDefault();try{await u.createClinic(t),j(!1),h(),p()}catch(d){console.error("Failed to create clinic:",d),alert(((l=(s=d.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create clinic")}},K=async a=>{var s,l;a.preventDefault();try{await u.updateClinic(r.id,{name:t.clinicName,phone:t.phone,address:t.address}),y(!1),h(),p()}catch(d){console.error("Failed to update clinic:",d),alert(((l=(s=d.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to update clinic")}},Q=async()=>{var a,s;try{await u.blockClinic(r.id),f(!1),x(null),p()}catch(l){console.error("Failed to block clinic:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to block clinic")}},R=async a=>{var s,l;try{await u.unblockClinic(a.id),p()}catch(d){console.error("Failed to unblock clinic:",d),alert(((l=(s=d.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to unblock clinic")}},J=async()=>{var a,s;if(r){if(v.trim()!==r.name){alert("Please type exact clinic name to confirm permanent deletion");return}try{await u.deleteClinicPermanently(r.id,{confirmText:v.trim()}),N(!1),g(""),x(null),p()}catch(l){console.error("Failed to delete clinic permanently:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to delete clinic permanently")}}},W=a=>{x(a),o({clinicName:a.name,phone:a.phone||"",address:a.address||""}),y(!0)},X=a=>{x(a),f(!0)},Y=a=>{x(a),g(""),N(!0)},h=()=>{o({clinicName:"",ownerName:"",ownerEmail:"",ownerPassword:"",phone:"",address:""}),x(null)},F=Math.ceil(n.total/n.limit);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Manage all clinics on the platform"})]}),e.jsxs(c,{onClick:()=>j(!0),children:[e.jsx(Z,{className:"mr-2"})," Add Clinic"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search clinics...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",value:C,onChange:a=>{I(a.target.value),w(s=>({...s,page:1}))}})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Limits"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"No clinics found"})}):k.map(a=>{var s,l,d,D,P,E,M,A,L,O,T,U,B;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Created ",new Date(a.createdAt).toLocaleDateString("en-GB")]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-gray-900",children:((s=a.owner)==null?void 0:s.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((l=a.owner)==null?void 0:l.email)||"N/A"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-gray-900",children:a.phone||"-"}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",children:a.address||"-"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[((d=a._count)==null?void 0:d.users)||0," users"]}),e.jsxs("div",{className:"text-gray-500",children:[((D=a._count)==null?void 0:D.patients)||0," patients"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-xs",children:[e.jsxs("div",{className:"text-gray-900",children:["Staff: ",((P=a==null?void 0:a.accessControls)==null?void 0:P.staffLimit)??((M=(E=a==null?void 0:a.accessControls)==null?void 0:E.subscription)==null?void 0:M.includedUsers)??"No limit"]}),e.jsxs("div",{className:"text-gray-500",children:["Trial invoices: ",((L=(A=a==null?void 0:a.accessControls)==null?void 0:A.subscription)==null?void 0:L.trialInvoiceUploadLimit)??10," total"]}),e.jsxs("div",{className:"text-gray-500",children:["Upload/month: ",((T=(O=a==null?void 0:a.accessControls)==null?void 0:O.invoiceUploadLimit)==null?void 0:T.monthly)??((B=(U=a==null?void 0:a.accessControls)==null?void 0:U.subscription)==null?void 0:B.monthlyInvoiceUploads)??"No limit"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive?"Active":"Blocked"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(ae,{to:`/admin/clinics/${a.id}`,className:"text-purple-600 hover:text-purple-900 p-1",title:"View Details",children:e.jsx(te,{})}),e.jsx("button",{onClick:()=>W(a),className:"text-blue-600 hover:text-blue-900 p-1",title:"Edit",children:e.jsx(se,{})}),a.isActive?e.jsx("button",{onClick:()=>X(a),className:"text-red-600 hover:text-red-900 p-1",title:"Block Clinic",children:e.jsx(le,{})}):e.jsx("button",{onClick:()=>R(a),className:"text-green-600 hover:text-green-900 p-1",title:"Unblock Clinic",children:e.jsx(re,{})}),e.jsx("button",{onClick:()=>Y(a),className:"text-red-700 hover:text-red-900 p-1",title:"Delete Permanently",children:e.jsx(ne,{})})]})})]},a.id)})})]})}),F>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(n.page-1)*n.limit+1," to"," ",Math.min(n.page*n.limit,n.total)," of"," ",n.total," clinics"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{variant:"outline",size:"sm",disabled:n.page===1,onClick:()=>w(a=>({...a,page:a.page-1})),children:"Previous"}),e.jsx(c,{variant:"outline",size:"sm",disabled:n.page===F,onClick:()=>w(a=>({...a,page:a.page+1})),children:"Next"})]})]})]})}),e.jsx(b,{isOpen:z,onClose:()=>{j(!1),h()},title:"Create New Clinic",children:e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsx(m,{label:"Clinic Name",value:t.clinicName,onChange:a=>o({...t,clinicName:a.target.value}),required:!0}),e.jsx(m,{label:"Owner Name",value:t.ownerName,onChange:a=>o({...t,ownerName:a.target.value}),required:!0}),e.jsx(m,{label:"Owner Email",type:"email",value:t.ownerEmail,onChange:a=>o({...t,ownerEmail:a.target.value}),required:!0}),e.jsx(m,{label:"Owner Password",type:"password",value:t.ownerPassword,onChange:a=>o({...t,ownerPassword:a.target.value}),required:!0}),e.jsx(m,{label:"Phone",value:t.phone,onChange:a=>o({...t,phone:a.target.value})}),e.jsx(m,{label:"Address",value:t.address,onChange:a=>o({...t,address:a.target.value})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{j(!1),h()},children:"Cancel"}),e.jsx(c,{type:"submit",children:"Create Clinic"})]})]})}),e.jsx(b,{isOpen:V,onClose:()=>{y(!1),h()},title:"Edit Clinic",children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsx(m,{label:"Clinic Name",value:t.clinicName,onChange:a=>o({...t,clinicName:a.target.value}),required:!0}),e.jsx(m,{label:"Phone",value:t.phone,onChange:a=>o({...t,phone:a.target.value})}),e.jsx(m,{label:"Address",value:t.address,onChange:a=>o({...t,address:a.target.value})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{y(!1),h()},children:"Cancel"}),e.jsx(c,{type:"submit",children:"Update Clinic"})]})]})}),e.jsx(b,{isOpen:_,onClose:()=>{f(!1),x(null)},title:"Block Clinic",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to block ",e.jsx("strong",{children:r==null?void 0:r.name}),"? All users will be deactivated and unable to access the clinic until it is unblocked."]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>{f(!1),x(null)},children:"Cancel"}),e.jsx(c,{variant:"danger",onClick:Q,children:"Block Clinic"})]})]})}),e.jsx(b,{isOpen:$,onClose:()=>{N(!1),x(null),g("")},title:"Delete Clinic Permanently",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-700",children:["This action will permanently delete ",e.jsx("strong",{children:r==null?void 0:r.name})," and all related data (patients, bills, prescriptions, pharmacy, staff, settings, and records)."]}),e.jsx("p",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg p-3",children:"This action cannot be undone."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type clinic name to confirm"}),e.jsx("input",{type:"text",value:v,onChange:a=>g(a.target.value),placeholder:(r==null?void 0:r.name)||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{N(!1),x(null),g("")},children:"Cancel"}),e.jsx(c,{variant:"danger",onClick:J,disabled:!r||v.trim()!==r.name,children:"Delete Permanently"})]})]})})]})};export{de as default};
