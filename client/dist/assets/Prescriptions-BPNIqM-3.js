import{u as z,I as O,r as x,p as U,J as W,j as e,L as $,a0 as V,y as _,K as q,a4 as H,d as K,a5 as T,a6 as B,O as J,P as X,Q as G,a7 as Y,n as Z,z as g}from"./index-R75PvMZ4.js";import{u as ee}from"./useMutation-DakZEmRO.js";import{p as F}from"./prescriptionService-BaJ6QOyU.js";function re(){var N,f,v,w;const u=z();O();const[d,k]=x.useState(""),[l,m]=x.useState(1),[M,h]=x.useState(!1),[r,p]=x.useState(null),c=10,{data:t,isLoading:A}=U({queryKey:["prescriptions",l,c,d],queryFn:()=>F.getPrescriptions({page:l,limit:c,search:d||void 0}),placeholderData:s=>s,refetchInterval:5*60*1e3}),y=(t==null?void 0:t.data)||[],o=((N=t==null?void 0:t.pagination)==null?void 0:N.totalPages)||1,j=((f=t==null?void 0:t.pagination)==null?void 0:f.total)||0,n=ee({mutationFn:({id:s,method:a})=>F.sendPrescription(s,a),onSuccess:s=>{s.whatsappUrl?(window.open(s.whatsappUrl,"_blank"),g.success("WhatsApp opened. Send the message to complete.")):g.success("Prescription sent successfully"),h(!1),p(null)},onError:s=>{var a,i;g.error(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to send prescription")}}),E=s=>{k(s.target.value),m(1)},I=s=>{u(`/prescriptions/${s.id}`)},D=s=>{u(`/prescriptions/${s.id}?print=true`)},L=s=>{p(s),h(!0)},b=s=>{r&&n.mutate({id:r.id,method:s})},Q=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"-",R=W("prescriptions:create",["DOCTOR","ADMIN","SUPER_ADMIN"]);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Prescriptions"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View and manage patient prescriptions"})]}),R&&e.jsx($,{to:"/prescriptions/new",children:e.jsx(V,{iconLeft:_,children:"New Prescription"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:E,placeholder:"Search by patient name or prescription ID...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Prescription ID"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Diagnosis"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{children:A?[...Array(5)].map((s,a)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-40"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})})]},a)):y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center",children:[e.jsx(H,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No prescriptions found"}),d&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search term"})]})}):y.map(s=>{var a,i,S,P,C;return e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:s.prescriptionNo||`RX${String(s.id).padStart(5,"0")}`})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:Q(s.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((i=(a=s.patient)==null?void 0:a.name)==null?void 0:i.charAt(0))||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((S=s.patient)==null?void 0:S.name)||"Unknown Patient"}),e.jsx("p",{className:"text-sm text-gray-500",children:((P=s.patient)==null?void 0:P.patientId)||((C=s.patient)==null?void 0:C.id)&&`P${String(s.patient.id).padStart(5,"0")}`})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-gray-700 truncate max-w-xs",children:s.diagnosis||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(s),className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View",children:e.jsx(K,{})}),e.jsx("button",{onClick:()=>D(s),className:"p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Print",children:e.jsx(T,{})}),e.jsx("button",{onClick:()=>L(s),className:"p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Send",children:e.jsx(B,{})})]})})]},s.id)})})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",(l-1)*c+1," -"," ",Math.min(l*c,j)," of ",j," prescriptions"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(s=>Math.max(1,s-1)),disabled:l===1,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:e.jsx(J,{className:"text-gray-600"})}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",l," of ",o]}),e.jsx("button",{onClick:()=>m(s=>Math.min(o,s+1)),disabled:l===o,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:e.jsx(X,{className:"text-gray-600"})})]})]})]}),e.jsx(G,{isOpen:M,onClose:()=>{h(!1),p(null)},title:"Send Prescription",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"How would you like to send this prescription to the patient?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>b("whatsapp"),disabled:n.isPending,className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"text-green-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WhatsApp"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via WhatsApp to ",((v=r==null?void 0:r.patient)==null?void 0:v.phone)||"patient"]})]})]}),e.jsxs("button",{onClick:()=>b("email"),disabled:n.isPending,className:"w-full flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"text-blue-600 text-lg"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Email"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send via email to ",((w=r==null?void 0:r.patient)==null?void 0:w.email)||"patient"]})]})]})]}),n.isPending&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Sending..."}),n.isError&&e.jsx("p",{className:"text-center text-sm text-red-600",children:"Failed to send. Please try again."}),n.isSuccess&&e.jsx("p",{className:"text-center text-sm text-green-600",children:"Prescription sent successfully!"})]})})]})})}export{re as default};
