import{u as Ae,a as Ce,J as Ee,j as e,I as $e,r as y,b as ke,ac as ne,p as f,l as Re,q as Le,a2 as v,ad as q,$ as Me,a3 as j,a8 as Ge,a9 as ie,K as oe,ae as ce,aa as de,a0 as ue,a5 as Ke,af as Oe,z as F,D as _,G as ze}from"./index-ae8E7MVz.js";import{u as Be}from"./useMutation-BTnhOH6c.js";import{a as me}from"./appointmentService-CosKz5Em.js";import{b as pe}from"./billingService-B6DSiyVo.js";import{p as A}from"./prescriptionService-CIud4GU3.js";const Ue=[{value:"1-0-0",label:"1-0-0 (Morning)"},{value:"0-1-0",label:"0-1-0 (Afternoon)"},{value:"0-0-1",label:"0-0-1 (Night)"},{value:"1-1-0",label:"1-1-0 (Morning, Afternoon)"},{value:"1-0-1",label:"1-0-1 (Morning, Night)"},{value:"0-1-1",label:"0-1-1 (Afternoon, Night)"},{value:"1-1-1",label:"1-1-1 (Thrice a day)"},{value:"1-1-1-1",label:"1-1-1-1 (Four times)"},{value:"sos",label:"SOS (As needed)"},{value:"stat",label:"STAT (Immediately)"}],He=[{value:"3",label:"3 Days"},{value:"5",label:"5 Days"},{value:"7",label:"7 Days"},{value:"10",label:"10 Days"},{value:"14",label:"14 Days"},{value:"15",label:"15 Days"},{value:"21",label:"21 Days"},{value:"30",label:"30 Days"},{value:"60",label:"60 Days"},{value:"90",label:"90 Days"}],Qe=[{value:"before",label:"Before Food"},{value:"after",label:"After Food"},{value:"with",label:"With Food"},{value:"any",label:"Any Time"}];function as(){var te,ae,le,re;const C=Ae(),{user:i}=Ce();if(!Ee("prescriptions:create",["DOCTOR","ADMIN","SUPER_ADMIN"]))return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Access denied"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"You do not have permission to create prescriptions."})]})})});const E=`${(i==null?void 0:i.role)||""} ${(i==null?void 0:i.effectiveRole)||""} ${(i==null?void 0:i.clinicRole)||""}`.toUpperCase().split(/[^A-Z0-9]+/i).map(s=>s.trim()).filter(Boolean),b=E.includes("SUPER_ADMIN")||E.includes("ADMIN"),xe=E.includes("DOCTOR"),V=$e(),[h,$]=y.useState(""),[m,k]=y.useState(""),[be,T]=y.useState(!1),[he,D]=y.useState(!1),W=y.useRef(null),[Ve,We]=y.useState(!1),[Ye,ge]=y.useState(null),{register:c,handleSubmit:ye,control:p,watch:R,setValue:Je,formState:{errors:w}}=ke({defaultValues:{doctor:null,patient:null,vitals:{bloodPressureSystolic:"",bloodPressureDiastolic:"",heartRate:"",temperature:"",weight:"",height:"",oxygenSaturation:""},diagnosis:"",notes:"",medicines:[],labTests:[]}}),{fields:Y,append:J,remove:fe}=ne({control:p,name:"medicines"}),{fields:X,append:Z,remove:je}=ne({control:p,name:"labTests"}),{data:L}=f({queryKey:["patients-list"],queryFn:()=>ze.getPatients({limit:100})}),Ne=((L==null?void 0:L.data)||[]).map(s=>({value:s.id,label:`${s.name} (${s.patientId||`P${String(s.id).padStart(5,"0")}`})`,patient:s})),{data:M}=f({queryKey:["prescription-doctors-list"],queryFn:()=>me.getDoctors(),enabled:b}),ve=((M==null?void 0:M.data)||[]).map(s=>({value:s.id,label:s.name})),N=R("doctor"),G=b?N==null?void 0:N.value:xe?i==null?void 0:i.id:void 0,we=b?N==null?void 0:N.label:(i==null?void 0:i.name)||"You",K=()=>{var s;return(s=R("patient"))==null?void 0:s.value},{data:g}=f({queryKey:["patient-appointments",K(),G],queryFn:()=>me.getAppointments({patientId:K(),status:"SCHEDULED",doctorId:G,limit:50}),enabled:!!K()&&(!!G||!b)}),ee=((g==null?void 0:g.data)||[]).map(s=>({value:s.id,label:`${s.appointmentNo||""} ${s.date?`- ${new Date(s.date).toLocaleDateString("en-GB")}`:""}`,appt:s})),{data:O}=f({queryKey:["medicines-search",h],queryFn:()=>A.searchMedicines(h,10),enabled:h.length>=2}),se=(O==null?void 0:O.data)||[],{data:z}=f({queryKey:["lab-tests-search",m],queryFn:()=>A.searchLabTests(m),enabled:m.length>=2}),B=(z==null?void 0:z.data)||[],{data:U}=f({queryKey:["consultation-fees"],queryFn:()=>_.getConsultationFees()}),H=((te=U==null?void 0:U.data)==null?void 0:te.fees)||{},{data:Se}=f({queryKey:["tax-settings"],queryFn:()=>_.getTaxSettings()}),Q=Be({mutationFn:A.createPrescription,onSuccess:async s=>{var d,S,I;F.success("Prescription saved successfully");const a=s.data||s;try{const l=W.current||{};let t=[];try{const n=await pe.getPrefill(a.patientId||l.patientId,{prescriptionId:a.id});t=(((d=n==null?void 0:n.data)==null?void 0:d.items)||[]).map(r=>({description:r.description||"",quantity:Number(r.quantity)||1,unitPrice:Number(r.unitPrice)||0,type:r.type==="medicine"?"pharmacy":r.type==="lab"?"lab_test":r.type||"other",productId:r.productId||null,labId:r.labId||null,labTestId:r.labTestId||null,doctorId:r.doctorId||null}))}catch{const u=[];let r=0,P="Consultation";if(l.appointmentId&&Array.isArray(g==null?void 0:g.data)){const o=(g.data||[]).find(qe=>qe.id===l.appointmentId);o&&(r=o.consultationFee||0,P=`Consultation (${o.appointmentNo||""})`)}if(!r){const o=l.doctorId||(i==null?void 0:i.id);r=Number((H==null?void 0:H[o])||0)}u.push({description:P,quantity:1,unitPrice:r,type:"consultation"}),(l.medicines||[]).forEach(o=>{u.push({description:o.medicineName||o.name||o.medicine||"",quantity:Number(o.quantity)||1,unitPrice:Number(o.price||o.unitPrice||0),type:"pharmacy",productId:o.productId||null})}),(l.labTests||[]).forEach(o=>{u.push({description:o.testName||o.name||"",quantity:1,unitPrice:Number(o.price||0),type:"lab_test",labId:o.labId||null,labTestId:o.testId||null})}),t=u}if(t.length>0){let n=Se;if(!n)try{n=await _.getTaxSettings()}catch{n=null}const u={patientId:a.patientId||l.patientId,type:"MIXED",items:t,notes:`Draft bill for prescription ${a.prescriptionNo||""}`,doctorId:a.doctorId||l.doctorId||(i==null?void 0:i.id),defaultConsultationGstPercent:Number((n==null?void 0:n.consultationGST)||0),defaultPharmacyGstPercent:Number((n==null?void 0:n.pharmacyGST)||0),defaultLabTestGstPercent:Number((n==null?void 0:n.labGST)||0),defaultConsultationDiscountPercent:0,defaultPharmacyDiscountPercent:0,defaultLabTestDiscountPercent:0};try{await pe.createBill(u);try{V.invalidateQueries({queryKey:["bills"]})}catch{}F.success("Draft bill created automatically")}catch(r){console.error("Failed creating draft bill:",r),F.error(((I=(S=r==null?void 0:r.response)==null?void 0:S.data)==null?void 0:I.message)||"Auto bill creation failed")}}}catch(l){console.error("Failed to create draft bill for prescription:",l)}try{const l=await A.getPrescriptionPdf(a.id),t=window.URL.createObjectURL(l),n=window.open(t,"_blank");n&&(n.onload=()=>{n.print()})}catch{console.log("PDF not available, navigating to prescriptions")}try{V.setQueriesData({queryKey:["prescriptions"]},l=>l&&(l&&typeof l=="object"&&Array.isArray(l.data)?{...l,data:[a,...l.data]}:Array.isArray(l)?[a,...l]:l))}catch(l){console.error("Failed to update prescriptions cache optimistically",l)}C("/prescriptions")},onError:s=>{var a,d;F.error(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to save prescription"),console.error("Failed to create prescription:",s)}}),Ie=s=>{var d,S,I,l;if(b&&!((d=s.doctor)!=null&&d.value)){F.error("Please select doctor");return}const a={appointmentId:(S=s.appointment)==null?void 0:S.value,doctorId:b?(I=s.doctor)==null?void 0:I.value:void 0,patientId:(l=s.patient)==null?void 0:l.value,vitalsSnapshot:{bloodPressureSystolic:s.vitals.bloodPressureSystolic?parseInt(s.vitals.bloodPressureSystolic):null,bloodPressureDiastolic:s.vitals.bloodPressureDiastolic?parseInt(s.vitals.bloodPressureDiastolic):null,heartRate:s.vitals.heartRate?parseInt(s.vitals.heartRate):null,temperature:s.vitals.temperature?parseFloat(s.vitals.temperature):null,weight:s.vitals.weight?parseFloat(s.vitals.weight):null,height:s.vitals.height?parseFloat(s.vitals.height):null,oxygenSaturation:s.vitals.oxygenSaturation?parseInt(s.vitals.oxygenSaturation):null},diagnosis:s.diagnosis,clinicalNotes:s.notes,medicines:s.medicines.map(t=>{var n,u,r,P;return{productId:t.medicineId,medicineName:t.name,price:t.price?parseFloat(t.price):0,dosage:((n=t.dosage)==null?void 0:n.value)||t.dosage,duration:((u=t.duration)==null?void 0:u.value)||t.duration,timing:((r=t.mealTiming)==null?void 0:r.value)||t.mealTiming,frequency:((P=t.dosage)==null?void 0:P.value)||t.dosage,instructions:t.instructions,quantity:t.quantity?parseInt(t.quantity):1,isExternal:!!t.isExternal}}),labTests:s.labTests.map(t=>({testId:t.testId||null,testName:t.name,price:t.price?parseFloat(t.price):0,instructions:t.instructions,isExternal:!!t.isExternal,labId:t.labId||null}))};W.current=a,Q.mutate(a)},Pe=s=>{J({medicineId:s.id,name:s.name,price:s.price||s.sellingPrice||s.mrp||0,dosage:null,duration:null,mealTiming:null,instructions:"",quantity:"",isExternal:!1}),$(""),T(!1)},Fe=s=>{J({medicineId:null,name:s,price:0,dosage:null,duration:null,mealTiming:null,instructions:"",quantity:1,isExternal:!0}),$(""),T(!1)},Te=s=>{Z({testId:s.id||null,labId:s.labId||null,name:s.name,price:s.price||null,labName:s.labName||null,instructions:"",isExternal:(s.isCatalog,!1)}),k(""),D(!1)},De=s=>{Z({testId:null,labId:null,name:s,price:null,labName:null,instructions:"",isExternal:!0}),k(""),D(!1)},x=(ae=R("patient"))==null?void 0:ae.patient;return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>C(-1),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(Re,{className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Prescription"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Create a new prescription for a patient"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Doctor: ",e.jsx("strong",{className:"text-gray-900",children:we||"Select doctor"})]})]})]}),e.jsxs("form",{onSubmit:ye(Ie),className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Le,{className:"text-blue-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient Information"})]}),b&&e.jsx("div",{className:"mb-4",children:e.jsx(v,{label:"Select Doctor",name:"doctor",control:p,options:ve,placeholder:"Search and select doctor...",rules:{required:"Doctor is required"},error:(le=w.doctor)==null?void 0:le.message,isSearchable:!0})}),e.jsx(v,{label:"Select Patient",name:"patient",control:p,options:Ne,placeholder:"Search and select patient...",rules:{required:"Patient is required"},error:(re=w.patient)==null?void 0:re.message,isSearchable:!0}),x&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Age:"}),e.jsx("span",{className:"ml-2 font-medium",children:x.age?`${x.age} yrs`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Gender:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:x.gender||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"}),e.jsx("span",{className:"ml-2 font-medium",children:x.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Blood Group:"}),e.jsx("span",{className:"ml-2 font-medium",children:x.bloodGroup||"-"})]})]}),x.allergies&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("span",{className:"text-red-700 text-sm font-medium",children:"Allergies: "}),e.jsx("span",{className:"text-red-600 text-sm",children:x.allergies})]})]}),ee.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(q,{name:"appointment",control:p,render:({field:s})=>e.jsx(v,{...s,label:"Select Appointment (optional)",options:ee,placeholder:"Select appointment...",isClearable:!0,isSearchable:!0,onChange:a=>{s.onChange(a),ge(a)}})})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(Me,{className:"text-red-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Vitals"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Blood Pressure"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{...c("vitals.bloodPressureSystolic"),type:"number",placeholder:"Sys",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("input",{...c("vitals.bloodPressureDiastolic"),type:"number",placeholder:"Dia",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"mmHg"})]})]}),e.jsx(j,{label:"Heart Rate",type:"number",placeholder:"72",...c("vitals.heartRate"),helperText:"bpm"}),e.jsx(j,{label:"Temperature",type:"number",step:"0.1",placeholder:"98.6",...c("vitals.temperature"),helperText:"°F"}),e.jsx(j,{label:"SpO2",type:"number",placeholder:"98",...c("vitals.oxygenSaturation"),helperText:"%"}),e.jsx(j,{label:"Weight",type:"number",step:"0.1",placeholder:"70",...c("vitals.weight"),helperText:"kg"}),e.jsx(j,{label:"Height",type:"number",placeholder:"170",...c("vitals.height"),helperText:"cm"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Ge,{className:"text-purple-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Diagnosis"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:["Diagnosis ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{...c("diagnosis",{required:"Diagnosis is required"}),rows:2,placeholder:"Enter diagnosis...",className:`w-full px-4 py-2.5 border rounded-lg focus:outline-none focus:ring-2 resize-none ${w.diagnosis?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`}),w.diagnosis&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.diagnosis.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Additional Notes"}),e.jsx("textarea",{...c("notes"),rows:2,placeholder:"Any additional notes or advice...",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"text-green-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Medicines"})]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:h,onChange:s=>{$(s.target.value),T(!0)},onFocus:()=>T(!0),placeholder:"Search medicines from pharmacy...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),be&&h.length>=2&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:se.length===0?e.jsxs("div",{children:[e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:"No medicines found"}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:e.jsxs("button",{type:"button",onClick:()=>Fe(h),className:"w-full text-left px-3 py-2 bg-yellow-50 text-yellow-900 rounded-md",children:['Add "',h,'" as external medicine']})})]}):se.map(s=>e.jsxs("button",{type:"button",onClick:()=>Pe(s),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.category&&`${s.category} • `,"Stock: ",s.stock||0," • ₹",s.price]})]},s.id))})]}),Y.length>0?e.jsx("div",{className:"space-y-4",children:Y.map((s,a)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{children:e.jsx("p",{className:"font-medium text-gray-900",children:s.name})}),e.jsx("button",{type:"button",onClick:()=>fe(a),className:"p-1.5 text-red-500 hover:bg-red-50 rounded transition-colors",children:e.jsx(ce,{size:14})})]}),e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsxs("label",{className:"inline-flex items-center text-sm",children:[e.jsx("input",{type:"checkbox",...c(`medicines.${a}.isExternal`),className:"form-checkbox h-4 w-4 text-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Patient will buy externally"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(q,{name:`medicines.${a}.dosage`,control:p,render:({field:d})=>e.jsx(v,{...d,label:"Dosage",options:Ue,placeholder:"Select...",menuPlacement:"auto"})}),e.jsx(q,{name:`medicines.${a}.duration`,control:p,render:({field:d})=>e.jsx(v,{...d,label:"Duration",options:He,placeholder:"Select...",menuPlacement:"auto"})}),e.jsx(q,{name:`medicines.${a}.mealTiming`,control:p,render:({field:d})=>e.jsx(v,{...d,label:"Timing",options:Qe,placeholder:"Select...",menuPlacement:"auto"})}),e.jsx(j,{label:"Quantity",type:"number",placeholder:"10",...c(`medicines.${a}.quantity`)}),e.jsx(j,{label:"Instructions",placeholder:"Special instructions...",...c(`medicines.${a}.instructions`)})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ie,{className:"text-3xl text-gray-300 mx-auto mb-2"}),e.jsx("p",{children:"No medicines added. Search above to add medicines."})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"text-orange-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Lab Tests"})]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:s=>{k(s.target.value),D(!0)},onFocus:()=>D(!0),placeholder:"Search lab tests...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),he&&m.length>=2&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[B.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:"No lab tests found"}):B.map(s=>e.jsx("button",{type:"button",onClick:()=>Te(s),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),s.category&&e.jsx("p",{className:"text-sm text-gray-500",children:s.category}),s.labName&&e.jsxs("p",{className:"text-xs text-gray-400",children:["From: ",s.labName]})]}),s.price!=null&&e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[s.price," ",s.currency||"INR"]})]})},s.id||s.name)),B.length===0&&m.length>=2&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:e.jsxs("button",{type:"button",onClick:()=>De(m),className:"w-full text-left px-3 py-2 bg-yellow-50 text-yellow-900 rounded-md",children:['Add "',m,'" as external lab test']})})]})]}),X.length>0?e.jsx("div",{className:"space-y-3",children:X.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:s.name})}),e.jsx("input",{...c(`labTests.${a}.instructions`),placeholder:"Special instructions...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),e.jsxs("label",{className:"inline-flex items-center ml-3",children:[e.jsx("input",{type:"checkbox",...c(`labTests.${a}.isExternal`),className:"form-checkbox h-4 w-4 text-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Patient will buy externally"})]}),e.jsx("button",{type:"button",onClick:()=>je(a),className:"p-2 text-red-500 hover:bg-red-50 rounded transition-colors",children:e.jsx(ce,{size:14})})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(de,{className:"text-3xl text-gray-300 mx-auto mb-2"}),e.jsx("p",{children:"No lab tests added. Search above to add tests."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx(ue,{type:"button",variant:"secondary",onClick:()=>C(-1),children:"Cancel"}),e.jsx(ue,{type:"submit",iconLeft:Oe,iconRight:Ke,loading:Q.isPending,children:"Save & Print"})]}),Q.isError&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700",children:"Failed to create prescription. Please try again."})})]})]})})}export{as as default};
