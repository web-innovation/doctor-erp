import{H as de,I as ue,U as xe,r as l,b as me,p as L,J as pe,j as e,a0 as C,y as ge,Y as he,K as ye,q as be,B,a1 as je,k as V,N as Y,Q as Ne,a2 as F,a3 as T,z as h,G as fe}from"./index-CCU_Rm-G.js";import{u as G}from"./useMutation-O28cjH24.js";import{a as S}from"./appointmentService-1WmTlQs-.js";const J={SCHEDULED:"bg-blue-100 text-blue-700",CONFIRMED:"bg-indigo-100 text-indigo-700",COMPLETED:"bg-green-100 text-green-700",CANCELLED:"bg-red-100 text-red-700",NO_SHOW:"bg-gray-100 text-gray-700"},ve=[{key:"all",label:"All"},{key:"SCHEDULED",label:"Scheduled"},{key:"COMPLETED",label:"Completed"},{key:"CANCELLED",label:"Cancelled"}],Ce=[{value:"CONSULTATION",label:"Consultation"},{value:"FOLLOW_UP",label:"Follow-up"},{value:"PROCEDURE",label:"Procedure"},{value:"EMERGENCY",label:"Emergency"}],w=n=>{const y=n.getFullYear(),b=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${y}-${b}-${u}`};function Pe(){var z,Q,K,W,_;const[n,y]=de(),b=ue(),u=xe(),[M,x]=l.useState(n.get("action")==="new"||u.pathname.endsWith("/new")),[j,X]=l.useState("all"),[i,Z]=l.useState("today"),[o,O]=l.useState({start:"",end:""}),[E,ee]=l.useState(""),[m,p]=l.useState(1),[I,q]=l.useState(null),R=10;l.useEffect(()=>{(n.get("action")==="new"||u.pathname.endsWith("/new"))&&(x(!0),y({},{replace:!0}))},[n,y,u.pathname]);const{register:N,handleSubmit:te,reset:D,control:P,formState:{errors:f}}=me(),se=()=>{const t=new Date;if(t.setHours(0,0,0,0),i==="today")return{startDate:w(t),endDate:w(t)};if(i==="week"){const s=new Date(t);return s.setDate(t.getDate()+7),{startDate:w(t),endDate:w(s)}}else if(i==="custom"&&o.start&&o.end)return{startDate:o.start,endDate:o.end};return{}},{data:c,isLoading:ae}=L({queryKey:["appointments",m,R,j,i,o,E],queryFn:()=>S.getAppointments({page:m,limit:R,status:j==="all"?void 0:j,search:E||void 0,...se()}),placeholderData:t=>t}),$=(c==null?void 0:c.data)||[],v=((z=c==null?void 0:c.pagination)==null?void 0:z.totalPages)||1,{data:k}=L({queryKey:["patients-list"],queryFn:()=>fe.getPatients({limit:100})}),re=((k==null?void 0:k.data)||[]).map(t=>({value:t.id,label:`${t.name} (${t.patientId||`P${String(t.id).padStart(5,"0")}`})`})),{data:A}=L({queryKey:["doctors-list"],queryFn:()=>S.getDoctors(),enabled:M}),le=((A==null?void 0:A.data)||[]).map(t=>({value:t.id,label:t.name})),U=G({mutationFn:S.createAppointment,onSuccess:()=>{h.success("Appointment created successfully"),b.invalidateQueries({queryKey:["appointments"]}),x(!1),D()},onError:t=>{var s,a;h.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create appointment")}}),ne=G({mutationFn:({id:t,status:s})=>S.updateStatus(t,s),onSuccess:()=>{h.success("Status updated"),b.invalidateQueries({queryKey:["appointments"]}),q(null)},onError:t=>{var s,a;h.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update status")}}),oe=t=>{var s,a,r;try{if(t.date&&t.time&&new Date(`${t.date}T${t.time}`)<new Date){h.error("Appointment date and time cannot be in the past");return}}catch{}U.mutate({patientId:(s=t.patient)==null?void 0:s.value,date:t.date,timeSlot:t.time,type:((a=t.type)==null?void 0:a.value)||"CONSULTATION",symptoms:t.reason,notes:t.notes,doctorId:(r=t.doctor)==null?void 0:r.value})},g=(t,s)=>{ne.mutate({id:t,status:s})},ie=t=>{if(!t)return"-";const[s,a]=t.split(":"),r=parseInt(s,10),d=r>=12?"PM":"AM";return`${r%12||12}:${a} ${d}`},ce=t=>t?new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"-",H=pe("appointments:create",["DOCTOR","SUPER_ADMIN","RECEPTIONIST"]);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointments"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage and schedule patient appointments"})]}),H&&e.jsx(C,{iconLeft:ge,onClick:()=>x(!0),children:"New Appointment"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"text-gray-400"}),e.jsxs("select",{value:i,onChange:t=>{Z(t.target.value),p(1)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"custom",children:"Custom Range"})]})]}),i==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:o.start,onChange:t=>O(s=>({...s,start:t.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:o.end,onChange:t=>O(s=>({...s,end:t.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:E,onChange:t=>{ee(t.target.value),p(1)},placeholder:"Search by patient name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex gap-2 mt-4 pt-4 border-t border-gray-100",children:ve.map(t=>e.jsx("button",{onClick:()=>{X(t.key),p(1)},className:`px-4 py-2 rounded-lg font-medium transition-colors ${j===t.key?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:t.label},t.key))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Time"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Patient"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Type"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{children:ae?[...Array(5)].map((t,s)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})})]},s)):$.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center",children:[e.jsx(be,{className:"text-4xl text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No appointments found"})]})}):$.map(t=>{var s,a,r,d;return e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:ie(t.timeSlot)}),e.jsx("p",{className:"text-sm text-gray-500",children:ce(t.date)})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:((a=(s=t.patient)==null?void 0:s.name)==null?void 0:a.charAt(0))||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((r=t.patient)==null?void 0:r.name)||"Unknown Patient"}),e.jsx("p",{className:"text-sm text-gray-500",children:((d=t.patient)==null?void 0:d.phone)||"-"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"capitalize text-gray-700",children:t.type||"Consultation"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium capitalize ${J[t.status]||J.scheduled}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>q(I===t.id?null:t.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"text-gray-400"})}),I===t.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10",children:[t.status!=="COMPLETED"&&e.jsxs("button",{onClick:()=>g(t.id,"COMPLETED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(V,{className:"text-green-500"}),"Mark Completed"]}),t.status==="REVIEW"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g(t.id,"SCHEDULED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(V,{className:"text-green-500"}),"Approve (Schedule)"]}),e.jsxs("button",{onClick:()=>g(t.id,"CANCELLED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Y,{className:"text-red-500"}),"Reject"]})]}),t.status!=="CANCELLED"&&e.jsxs("button",{onClick:()=>g(t.id,"CANCELLED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Y,{className:"text-red-500"}),"Cancel"]}),t.status==="CANCELLED"&&e.jsxs("button",{onClick:()=>g(t.id,"SCHEDULED"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(B,{className:"text-blue-500"}),"Reschedule"]})]})]})})]},t.id)})})]})}),v>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",m," of ",v]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(1,t-1)),disabled:m===1,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),e.jsx("button",{onClick:()=>p(t=>Math.min(v,t+1)),disabled:m===v,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})]}),e.jsx(Ne,{isOpen:M,onClose:()=>{x(!1),D()},title:"New Appointment",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"secondary",onClick:()=>{x(!1),D()},children:"Cancel"}),H?e.jsx(C,{onClick:te(oe),loading:U.isPending,children:"Create Appointment"}):e.jsx(C,{variant:"secondary",disabled:!0,children:"Permission required"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(F,{label:"Patient",name:"patient",control:P,options:re,placeholder:"Search and select patient...",rules:{required:"Patient is required"},error:(Q=f.patient)==null?void 0:Q.message,isSearchable:!0}),e.jsx(F,{label:"Doctor",name:"doctor",control:P,options:le,placeholder:"Select doctor (optional)",error:(K=f.doctor)==null?void 0:K.message,isSearchable:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{label:"Date",type:"date",min:new Date().toISOString().split("T")[0],...N("date",{required:"Date is required"}),error:(W=f.date)==null?void 0:W.message}),e.jsx(T,{label:"Time",type:"time",...N("time",{required:"Time is required"}),error:(_=f.time)==null?void 0:_.message})]}),e.jsx(F,{label:"Appointment Type",name:"type",control:P,options:Ce,placeholder:"Select type..."}),e.jsx(T,{label:"Reason for Visit",placeholder:"Brief description...",...N("reason")}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Notes"}),e.jsx("textarea",{...N("notes"),rows:3,placeholder:"Additional notes...",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]})})]})})}export{Pe as default};
