import{T as $e,J as ye,j as e,u as Ge,r as i,b as Ue,ac as ze,p as j,a as _e,I as Ke,l as He,g as Qe,K as ae,al as fe,y as Ye,ae as Je,am as Ve,af as Xe,z as g,an as je,D as We}from"./index-DPyX6QYN.js";import{u as Ne}from"./useMutation-B_vLsH4g.js";import{b as v}from"./billingService-Bf5s0OjV.js";import{p as Ze}from"./pharmacyService-BNPpzPf8.js";const et=[{id:"consultation",label:"Consultation",color:"blue"},{id:"pharmacy",label:"Pharmacy",color:"green"},{id:"lab",label:"Lab Test",color:"purple"}],tt=[{value:0,label:"No GST (0%)"},{value:5,label:"GST 5%"},{value:10,label:"GST 10%"},{value:12,label:"GST 12%"},{value:18,label:"GST 18%"},{value:20,label:"GST 20%"},{value:30,label:"GST 30%"}],st=[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"upi",label:"UPI"},{value:"netbanking",label:"Net Banking"},{value:"insurance",label:"Insurance"}];function ot(){var pe;const{id:p}=$e(),ve=ye("billing:create",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),we=ye("billing:edit",["SUPER_ADMIN","DOCTOR","ACCOUNTANT","PHARMACIST","RECEPTIONIST"]),D=!!p;if(D&&!we||!D&&!ve)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Access denied"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["You do not have permission to ",D?"edit":"create"," bills."]})]})})});const A=Ge(),[I,$]=i.useState(""),[x,C]=i.useState(null),[le,F]=i.useState(!1),[c,w]=i.useState("consultation"),[R,ne]=i.useState(""),[re,q]=i.useState(!1),[N,G]=i.useState(""),[d,Se]=i.useState(null),[S,ie]=i.useState(""),[Te,U]=i.useState(!1),[z,Pe]=i.useState(!1),{register:u,control:Ae,handleSubmit:Ie,watch:T,setValue:o,formState:{errors:at}}=Ue({defaultValues:{items:[],discount:0,discountType:"fixed",gstRate:0,paymentMethod:"cash",paymentAmount:0,paymentReference:"",notes:""}}),{fields:k,append:_,remove:Ce,replace:Fe}=ze({control:Ae,name:"items"}),h=T("items")||k,K=T("discount")||0,H=T("discountType"),Q=Number(T("gstRate")||0);i.useEffect(()=>{o("gstRate",0)},[o]);const Y=T("paymentAmount")||0,{data:J}=j({queryKey:["billing-doctors"],queryFn:()=>v.getDoctors(),enabled:!0}),M=(J==null?void 0:J.data)||[],[r,E]=i.useState(null),{user:l,normalizeRole:Re}=_e(),oe=Re(l==null?void 0:l.role),y=oe==="DOCTOR",b=!!(l!=null&&l.isClinicAdmin||["SUPER_ADMIN","ACCOUNTANT"].includes(oe)),B=i.useMemo(()=>{try{const t=Array.isArray(M)?[...M]:[];return y&&l&&(t.some(s=>s.id===l.id)||t.unshift({id:l.id,name:l.name,email:l.email})),t}catch{return M||[]}},[M,y,l]),{data:V}=j({queryKey:["billing-patients-search",I,r==null?void 0:r.id],queryFn:()=>v.getPatients({search:I,limit:10,doctorId:r==null?void 0:r.id}),enabled:I.length>=2}),{data:X}=j({queryKey:["products-search",R],queryFn:()=>Ze.getProducts({search:R,limit:10}),enabled:R.length>=2&&c==="pharmacy"}),ce=(V==null?void 0:V.data)||[],de=(X==null?void 0:X.data)||[],{data:W}=j({queryKey:["labs-search",N],queryFn:()=>je.getLabs({search:N,limit:10}),enabled:c==="lab"&&N.length>=1}),ue=(W==null?void 0:W.data)||[],{data:Z}=j({queryKey:["lab-tests",d==null?void 0:d.id,S],queryFn:()=>je.getLabTests(d==null?void 0:d.id,{search:S,limit:50}),enabled:c==="lab"&&!!d&&S.length>=1}),me=(Z==null?void 0:Z.data)||[],{data:ee}=j({queryKey:["consultation-fees"],queryFn:()=>We.getConsultationFees()}),O=((pe=ee==null?void 0:ee.data)==null?void 0:pe.fees)||{},xe=t=>Number((O==null?void 0:O[t])||0),m=i.useMemo(()=>{const t=h.reduce((se,he)=>se+(parseFloat(he.quantity)||0)*(parseFloat(he.unitPrice)||0),0);let a=0;H==="percentage"?a=t*(parseFloat(K)||0)/100:a=parseFloat(K)||0;const s=t-a,n=s*(parseFloat(Q)||0)/100,P=s+n;return{subtotal:t,discountAmount:a,afterDiscount:s,gstAmount:n,total:P}},[JSON.stringify(h||[]),K,H,Q]),be=i.useMemo(()=>(h||[]).reduce((t,a)=>{const s=(parseFloat(a.quantity)||0)*(parseFloat(a.unitPrice)||0),n=(a.type||"").toString().toLowerCase();return n==="medicine"&&(t.medicine+=s),n==="lab"&&(t.labTest+=s),t},{medicine:0,labTest:0}),[JSON.stringify(h||[])]),ge=Ke(),te=Ne({mutationFn:t=>v.createBill(t),onSuccess:t=>{g.success("Bill created successfully"),ge.invalidateQueries(["bills"]),A("/billing")},onError:t=>{var a,s;g.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create bill")}}),{data:L}=j({queryKey:["bill",p],queryFn:()=>p?v.getBill(p):Promise.resolve(null),enabled:!!p});i.useEffect(()=>{if(L&&p){const t=L.data||L;if(C(t.patient||null),t.doctor&&E({id:t.doctor.id,name:t.doctor.name}),t.type){const s=(t.type||"").toString().toUpperCase();w(s==="PHARMACY"?"pharmacy":s==="LAB_TEST"?"lab":"consultation")}const a=(t.items||[]).map(s=>({productId:s.productId||null,description:s.description||"",quantity:s.quantity||1,unitPrice:s.unitPrice||s.amount||0,type:s.type||"other",doctorId:s.doctorId||void 0}));try{o("items",a),t.discountPercent!==null&&t.discountPercent!==void 0?(o("discount",t.discountPercent||0),o("discountType","percentage")):(o("discount",t.discountAmount||0),o("discountType","fixed"));const s=Number(t.subtotal||0),n=Number(t.discountAmount||0),P=s-n;if(P>0){const se=Number(t.taxAmount||0)/P*100||0;o("gstRate",Math.round(se*100)/100)}else o("gstRate",0);o("notes",t.notes||"")}catch{}}},[L,p]);const qe=Ne({mutationFn:({id:t,data:a})=>v.updateBill(t,a),onSuccess:()=>{g.success("Bill updated successfully"),ge.invalidateQueries(["bills"]),A("/billing")},onError:t=>{var a,s;g.error(((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update bill")}}),ke=async t=>{var a;C(t),$(t.name),F(!1);try{const s=await v.getPrefill(t.id),n=s==null?void 0:s.data;n!=null&&n.hasPrefill&&Array.isArray(n.items)&&n.items.length>0&&(Fe(n.items),o("items",n.items),(a=n.doctor)!=null&&a.id&&E({id:n.doctor.id,name:n.doctor.name}),g.success("Medicine and lab test amounts prefilled from latest prescription"))}catch(s){console.error("Failed to prefill bill from prescription:",s)}},Me=t=>{E(t||null),C(null),$("")};i.useEffect(()=>{if(!b&&y&&l){const t=B.find(a=>a.id===l.id)||{id:l.id,name:l.name};E(t)}},[l,y,b]);const Ee=t=>{const a=h.findIndex(s=>s.productId===t.id);if(a>=0){const s=(parseInt(h[a].quantity)||0)+1;o(`items.${a}.quantity`,s),g.success(`${t.name} quantity updated`)}else _({productId:t.id,description:t.name,quantity:1,unitPrice:t.sellingPrice||t.mrp||0,type:"medicine"}),g.success(`${t.name} added to bill`);ne(""),q(!1)},Be=t=>{Se(t),G(t.name)},Oe=t=>{_({productId:null,description:t.name,quantity:1,unitPrice:t.price||0,type:"lab",meta:{labId:(d==null?void 0:d.id)||t.labId,labTestId:t.id}}),g.success(`${t.name} added to bill`),ie(""),U(!1)},Le=()=>{const t=(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0);_({productId:null,description:"",quantity:1,unitPrice:c==="consultation"?xe(t):0,type:c==="consultation"?"consultation":c==="lab"?"lab":"other",doctorId:c==="consultation"?(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0):void 0})};i.useEffect(()=>{if(c!=="consultation")return;const t=(r==null?void 0:r.id)||(y&&!b?l==null?void 0:l.id:void 0);if(!t)return;const a=xe(t);a<=0||(h||[]).forEach((s,n)=>{((s==null?void 0:s.type)||"").toLowerCase()==="consultation"&&(s!=null&&s.doctorId||o(`items.${n}.doctorId`,t),(!(s!=null&&s.unitPrice)||Number(s.unitPrice)<=0)&&o(`items.${n}.unitPrice`,a))})},[c,r==null?void 0:r.id,O,y,b,l==null?void 0:l.id,h,o]);const De=t=>{if(!x){g.error("Please select a patient");return}if(t.items.length===0){g.error("Please add at least one item");return}const a={pharmacy:"PHARMACY",consultation:"CONSULTATION",lab:"LAB_TEST"},s={patientId:x.id,doctorId:r==null?void 0:r.id,type:a[c]||"MIXED",items:t.items.map(n=>({description:n.description,quantity:parseInt(n.quantity),unitPrice:parseFloat(n.unitPrice),gstPercent:parseFloat(t.gstRate)||0,productId:n.productId||void 0,doctorId:n.doctorId||void 0})),discount:m.discountAmount,discountType:"AMOUNT",taxConfig:{gstRate:parseFloat(t.gstRate)||0},notes:t.notes};z&&parseFloat(t.paymentAmount)>0&&(s.payment={amount:parseFloat(t.paymentAmount),method:t.paymentMethod,reference:t.paymentReference}),p?qe.mutate({id:p,data:s}):te.mutate(s)},f=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(t||0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>A("/billing"),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(He,{className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Bill"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Create a new invoice"})]})]}),e.jsx("form",{onSubmit:Ie(De),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Qe,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patient"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsxs("select",{value:(r==null?void 0:r.id)||"",onChange:t=>{const a=t.target.value,s=B.find(n=>n.id===a)||null;Me(s)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[b&&e.jsx("option",{value:"",children:"All Doctors"}),B.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),!b&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Listing patients for all doctors is restricted to clinic admins and accountants."})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:I,onChange:t=>{$(t.target.value),F(!0),t.target.value||C(null)},onFocus:()=>F(!0),placeholder:"Search patient by name or phone...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]})]}),le&&ce.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:ce.map(t=>e.jsxs("button",{type:"button",onClick:()=>ke(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.phone," ",t.email&&`• ${t.email}`]})]},t.id))})]}),x&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-900",children:x.name}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[x.phone,x.email&&` • ${x.email}`]}),x.patientId&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["ID: ",x.patientId]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Type"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:et.map(t=>e.jsx("button",{type:"button",onClick:()=>w(t.id),className:`px-4 py-2 rounded-lg font-medium transition ${c===t.id?t.color==="blue"?"bg-blue-600 text-white":t.color==="green"?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Items"})]}),e.jsxs("button",{type:"button",onClick:Le,className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(Ye,{}),"Add Item"]})]}),c==="pharmacy"&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:R,onChange:t=>{ne(t.target.value),q(!0)},onFocus:()=>q(!0),placeholder:"Search and add products...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"}),re&&de.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:de.map(t=>e.jsxs("button",{type:"button",onClick:()=>Ee(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",t.quantity," ",t.unit||"units"]})]}),e.jsx("span",{className:"font-medium text-gray-900",children:f(t.sellingPrice||t.mrp)})]},t.id))})]}),c==="lab"&&e.jsxs("div",{className:"mb-4 bg-white rounded p-4 border border-gray-100",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Lab"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:N,onChange:t=>{G(t.target.value)},onFocus:()=>G(N),placeholder:"Search labs...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),N&&ue.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto",children:ue.map(t=>{var a;return e.jsx("button",{type:"button",onClick:()=>Be(t),className:"w-full text-left px-4 py-2 hover:bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.contactPerson&&e.jsx("p",{className:"text-xs text-gray-500",children:t.contactPerson})]}),e.jsx("div",{className:"text-sm text-gray-500",children:((a=t._count)==null?void 0:a.bills)||""})]})},t.id)})})]})]}),d&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Selected Lab: ",e.jsx("strong",{children:d.name})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:S,onChange:t=>{ie(t.target.value),U(!0)},onFocus:()=>U(!0),placeholder:"Search lab tests...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),Te&&S.length>=1&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:me.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:"No lab tests found"}):me.map(t=>e.jsx("button",{type:"button",onClick:()=>Oe(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.category&&e.jsx("p",{className:"text-sm text-gray-500",children:t.category})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[t.price," ",t.currency||"INR"]})]})},t.id))})]})]})]}),k.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(fe,{className:"text-3xl mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No items added yet"}),e.jsx("p",{className:"text-sm mt-1",children:c==="pharmacy"?"Search and add products above":'Click "Add Item" to add items'})]}):e.jsx("div",{className:"space-y-3",children:k.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Description"}),e.jsx("input",{...u(`items.${a}.description`,{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Item description"})]}),t.type==="consultation"&&e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Doctor"}),e.jsxs("select",{...u(`items.${a}.doctorId`),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[!b&&e.jsx("option",{value:l==null?void 0:l.id,children:l==null?void 0:l.name}),b&&e.jsx("option",{value:"",children:"Select doctor"}),B.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Qty"}),e.jsx("input",{type:"number",min:"1",...u(`items.${a}.quantity`,{required:!0,min:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",...u(`items.${a}.unitPrice`,{required:!0,min:0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]})]}),e.jsx("button",{type:"button",onClick:()=>Ce(a),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition mt-5",children:e.jsx(Je,{})})]},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ve,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Discount & GST"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Type"}),e.jsxs("select",{...u("discountType"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"fixed",children:"Fixed Amount (₹)"}),e.jsx("option",{value:"percentage",children:"Percentage (%)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Discount ",H==="percentage"?"(%)":"(₹)"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",...u("discount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GST Rate"}),e.jsx("select",{...u("gstRate"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:tt.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{...u("notes"),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Any additional notes for this bill..."})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bill Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Medicine Amount"}),e.jsx("span",{className:"text-gray-900",children:f(be.medicine)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Lab Test Amount"}),e.jsx("span",{className:"text-gray-900",children:f(be.labTest)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsx("span",{className:"text-gray-900",children:f(m.subtotal)})]}),m.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Discount"}),e.jsxs("span",{className:"text-red-600",children:["-",f(m.discountAmount)]})]}),m.gstAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["GST (",Q,"%)"]}),e.jsxs("span",{className:"text-gray-900",children:["+",f(m.gstAmount)]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:"text-gray-900",children:"Total"}),e.jsx("span",{className:"text-blue-600",children:f(m.total)})]})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:t=>Pe(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Collect Payment Now"})]}),z&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsx("select",{...u("paymentMethod"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:st.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m.total,...u("paymentAmount"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:m.total.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference / Transaction ID"}),e.jsx("input",{...u("paymentReference"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]}),Y>0&&Y<m.total&&e.jsxs("p",{className:"text-sm text-yellow-600 bg-yellow-50 p-2 rounded",children:["Balance due after payment:"," ",e.jsx("span",{className:"font-medium",children:f(m.total-Y)})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("button",{type:"submit",disabled:te.isPending||!x||k.length===0,className:"w-full inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Xe,{}),te.isPending?"Creating...":"Create Bill"]}),e.jsx("button",{type:"button",onClick:()=>A("/billing"),className:"w-full px-4 py-2.5 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"})]})]})})]})})]}),(le||re)&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>{F(!1),q(!1)}})]})}export{ot as default};
