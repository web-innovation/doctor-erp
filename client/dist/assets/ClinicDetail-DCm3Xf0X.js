import{T as ve,u as be,r as n,j as e,bc as Ne,a0 as c,ba as W,bb as ee,b9 as we,bd as A,aX as ae,a_ as Ce,aZ as Se,be as Ae,a3 as p,bf as ke,aY as Le,bg as Fe,bh as Ue,Q as k,a2 as Te}from"./index-XABeQ1s9.js";import{a as m}from"./adminService-Da-obrLa.js";const De=()=>{var E,I,O,M,B,$,_,X,q,G,H,Y,K,Q,V,Z,z,J;const{id:x}=ve(),L=be(),[i,se]=n.useState(null),[te,F]=n.useState(!0),[le,v]=n.useState(!1),[ie,b]=n.useState(!1),[re,N]=n.useState(!1),[ne,w]=n.useState(!1),[g,C]=n.useState(null),[f,S]=n.useState({name:"",phone:"",address:""}),[o,y]=n.useState({name:"",email:"",phone:"",role:"RECEPTIONIST",password:""}),[d,j]=n.useState({invoiceUploadLimit:{monthly:"",yearly:""},staffLimit:"",disabledPermissionsText:""}),[ce,U]=n.useState(!1),[T,oe]=n.useState(null),[P,R]=n.useState(!1),[r,de]=n.useState(null),me=[{value:"DOCTOR",label:"Doctor"},{value:"RECEPTIONIST",label:"Receptionist"},{value:"NURSE",label:"Nurse"},{value:"PHARMACIST",label:"Pharmacist"},{value:"LAB_TECHNICIAN",label:"Lab Technician"},{value:"ACCOUNTANT",label:"Accountant"}];n.useEffect(()=>{h()},[x]);const h=async()=>{var a,s;try{F(!0);const l=await m.getClinic(x);se(l);const t=l.accessControls||{};j({invoiceUploadLimit:{monthly:((a=t==null?void 0:t.invoiceUploadLimit)==null?void 0:a.monthly)??"",yearly:((s=t==null?void 0:t.invoiceUploadLimit)==null?void 0:s.yearly)??""},staffLimit:(t==null?void 0:t.staffLimit)??"",disabledPermissionsText:Array.isArray(t==null?void 0:t.disabledPermissions)?t.disabledPermissions.join(`
`):""}),S({name:l.name,phone:l.phone||"",address:l.address||""})}catch(l){console.error("Failed to fetch clinic:",l),L("/admin/clinics")}finally{F(!1)}},pe=async a=>{var s,l;a.preventDefault();try{await m.updateClinic(x,f),v(!1),h()}catch(t){console.error("Failed to update clinic:",t),alert(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to update clinic")}},xe=async a=>{var s,l;a.preventDefault();try{const t=await m.addStaffToClinic(x,o);b(!1),y({name:"",email:"",phone:"",role:"RECEPTIONIST",password:""}),h(),t.tempPassword?alert(`Staff added successfully! Temporary password: ${t.tempPassword}`):alert("Staff added successfully!")}catch(t){console.error("Failed to add staff:",t),alert(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to add staff member")}},ue=async()=>{var a,s;if(g)try{await m.removeStaffFromClinic(x,g.id),N(!1),C(null),h()}catch(l){console.error("Failed to remove staff:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to remove staff member")}},he=async a=>{var s,l;try{await m.toggleUserStatus(a.id),h()}catch(t){console.error("Failed to toggle staff status:",t),alert(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to update staff status")}},fe=async()=>{var a,s;try{i.isActive?await m.blockClinic(x):await m.unblockClinic(x),w(!1),h()}catch(l){console.error("Failed to update clinic status:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update clinic status")}},ye=async a=>{var s,l;if(confirm(`Reset password for ${a.name}? A new password will be set.`))try{const t=await m.resetUserPassword(a.id);alert(`Password reset successfully! ${t.tempPassword?`New password: ${t.tempPassword}`:""}`)}catch(t){console.error("Failed to reset password:",t),alert(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to reset password")}},ge=async()=>{var a,s;try{U(!0);const l=d.disabledPermissionsText.split(/[\n,]+/).map(t=>t.trim()).filter(Boolean);await m.updateClinicAccessControls(x,{invoiceUploadLimit:{monthly:d.invoiceUploadLimit.monthly===""?null:Number(d.invoiceUploadLimit.monthly),yearly:d.invoiceUploadLimit.yearly===""?null:Number(d.invoiceUploadLimit.yearly)},staffLimit:d.staffLimit===""?null:Number(d.staffLimit),disabledPermissions:l}),alert("Access controls updated"),h()}catch(l){console.error("Failed to save controls:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update controls")}finally{U(!1)}},D=async(a=!1)=>{var s,l;if(!T){alert("Please select a CSV or XLSX file");return}try{R(!0);const t=new FormData;t.append("file",T);const u=await m.importClinicSetup(x,t,{dryRun:a});de((u==null?void 0:u.data)||null),alert(a?"Dry run completed":"Clinic setup import completed"),h()}catch(t){console.error("Failed to import setup:",t),alert(((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to import setup")}finally{R(!1)}},je=async()=>{var a,s;try{const l=await m.downloadSetupTemplate(),t=window.URL.createObjectURL(new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),u=document.createElement("a");u.href=t,u.setAttribute("download","clinic_setup_template.xlsx"),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(t)}catch(l){console.error("Template download failed:",l),alert(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to download template")}};return te?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>L("/admin/clinics"),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ne,{className:"text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:i.name}),e.jsxs("p",{className:"text-gray-600",children:["Created on ",new Date(i.createdAt).toLocaleDateString("en-GB")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${i.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.isActive?"Active":"Blocked"}),e.jsx(c,{variant:i.isActive?"danger":"primary",onClick:()=>w(!0),children:i.isActive?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2"})," Block"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2"})," Unblock"]})}),e.jsxs(c,{onClick:()=>v(!0),children:[e.jsx(we,{className:"mr-2"})," Edit"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(A,{title:"Total Users",value:((E=i.users)==null?void 0:E.length)||((I=i._count)==null?void 0:I.users)||0,icon:ae,color:"blue"}),e.jsx(A,{title:"Total Patients",value:((O=i.stats)==null?void 0:O.totalPatients)||((M=i._count)==null?void 0:M.patients)||0,icon:ae,color:"green"}),e.jsx(A,{title:"Total Appointments",value:((B=i.stats)==null?void 0:B.totalAppointments)||(($=i._count)==null?void 0:$.appointments)||0,icon:Ce,color:"purple"}),e.jsx(A,{title:"Total Revenue",value:`â‚¹${(((_=i.stats)==null?void 0:_.totalRevenue)||0).toLocaleString()}`,icon:Se,color:"orange"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clinic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Phone"}),e.jsx("p",{className:"mt-1 text-gray-900",children:i.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Email"}),e.jsx("p",{className:"mt-1 text-gray-900",children:i.email||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Address"}),e.jsx("p",{className:"mt-1 text-gray-900",children:[i.address,i.city,i.state,i.pincode].filter(Boolean).join(", ")||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"GST Number"}),e.jsx("p",{className:"mt-1 text-gray-900",children:i.gstNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"License Number"}),e.jsx("p",{className:"mt-1 text-gray-900",children:i.licenseNumber||"-"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"text-purple-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Clinic Access Controls"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(p,{type:"number",min:"0",label:"Monthly Invoice Upload Limit",value:d.invoiceUploadLimit.monthly,onChange:a=>j(s=>({...s,invoiceUploadLimit:{...s.invoiceUploadLimit,monthly:a.target.value}}))}),e.jsx(p,{type:"number",min:"0",label:"Yearly Invoice Upload Limit",value:d.invoiceUploadLimit.yearly,onChange:a=>j(s=>({...s,invoiceUploadLimit:{...s.invoiceUploadLimit,yearly:a.target.value}}))}),e.jsx(p,{type:"number",min:"0",label:"Staff Limit",value:d.staffLimit,onChange:a=>j(s=>({...s,staffLimit:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disabled Permissions (one per line or comma separated)"}),e.jsx("textarea",{className:"w-full rounded-lg border border-gray-300 p-3 text-sm",rows:4,placeholder:"Example: billing:create",value:d.disabledPermissionsText,onChange:a=>j(s=>({...s,disabledPermissionsText:a.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:ge,loading:ce,children:"Save Controls"}),e.jsx("button",{type:"button",onClick:je,className:"inline-flex items-center px-4 py-2 border rounded-lg text-sm hover:bg-gray-50",children:"Download Setup Template"})]}),e.jsxs("div",{className:"border-t pt-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"One-click Clinic Setup Import"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Upload the template spreadsheet (XLSX) to create staff, pharmacy products, agents, labs, and lab tests."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsx("input",{type:"file",accept:".csv,text/csv,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:a=>{var s;return oe(((s=a.target.files)==null?void 0:s[0])||null)}}),e.jsx(c,{variant:"outline",onClick:()=>D(!0),loading:P,children:"Dry Run"}),e.jsxs(c,{onClick:()=>D(!1),loading:P,children:[e.jsx(ke,{className:"mr-2"})," Import Setup"]})]}),(r==null?void 0:r.summary)&&e.jsxs("div",{className:"mt-4 text-sm bg-gray-50 border rounded-lg p-3 space-y-1",children:[e.jsxs("p",{children:["Rows: ",r.summary.rows]}),e.jsxs("p",{children:["Staff created/updated: ",((X=r.summary.staff)==null?void 0:X.created)||0,"/",((q=r.summary.staff)==null?void 0:q.updated)||0]}),e.jsxs("p",{children:["Pharmacy created/updated: ",((G=r.summary.pharmacy)==null?void 0:G.created)||0,"/",((H=r.summary.pharmacy)==null?void 0:H.updated)||0]}),e.jsxs("p",{children:["Labs created/updated: ",((Y=r.summary.labs)==null?void 0:Y.created)||0,"/",((K=r.summary.labs)==null?void 0:K.updated)||0]}),e.jsxs("p",{children:["Lab tests created/updated: ",((Q=r.summary.labTests)==null?void 0:Q.created)||0,"/",((V=r.summary.labTests)==null?void 0:V.updated)||0]}),e.jsxs("p",{children:["Agents created/updated: ",((Z=r.summary.agents)==null?void 0:Z.created)||0,"/",((z=r.summary.agents)==null?void 0:z.updated)||0]}),(r.summary.errors||[]).length>0&&e.jsxs("p",{className:"text-red-600",children:["Errors: ",(r.summary.errors||[]).slice(0,3).join(" | ")]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Staff Members"}),e.jsxs(c,{onClick:()=>b(!0),children:[e.jsx(Le,{className:"mr-2"})," Add Staff"]})]}),((J=i.users)==null?void 0:J.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.users.map(a=>{var s;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-medium text-sm",children:((s=a.name)==null?void 0:s.charAt(0))||"?"})}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:a.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:a.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:a.phone||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.role==="DOCTOR"?"bg-blue-100 text-blue-800":a.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:a.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>ye(a),className:"text-blue-600 hover:text-blue-800 p-1",title:"Reset Password",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>he(a),className:`p-1 ${a.isActive?"text-orange-600 hover:text-orange-800":"text-green-600 hover:text-green-800"}`,title:a.isActive?"Deactivate":"Activate",children:a.isActive?e.jsx(W,{className:"h-4 w-4"}):e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{C(a),N(!0)},className:"text-red-600 hover:text-red-800 p-1",title:"Remove Staff",children:e.jsx(Ue,{className:"h-4 w-4"})})]})})]},a.id)})})]})}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No staff members found"})]}),e.jsx(k,{isOpen:le,onClose:()=>v(!1),title:"Edit Clinic",children:e.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[e.jsx(p,{label:"Clinic Name",value:f.name,onChange:a=>S({...f,name:a.target.value}),required:!0}),e.jsx(p,{label:"Phone",value:f.phone,onChange:a=>S({...f,phone:a.target.value})}),e.jsx(p,{label:"Address",value:f.address,onChange:a=>S({...f,address:a.target.value})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(c,{type:"submit",children:"Update Clinic"})]})]})}),e.jsx(k,{isOpen:ie,onClose:()=>b(!1),title:"Add Staff Member",children:e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[e.jsx(p,{label:"Full Name",value:o.name,onChange:a=>y({...o,name:a.target.value}),required:!0}),e.jsx(p,{label:"Email",type:"email",value:o.email,onChange:a=>y({...o,email:a.target.value}),required:!0}),e.jsx(p,{label:"Phone",value:o.phone,onChange:a=>y({...o,phone:a.target.value}),required:!0}),e.jsx(Te,{label:"Role",options:me,value:o.role,onChange:a=>y({...o,role:a.target.value})}),e.jsx(p,{label:"Password (leave empty for auto-generated)",type:"password",value:o.password,onChange:a=>y({...o,password:a.target.value}),placeholder:"Leave empty for default: password123"}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(c,{type:"submit",children:"Add Staff"})]})]})}),e.jsx(k,{isOpen:re,onClose:()=>{N(!1),C(null)},title:"Remove Staff Member",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to remove ",e.jsx("strong",{children:g==null?void 0:g.name})," from this clinic? They will be deactivated and unable to access the system."]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>{N(!1),C(null)},children:"Cancel"}),e.jsx(c,{variant:"danger",onClick:ue,children:"Remove Staff"})]})]})}),e.jsx(k,{isOpen:ne,onClose:()=>w(!1),title:i.isActive?"Block Clinic":"Unblock Clinic",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:i.isActive?`Are you sure you want to block "${i.name}"? All users will be deactivated and unable to access the system.`:`Are you sure you want to unblock "${i.name}"? All users will be reactivated and able to access the system.`}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(c,{variant:i.isActive?"danger":"primary",onClick:fe,children:i.isActive?"Block Clinic":"Unblock Clinic"})]})]})})]}):null};export{De as default};
